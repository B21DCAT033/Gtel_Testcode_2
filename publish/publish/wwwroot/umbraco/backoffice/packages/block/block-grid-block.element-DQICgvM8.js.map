{"version":3,"file":"block-grid-block.element-DQICgvM8.js","sources":["../../../src/packages/block/block-grid/utils/index.ts","../../../src/packages/block/block-grid/context/block-grid-scale-manager/block-grid-scale-manager.controller.ts","../../../src/packages/block/block-grid/context/block-grid-entries.context.ts","../../../src/packages/block/block-grid/context/block-grid-entry.context.ts","../../../src/packages/block/block-grid/components/ref-grid-block/ref-grid-block.element.ts","../../../src/packages/block/block-grid/components/block-grid-block-inline/block-grid-block-inline.element.ts","../../../src/packages/block/block-grid/components/block-grid-block-unsupported/block-grid-block-unsupported.element.ts","../../../src/packages/block/block-grid/components/block-scale-handler/block-scale-handler.element.ts","../../../src/packages/block/block-grid/components/block-grid-entry/block-grid-entry.element.ts","../../../src/packages/block/block-grid/components/block-grid-entries/block-grid-entries.element.ts","../../../src/packages/block/block-grid/components/block-grid-areas-container/block-grid-areas-container.element.ts","../../../src/packages/block/block-grid/components/block-grid-block/block-grid-block.element.ts"],"sourcesContent":["import type { UmbBlockGridLayoutModel } from '../types.js';\r\n\r\n/**\r\n *\r\n * @param {number} target - The target number\r\n * @param {Array<number>} map - The map to search in\r\n * @param {number} max - The max value to return if no match is found\r\n * @returns {number | undefined} - The closest number in the map to the target\r\n */\r\nexport function closestColumnSpanOption(target: number, map: Array<number>, max: number): number | undefined {\r\n\tif (map.length > 0) {\r\n\t\tconst result = map.reduce((a, b) => {\r\n\t\t\tif (a > max) {\r\n\t\t\t\treturn b;\r\n\t\t\t}\r\n\t\t\tconst aDiff = Math.abs(a - target);\r\n\t\t\tconst bDiff = Math.abs(b - target);\r\n\r\n\t\t\tif (aDiff === bDiff) {\r\n\t\t\t\treturn a < b ? a : b;\r\n\t\t\t} else {\r\n\t\t\t\treturn bDiff < aDiff ? b : a;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (result) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\treturn;\r\n}\r\n\r\n/**\r\n *\r\n * @param {UmbBlockGridLayoutModel} entry - The entry to iterate over\r\n * @param {(entry:UmbBlockGridLayoutModel) => void } callback - The callback to call for each entry\r\n */\r\nexport async function forEachBlockLayoutEntryOf(\r\n\tentry: UmbBlockGridLayoutModel,\r\n\tcallback: (entry: UmbBlockGridLayoutModel, parentUnique: string, areaKey: string) => PromiseLike<void>,\r\n): Promise<void> {\r\n\tif (entry.areas) {\r\n\t\tconst parentUnique = entry.contentKey;\r\n\t\tawait Promise.all(\r\n\t\t\tentry.areas.map(async (area) => {\r\n\t\t\t\tconst areaKey = area.key;\r\n\t\t\t\tawait Promise.all(\r\n\t\t\t\t\tarea.items.map(async (item) => {\r\n\t\t\t\t\t\tawait callback(item, parentUnique, areaKey);\r\n\t\t\t\t\t\tawait forEachBlockLayoutEntryOf(item, callback);\r\n\t\t\t\t\t}),\r\n\t\t\t\t);\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n}\r\n","import { closestColumnSpanOption } from '../../utils/index.js';\r\nimport { getAccumulatedValueOfIndex, getInterpolatedIndexOfPositionInWeightMap } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\n// This might be more generic than Block Grid, but this is where it belongs currently:\r\nexport interface UmbBlockGridScalableContext extends UmbControllerHost {\r\n\tsetColumnSpan: (columnSpan: number) => void;\r\n\tsetRowSpan: (rowSpan: number) => void;\r\n\tgetColumnSpan: () => number | undefined;\r\n\tgetRowSpan: () => number | undefined;\r\n\tgetMinMaxRowSpan: () => [number, number] | undefined;\r\n\tgetRelevantColumnSpanOptions: () => Array<number> | undefined;\r\n}\r\n\r\n// This might be more generic than Block Grid, but this is where it belongs currently:\r\nexport interface UmbBlockGridScalableContainerContext extends UmbControllerHost {\r\n\tgetLayoutColumns: () => number | undefined;\r\n\tgetLayoutContainerElement: () => HTMLElement | undefined;\r\n}\r\n\r\nexport class UmbBlockGridScaleManager extends UmbControllerBase {\r\n\t//\r\n\t#runtimeGridColumns: Array<number> = [];\r\n\t#runtimeGridRows: Array<number> = [];\r\n\t#lockedGridRows = 0;\r\n\t//\r\n\toverride _host: UmbBlockGridScalableContext;\r\n\t_entries?: UmbBlockGridScalableContainerContext;\r\n\r\n\tconstructor(host: UmbBlockGridScalableContext) {\r\n\t\tsuper(host, 'blockGridScaleManager');\r\n\t\tthis._host = host;\r\n\t}\r\n\r\n\tsetEntriesContext(entriesContext: UmbBlockGridScalableContainerContext | undefined) {\r\n\t\tthis._entries = entriesContext;\r\n\t}\r\n\r\n\t// Scaling feature:\r\n\r\n\t#updateGridData(\r\n\t\tlayoutContainer: HTMLElement,\r\n\t\tlayoutContainerRect: DOMRect,\r\n\t\tlayoutItemRect: DOMRect,\r\n\t\tupdateRowTemplate: boolean,\r\n\t) {\r\n\t\tif (!this._entries) return;\r\n\t\tconst layoutColumns = this._entries.getLayoutColumns() ?? 0;\r\n\r\n\t\tconst computedStyles = window.getComputedStyle(layoutContainer);\r\n\r\n\t\tconst columnGap = Number(computedStyles.columnGap.split('px')[0]) || 0;\r\n\t\tconst rowGap = Number(computedStyles.rowGap.split('px')[0]) || 0;\r\n\r\n\t\tlet gridColumns = computedStyles.gridTemplateColumns\r\n\t\t\t.trim()\r\n\t\t\t.split('px')\r\n\t\t\t.map((x) => Number(x));\r\n\t\tlet gridRows = computedStyles.gridTemplateRows\r\n\t\t\t.trim()\r\n\t\t\t.split('px')\r\n\t\t\t.map((x) => Number(x));\r\n\r\n\t\t// remove empties:\r\n\t\tgridColumns = gridColumns.filter((n) => n > 0);\r\n\t\tgridRows = gridRows.filter((n) => n > 0);\r\n\r\n\t\t// We use this code to lock the templateRows, while scaling. otherwise scaling Rows is too crazy.\r\n\t\tif (updateRowTemplate || gridRows.length > this.#lockedGridRows) {\r\n\t\t\tthis.#lockedGridRows = gridRows.length;\r\n\t\t\tlayoutContainer.style.gridTemplateRows = computedStyles.gridTemplateRows;\r\n\t\t}\r\n\r\n\t\t// add gaps:\r\n\t\tconst gridColumnsLen = gridColumns.length;\r\n\t\tgridColumns = gridColumns.map((n, i) => (gridColumnsLen === i ? n : n + columnGap));\r\n\t\tconst gridRowsLen = gridRows.length;\r\n\t\tgridRows = gridRows.map((n, i) => (gridRowsLen === i ? n : n + rowGap));\r\n\r\n\t\t// ensure all columns are there.\r\n\t\t// This will also ensure handling non-css-grid mode,\r\n\t\t// use container width divided by amount of columns( or the item width divided by its amount of columnSpan)\r\n\t\tlet amountOfColumnsInWeightMap = gridColumns.length;\r\n\t\tconst amountOfUnknownColumns = layoutColumns - amountOfColumnsInWeightMap;\r\n\t\tif (amountOfUnknownColumns > 0) {\r\n\t\t\tconst accumulatedValue = getAccumulatedValueOfIndex(amountOfColumnsInWeightMap, gridColumns) || 0;\r\n\t\t\tconst missingColumnWidth = (layoutContainerRect.width - accumulatedValue) / amountOfUnknownColumns;\r\n\t\t\twhile (amountOfColumnsInWeightMap++ < layoutColumns) {\r\n\t\t\t\tgridColumns.push(missingColumnWidth);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Handle non css grid mode for Rows:\r\n\t\t// use item height divided by rowSpan to identify row heights.\r\n\t\tif (gridRows.length === 0) {\r\n\t\t\t// Push its own height twice, to give something to scale with.\r\n\t\t\tgridRows.push(layoutItemRect.top - layoutContainerRect.top);\r\n\r\n\t\t\tlet i = 0;\r\n\t\t\tconst itemSingleRowHeight = layoutItemRect.height;\r\n\t\t\twhile (i++ < (this._host.getRowSpan() ?? 0)) {\r\n\t\t\t\tgridRows.push(itemSingleRowHeight);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// add a few extra rows, so there is something to extend too.\r\n\t\t// Add extra options for the ability to extend beyond current content:\r\n\t\tgridRows.push(50);\r\n\t\tgridRows.push(50);\r\n\t\tgridRows.push(50);\r\n\t\tgridRows.push(50);\r\n\t\tgridRows.push(50);\r\n\r\n\t\tthis.#runtimeGridColumns = gridColumns;\r\n\t\tthis.#runtimeGridRows = gridRows;\r\n\t}\r\n\r\n\t// TODO: Rename to calc something.\r\n\t#getNewSpans(startX: number, startY: number, endX: number, endY: number) {\r\n\t\tconst layoutColumns = this._entries?.getLayoutColumns();\r\n\t\tif (!layoutColumns) return;\r\n\r\n\t\tconst blockStartCol = Math.round(getInterpolatedIndexOfPositionInWeightMap(startX, this.#runtimeGridColumns));\r\n\t\tconst blockStartRow = Math.round(getInterpolatedIndexOfPositionInWeightMap(startY, this.#runtimeGridRows));\r\n\t\tconst blockEndCol = getInterpolatedIndexOfPositionInWeightMap(endX, this.#runtimeGridColumns);\r\n\t\tconst blockEndRow = getInterpolatedIndexOfPositionInWeightMap(endY, this.#runtimeGridRows);\r\n\r\n\t\tlet newColumnSpan = Math.max(blockEndCol - blockStartCol, 1);\r\n\r\n\t\tconst columnOptions = this._host.getRelevantColumnSpanOptions();\r\n\t\tif (!columnOptions) return;\r\n\r\n\t\t// Find nearest allowed Column:\r\n\t\tconst bestColumnSpanOption = closestColumnSpanOption(newColumnSpan, columnOptions, layoutColumns - blockStartCol);\r\n\t\tnewColumnSpan = bestColumnSpanOption ?? layoutColumns;\r\n\r\n\t\t// Find allowed row spans:\r\n\t\tconst minMaxRowSpan = this._host.getMinMaxRowSpan();\r\n\t\tif (!minMaxRowSpan) return;\r\n\t\tconst [rowMinSpan, rowMaxSpan] = minMaxRowSpan;\r\n\t\tlet newRowSpan = Math.round(Math.max(blockEndRow - blockStartRow, rowMinSpan));\r\n\t\tif (rowMaxSpan != null) {\r\n\t\t\tnewRowSpan = Math.min(newRowSpan, rowMaxSpan);\r\n\t\t}\r\n\r\n\t\treturn { columnSpan: newColumnSpan, rowSpan: newRowSpan, startCol: blockStartCol, startRow: blockStartRow };\r\n\t}\r\n\r\n\tpublic onScaleMouseDown(event: MouseEvent) {\r\n\t\tconst layoutContainer = this._entries?.getLayoutContainerElement();\r\n\t\tif (!layoutContainer) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevent.preventDefault();\r\n\r\n\t\t//this.#isScaleMode = true;\r\n\r\n\t\twindow.addEventListener('mousemove', this.onScaleMouseMove);\r\n\t\twindow.addEventListener('mouseup', this.onScaleMouseUp);\r\n\t\twindow.addEventListener('mouseleave', this.onScaleMouseUp);\r\n\r\n\t\tconst layoutItemRect = this.getHostElement().getBoundingClientRect();\r\n\t\tthis.#updateGridData(layoutContainer, layoutContainer.getBoundingClientRect(), layoutItemRect, true);\r\n\r\n\t\t/*\r\n\t\tscaleBoxBackdropEl = document.createElement('div');\r\n\t\tscaleBoxBackdropEl.className = 'umb-block-grid__scalebox-backdrop';\r\n\t\tlayoutContainer.appendChild(scaleBoxBackdropEl);\r\n\t\t*/\r\n\t}\r\n\r\n\t#updateLayoutRaf = 0;\r\n\tonScaleMouseMove = (e: MouseEvent) => {\r\n\t\tconst layoutContainer = this._entries?.getLayoutContainerElement();\r\n\t\tif (!layoutContainer) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst layoutContainerRect = layoutContainer.getBoundingClientRect();\r\n\t\tconst layoutItemRect = this.getHostElement().getBoundingClientRect();\r\n\r\n\t\tconst startX = layoutItemRect.left - layoutContainerRect.left;\r\n\t\tconst startY = layoutItemRect.top - layoutContainerRect.top;\r\n\t\tconst endX = e.clientX - layoutContainerRect.left;\r\n\t\tconst endY = e.clientY - layoutContainerRect.top;\r\n\r\n\t\tconst newSpans = this.#getNewSpans(startX, startY, endX, endY);\r\n\t\tif (!newSpans) return;\r\n\r\n\t\tconst updateRowTemplate = this._host.getColumnSpan() !== newSpans.columnSpan;\r\n\t\tif (updateRowTemplate) {\r\n\t\t\t// If we like to update we need to first remove the lock, make the browser render onces and then update.\r\n\t\t\t(layoutContainer as HTMLElement).style.gridTemplateRows = '';\r\n\t\t}\r\n\t\tcancelAnimationFrame(this.#updateLayoutRaf);\r\n\t\tthis.#updateLayoutRaf = requestAnimationFrame(() => {\r\n\t\t\t// As mentioned above we need to wait until the browser has rendered DOM without the lock of gridTemplateRows.\r\n\t\t\tthis.#updateGridData(layoutContainer, layoutContainerRect, layoutItemRect, updateRowTemplate);\r\n\t\t});\r\n\r\n\t\t// update as we go:\r\n\t\tthis._host.setColumnSpan(newSpans.columnSpan);\r\n\t\tthis._host.setRowSpan(newSpans.rowSpan);\r\n\t};\r\n\r\n\tonScaleMouseUp = (e: MouseEvent) => {\r\n\t\tconst layoutContainer = this._entries?.getLayoutContainerElement();\r\n\t\tif (!layoutContainer) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcancelAnimationFrame(this.#updateLayoutRaf);\r\n\r\n\t\t// Remove listeners:\r\n\t\twindow.removeEventListener('mousemove', this.onScaleMouseMove);\r\n\t\twindow.removeEventListener('mouseup', this.onScaleMouseUp);\r\n\t\twindow.removeEventListener('mouseleave', this.onScaleMouseUp);\r\n\r\n\t\tconst layoutContainerRect = layoutContainer.getBoundingClientRect();\r\n\t\tconst layoutItemRect = this.getHostElement().getBoundingClientRect();\r\n\r\n\t\tconst startX = layoutItemRect.left - layoutContainerRect.left;\r\n\t\tconst startY = layoutItemRect.top - layoutContainerRect.top;\r\n\t\tconst endX = e.clientX - layoutContainerRect.left;\r\n\t\tconst endY = e.clientY - layoutContainerRect.top;\r\n\t\tconst newSpans = this.#getNewSpans(startX, startY, endX, endY);\r\n\r\n\t\t// release the lock of gridTemplateRows:\r\n\t\t//layoutContainer.removeChild(scaleBoxBackdropEl);\r\n\t\t//this.scaleBoxBackdropEl = null;\r\n\t\tlayoutContainer.style.gridTemplateRows = '';\r\n\t\t//this.#isScaleMode = false;\r\n\r\n\t\t// Clean up variables:\r\n\t\t//this.layoutContainer = null;\r\n\t\t//this.gridColumns = [];\r\n\t\t//this.gridRows = [];\r\n\t\tthis.#lockedGridRows = 0;\r\n\r\n\t\tif (!newSpans) return;\r\n\t\t// Update block size:\r\n\t\tthis._host.setColumnSpan(newSpans.columnSpan);\r\n\t\tthis._host.setRowSpan(newSpans.rowSpan);\r\n\t};\r\n}\r\n\r\nexport default UmbBlockGridScaleManager;\r\n","import type { UmbBlockDataModel } from '../../block/index.js';\r\nimport { UMB_BLOCK_CATALOGUE_MODAL, UmbBlockEntriesContext } from '../../block/index.js';\r\nimport {\r\n\tUMB_BLOCK_GRID_ENTRY_CONTEXT,\r\n\tUMB_BLOCK_GRID_PROPERTY_EDITOR_SCHEMA_ALIAS,\r\n\tUMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS,\r\n\tUMB_BLOCK_GRID_WORKSPACE_MODAL,\r\n\ttype UmbBlockGridWorkspaceOriginData,\r\n} from '../index.js';\r\nimport type {\r\n\tUmbBlockGridLayoutModel,\r\n\tUmbBlockGridTypeAreaType,\r\n\tUmbBlockGridTypeModel,\r\n\tUmbBlockGridValueModel,\r\n} from '../types.js';\r\nimport { forEachBlockLayoutEntryOf } from '../utils/index.js';\r\nimport { UMB_BLOCK_GRID_MANAGER_CONTEXT } from './block-grid-manager.context-token.js';\r\nimport type { UmbBlockGridScalableContainerContext } from './block-grid-scale-manager/block-grid-scale-manager.controller.js';\r\nimport {\r\n\tUmbArrayState,\r\n\tUmbBooleanState,\r\n\tUmbNumberState,\r\n\tUmbObjectState,\r\n\tUmbStringState,\r\n} from '@umbraco-cms/backoffice/observable-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbModalRouteRegistrationController, UmbRoutePathAddendumContext } from '@umbraco-cms/backoffice/router';\r\nimport type { UmbNumberRangeValueType } from '@umbraco-cms/backoffice/models';\r\nimport {\r\n\tUMB_CLIPBOARD_PROPERTY_CONTEXT,\r\n\tUmbClipboardPastePropertyValueTranslatorValueResolver,\r\n} from '@umbraco-cms/backoffice/clipboard';\r\nimport { UMB_PROPERTY_CONTEXT } from '@umbraco-cms/backoffice/property';\r\n\r\ninterface UmbBlockGridAreaTypeInvalidRuleType {\r\n\tgroupKey?: string;\r\n\tkey?: string;\r\n\tname: string;\r\n\tamount: number;\r\n\tminRequirement: number;\r\n\tmaxRequirement: number;\r\n}\r\n\r\nexport class UmbBlockGridEntriesContext\r\n\textends UmbBlockEntriesContext<\r\n\t\ttypeof UMB_BLOCK_GRID_MANAGER_CONTEXT,\r\n\t\ttypeof UMB_BLOCK_GRID_MANAGER_CONTEXT.TYPE,\r\n\t\tUmbBlockGridTypeModel,\r\n\t\tUmbBlockGridLayoutModel,\r\n\t\tUmbBlockGridWorkspaceOriginData\r\n\t>\r\n\timplements UmbBlockGridScalableContainerContext\r\n{\r\n\t//\r\n\t#pathAddendum = new UmbRoutePathAddendumContext(this);\r\n\r\n\t#parentEntry?: typeof UMB_BLOCK_GRID_ENTRY_CONTEXT.TYPE;\r\n\r\n\t#layoutColumns = new UmbNumberState(undefined);\r\n\treadonly layoutColumns = this.#layoutColumns.asObservable();\r\n\r\n\t#areaType = new UmbObjectState<UmbBlockGridTypeAreaType | undefined>(undefined);\r\n\tareaType = this.#areaType.asObservable();\r\n\tareaTypeCreateLabel = this.#areaType.asObservablePart((x) => x?.createLabel);\r\n\r\n\t#parentUnique?: string | null;\r\n\t#areaKey?: string | null;\r\n\r\n\t#rangeLimits = new UmbObjectState<UmbNumberRangeValueType | undefined>(undefined);\r\n\treadonly rangeLimits = this.#rangeLimits.asObservable();\r\n\r\n\t#allowedBlockTypes = new UmbArrayState<UmbBlockGridTypeModel>([], (x) => x.contentElementTypeKey);\r\n\tpublic readonly allowedBlockTypes = this.#allowedBlockTypes.asObservable();\r\n\tpublic readonly amountOfAllowedBlockTypes = this.#allowedBlockTypes.asObservablePart((x) => x.length);\r\n\tpublic readonly canCreate = this.#allowedBlockTypes.asObservablePart((x) => x.length > 0);\r\n\r\n\t#hasTypeLimits = new UmbBooleanState(undefined);\r\n\tpublic readonly hasTypeLimits = this.#hasTypeLimits.asObservable();\r\n\r\n\tfirstAllowedBlockTypeName() {\r\n\t\tif (!this._manager) {\r\n\t\t\tthrow new Error('Manager not ready');\r\n\t\t}\r\n\r\n\t\tconst nameState = new UmbStringState(undefined);\r\n\t\tthis.observe(this.allowedBlockTypes, (x) => {\r\n\t\t\tif (x.length === 1) {\r\n\t\t\t\tthis.observe(\r\n\t\t\t\t\tthis._manager!.contentTypeNameOf(x[0].contentElementTypeKey),\r\n\t\t\t\t\t(name) => {\r\n\t\t\t\t\t\tnameState.setValue(name);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'getFirstAllowedBlockTypeName',\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthis.removeUmbControllerByAlias('getFirstAllowedBlockTypeName');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn nameState.asObservable();\r\n\t}\r\n\r\n\tsetParentUnique(contentKey: string | null) {\r\n\t\tthis.#parentUnique = contentKey;\r\n\t}\r\n\r\n\tgetParentUnique(): string | null | undefined {\r\n\t\treturn this.#parentUnique;\r\n\t}\r\n\r\n\tsetAreaKey(areaKey: string | null) {\r\n\t\tthis.#areaKey = areaKey;\r\n\t\tthis.#pathAddendum.setAddendum(areaKey ?? '');\r\n\t\tthis.#gotAreaKey();\r\n\r\n\t\t// Idea: If we need to parse down a validation data path to target the specific layout object: [NL]\r\n\t\t// If we have a areaKey, we want to inherit our layoutDataPath from nearest blockGridEntry context.\r\n\t\t// If not, we want to set the layoutDataPath to a base one.\r\n\t}\r\n\r\n\tgetAreaKey(): string | null | undefined {\r\n\t\treturn this.#areaKey;\r\n\t}\r\n\r\n\tsetLayoutColumns(columns: number | undefined) {\r\n\t\tthis.#layoutColumns.setValue(columns);\r\n\t}\r\n\tgetLayoutColumns() {\r\n\t\treturn this.#layoutColumns.getValue();\r\n\t}\r\n\r\n\tgetMinAllowed() {\r\n\t\tif (this.#areaKey) {\r\n\t\t\treturn this.#areaType.getValue()?.minAllowed ?? 0;\r\n\t\t}\r\n\t\treturn this._manager?.getMinAllowed() ?? 0;\r\n\t}\r\n\r\n\tgetMaxAllowed() {\r\n\t\tif (this.#areaKey) {\r\n\t\t\treturn this.#areaType.getValue()?.maxAllowed ?? Infinity;\r\n\t\t}\r\n\t\treturn this._manager?.getMaxAllowed() ?? Infinity;\r\n\t}\r\n\r\n\tgetLayoutContainerElement() {\r\n\t\treturn this.getHostElement().shadowRoot?.querySelector('.umb-block-grid__layout-container') as\r\n\t\t\t| HTMLElement\r\n\t\t\t| undefined;\r\n\t}\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_BLOCK_GRID_MANAGER_CONTEXT);\r\n\r\n\t\tthis.consumeContext(UMB_BLOCK_GRID_ENTRY_CONTEXT, (blockGridEntry) => {\r\n\t\t\tthis.#parentEntry = blockGridEntry;\r\n\t\t\tthis.#gotBlockParentEntry(); // is not used at this point. [NL]\r\n\t\t});\r\n\r\n\t\tnew UmbModalRouteRegistrationController(this, UMB_BLOCK_CATALOGUE_MODAL)\r\n\t\t\t.addAdditionalPath('_catalogue/:view/:index')\r\n\t\t\t.onSetup(async (routingInfo) => {\r\n\t\t\t\tif (!this._manager) return false;\r\n\t\t\t\t// Idea: Maybe on setup should be async, so it can retrieve the values when needed? [NL]\r\n\t\t\t\tconst index = routingInfo.index ? parseInt(routingInfo.index) : -1;\r\n\t\t\t\tconst clipboardContext = await this.getContext(UMB_CLIPBOARD_PROPERTY_CONTEXT);\r\n\t\t\t\tconst pasteTranslatorManifests = clipboardContext.getPasteTranslatorManifests(\r\n\t\t\t\t\tUMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS,\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// TODO: consider moving some of this logic to the clipboard property context\r\n\t\t\t\tconst propertyContext = await this.getContext(UMB_PROPERTY_CONTEXT);\r\n\t\t\t\tconst config = propertyContext.getConfig();\r\n\t\t\t\tconst valueResolver = new UmbClipboardPastePropertyValueTranslatorValueResolver(this);\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tblocks: this.#allowedBlockTypes.getValue(),\r\n\t\t\t\t\t\tblockGroups: this._manager.getBlockGroups() ?? [],\r\n\t\t\t\t\t\topenClipboard: routingInfo.view === 'clipboard',\r\n\t\t\t\t\t\tclipboardFilter: async (clipboardEntryDetail) => {\r\n\t\t\t\t\t\t\tconst hasSupportedPasteTranslator = clipboardContext.hasSupportedPasteTranslator(\r\n\t\t\t\t\t\t\t\tpasteTranslatorManifests,\r\n\t\t\t\t\t\t\t\tclipboardEntryDetail.values,\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\tif (!hasSupportedPasteTranslator) {\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tconst pasteTranslator = await valueResolver.getPasteTranslator(\r\n\t\t\t\t\t\t\t\tclipboardEntryDetail.values,\r\n\t\t\t\t\t\t\t\tUMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS,\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\tif (pasteTranslator.isCompatibleValue) {\r\n\t\t\t\t\t\t\t\tconst value = await valueResolver.resolve(\r\n\t\t\t\t\t\t\t\t\tclipboardEntryDetail.values,\r\n\t\t\t\t\t\t\t\t\tUMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS,\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\treturn pasteTranslator.isCompatibleValue(value, config);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\toriginData: {\r\n\t\t\t\t\t\t\tindex: index,\r\n\t\t\t\t\t\t\tareaKey: this.#areaKey,\r\n\t\t\t\t\t\t\tparentUnique: this.#parentUnique,\r\n\t\t\t\t\t\t} as UmbBlockGridWorkspaceOriginData,\r\n\t\t\t\t\t\tcreateBlockInWorkspace: this._manager.getInlineEditingMode() === false,\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.onSubmit(async (value, data) => {\r\n\t\t\t\tif (value?.create && data) {\r\n\t\t\t\t\tconst created = await this.create(\r\n\t\t\t\t\t\tvalue.create.contentElementTypeKey,\r\n\t\t\t\t\t\t// We can parse an empty object, cause the rest will be filled in by others.\r\n\t\t\t\t\t\t{} as any,\r\n\t\t\t\t\t\tdata.originData as UmbBlockGridWorkspaceOriginData,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (created) {\r\n\t\t\t\t\t\tawait this.insert(\r\n\t\t\t\t\t\t\tcreated.layout,\r\n\t\t\t\t\t\t\tcreated.content,\r\n\t\t\t\t\t\t\tcreated.settings,\r\n\t\t\t\t\t\t\tdata.originData as UmbBlockGridWorkspaceOriginData,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error('Failed to create block');\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (value?.clipboard && value.clipboard.selection?.length && data) {\r\n\t\t\t\t\tconst clipboardContext = await this.getContext(UMB_CLIPBOARD_PROPERTY_CONTEXT);\r\n\r\n\t\t\t\t\tconst propertyValues = await clipboardContext.readMultiple<UmbBlockGridValueModel>(\r\n\t\t\t\t\t\tvalue.clipboard.selection,\r\n\t\t\t\t\t\tUMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tthis._insertFromPropertyValues(propertyValues, data.originData as UmbBlockGridWorkspaceOriginData);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.observeRouteBuilder((routeBuilder) => {\r\n\t\t\t\t// TODO: Does it make any sense that this is a state? Check usage and confirm. [NL]\r\n\t\t\t\tthis._catalogueRouteBuilderState.setValue(routeBuilder);\r\n\t\t\t});\r\n\r\n\t\tnew UmbModalRouteRegistrationController(this, UMB_BLOCK_GRID_WORKSPACE_MODAL)\r\n\t\t\t.addAdditionalPath('block')\r\n\t\t\t.onSetup(() => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tentityType: 'block',\r\n\t\t\t\t\t\tpreset: {},\r\n\t\t\t\t\t\toriginData: {\r\n\t\t\t\t\t\t\tindex: -1,\r\n\t\t\t\t\t\t\tareaKey: this.#areaKey,\r\n\t\t\t\t\t\t\tparentUnique: this.#parentUnique,\r\n\t\t\t\t\t\t\tbaseDataPath: this._dataPath,\r\n\t\t\t\t\t\t} as UmbBlockGridWorkspaceOriginData,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmodal: { size: 'medium' },\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.observeRouteBuilder((routeBuilder) => {\r\n\t\t\t\tconst newPath = routeBuilder({});\r\n\t\t\t\tthis._workspacePath.setValue(newPath);\r\n\t\t\t});\r\n\t}\r\n\r\n\tprotected _gotBlockManager() {\r\n\t\tif (!this._manager) return;\r\n\r\n\t\tthis.#setupAllowedBlockTypes();\r\n\t\tthis.#setupRangeLimits();\r\n\t}\r\n\r\n\t#gotAreaKey() {\r\n\t\tif (this.#areaKey === undefined) return;\r\n\t\tthis.#gotBlockParentEntry();\r\n\t}\r\n\r\n\tasync #gotBlockParentEntry() {\r\n\t\tif (this.#areaKey === undefined) return;\r\n\r\n\t\tif (this.#areaKey === null) {\r\n\t\t\t// Root entries:\r\n\t\t\tawait this._retrieveManager;\r\n\t\t\tif (!this._manager) return;\r\n\r\n\t\t\tthis.removeUmbControllerByAlias('observeParentUnique');\r\n\t\t\tthis.setParentUnique(null);\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis._manager.layouts,\r\n\t\t\t\t(layouts) => {\r\n\t\t\t\t\tthis._layoutEntries.setValue(layouts);\r\n\t\t\t\t},\r\n\t\t\t\t'observeParentLayouts',\r\n\t\t\t);\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.layoutEntries,\r\n\t\t\t\t(layouts) => {\r\n\t\t\t\t\tthis._manager?.setLayouts(layouts);\r\n\t\t\t\t},\r\n\t\t\t\t'observeThisLayouts',\r\n\t\t\t);\r\n\r\n\t\t\tconst hostEl = this.getHostElement() as HTMLElement | undefined;\r\n\t\t\tif (hostEl) {\r\n\t\t\t\thostEl.removeAttribute('data-area-alias');\r\n\t\t\t\thostEl.removeAttribute('data-area-col-span');\r\n\t\t\t\thostEl.removeAttribute('data-area-row-span');\r\n\t\t\t\thostEl.style.removeProperty('--umb-block-grid--grid-columns');\r\n\t\t\t\thostEl.style.removeProperty('--umb-block-grid--area-column-span');\r\n\t\t\t\thostEl.style.removeProperty('--umb-block-grid--area-row-span');\r\n\t\t\t}\r\n\r\n\t\t\tthis.removeUmbControllerByAlias('observeAreaType');\r\n\t\t\tthis.#setupAllowedBlockTypes();\r\n\t\t\tthis.#setupRangeLimits();\r\n\t\t} else {\r\n\t\t\tif (!this.#parentEntry) return;\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#parentEntry.unique,\r\n\t\t\t\t(unique) => {\r\n\t\t\t\t\tthis.setParentUnique(unique ?? null);\r\n\t\t\t\t},\r\n\t\t\t\t'observeParentUnique',\r\n\t\t\t);\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#parentEntry.layoutsOfArea(this.#areaKey),\r\n\t\t\t\t(layouts) => {\r\n\t\t\t\t\tif (layouts) {\r\n\t\t\t\t\t\tthis._layoutEntries.setValue(layouts);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'observeParentLayouts',\r\n\t\t\t);\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.layoutEntries,\r\n\t\t\t\t(layouts) => {\r\n\t\t\t\t\tif (this.#areaKey) {\r\n\t\t\t\t\t\tthis.#parentEntry?.setLayoutsOfArea(this.#areaKey, layouts);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'observeThisLayouts',\r\n\t\t\t);\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#parentEntry.areaType(this.#areaKey),\r\n\t\t\t\t(areaType) => {\r\n\t\t\t\t\tthis.#areaType.setValue(areaType);\r\n\t\t\t\t\tconst hostEl = this.getHostElement() as HTMLElement | undefined;\r\n\t\t\t\t\tif (!hostEl) return;\r\n\t\t\t\t\thostEl.setAttribute('data-area-alias', areaType?.alias ?? '');\r\n\t\t\t\t\thostEl.setAttribute('data-area-col-span', areaType?.columnSpan?.toString() ?? '');\r\n\t\t\t\t\thostEl.setAttribute('data-area-row-span', areaType?.rowSpan?.toString() ?? '');\r\n\t\t\t\t\thostEl.style.setProperty('--umb-block-grid--grid-columns', areaType?.columnSpan?.toString() ?? '');\r\n\t\t\t\t\thostEl.style.setProperty('--umb-block-grid--area-column-span', areaType?.columnSpan?.toString() ?? '');\r\n\t\t\t\t\thostEl.style.setProperty('--umb-block-grid--area-row-span', areaType?.rowSpan?.toString() ?? '');\r\n\t\t\t\t\tthis.#setupAllowedBlockTypes();\r\n\t\t\t\t\tthis.#setupRangeLimits();\r\n\t\t\t\t},\r\n\t\t\t\t'observeAreaType',\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t#setupAllowedBlockTypes() {\r\n\t\tif (!this._manager) return;\r\n\t\tthis.#allowedBlockTypes.setValue(this.#retrieveAllowedElementTypes());\r\n\t\tthis.#setupAllowedBlockTypesLimits();\r\n\t}\r\n\t#setupRangeLimits() {\r\n\t\tif (!this._manager) return;\r\n\t\t//const range = this.#retrieveRangeLimits();\r\n\t\tif (this.#areaKey != null) {\r\n\t\t\tconst areaType = this.#areaType.getValue();\r\n\t\t\tthis.removeUmbControllerByAlias('observeConfigurationRootLimits');\r\n\t\t\t// Area entries:\r\n\t\t\tif (!areaType) return undefined;\r\n\t\t\t// No need to observe as this method is called every time the area is changed.\r\n\t\t\tthis.#rangeLimits.setValue({\r\n\t\t\t\tmin: areaType.minAllowed ?? 0,\r\n\t\t\t\tmax: areaType.maxAllowed ?? Infinity,\r\n\t\t\t});\r\n\t\t} else if (this.#areaKey === null) {\r\n\t\t\tif (!this._manager) return undefined;\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis._manager.editorConfiguration,\r\n\t\t\t\t(config) => {\r\n\t\t\t\t\tconst min = config?.getValueByAlias<UmbNumberRangeValueType>('validationLimit')?.min ?? 0;\r\n\t\t\t\t\tconst max = config?.getValueByAlias<UmbNumberRangeValueType>('validationLimit')?.max ?? Infinity;\r\n\t\t\t\t\tthis.#rangeLimits.setValue({ min, max });\r\n\t\t\t\t},\r\n\t\t\t\t'observeConfigurationRootLimits',\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tgetPathForCreateBlock(index: number) {\r\n\t\treturn this._catalogueRouteBuilderState.getValue()?.({ view: 'create', index: index });\r\n\t}\r\n\r\n\tgetPathForClipboard(index: number) {\r\n\t\treturn this._catalogueRouteBuilderState.getValue()?.({ view: 'clipboard', index: index });\r\n\t}\r\n\r\n\tisBlockTypeAllowed(contentTypeKey: string) {\r\n\t\treturn this.#allowedBlockTypes.asObservablePart((types) =>\r\n\t\t\ttypes.some((x) => x.contentElementTypeKey === contentTypeKey),\r\n\t\t);\r\n\t}\r\n\r\n\t/*\r\n\tasync setLayouts(layouts: Array<UmbBlockGridLayoutModel>) {\r\n\t\tawait this._retrieveManager;\r\n\t\tif (this.#areaKey === null) {\r\n\t\t\tthis._manager?.setLayouts(layouts);\r\n\t\t} else {\r\n\t\t\tif (!this.#parentUnique || !this.#areaKey) {\r\n\t\t\t\tthrow new Error('ParentUnique or AreaKey not set');\r\n\t\t\t}\r\n\t\t\tthis._manager?.setLayoutsOfArea(this.#parentUnique, this.#areaKey, layouts);\r\n\t\t}\r\n\t}\r\n\t*/\r\n\r\n\tasync create(\r\n\t\tcontentElementTypeKey: string,\r\n\t\tpartialLayoutEntry?: Omit<UmbBlockGridLayoutModel, 'contentKey'>,\r\n\t\toriginData?: UmbBlockGridWorkspaceOriginData,\r\n\t) {\r\n\t\tawait this._retrieveManager;\r\n\t\treturn await this._manager?.createWithPresets(contentElementTypeKey, partialLayoutEntry, originData);\r\n\t}\r\n\r\n\t// insert Block?\r\n\r\n\tasync insert(\r\n\t\tlayoutEntry: UmbBlockGridLayoutModel,\r\n\t\tcontent: UmbBlockDataModel,\r\n\t\tsettings: UmbBlockDataModel | undefined,\r\n\t\toriginData: UmbBlockGridWorkspaceOriginData,\r\n\t) {\r\n\t\tawait this._retrieveManager;\r\n\t\treturn this._manager?.insert(layoutEntry, content, settings, originData) ?? false;\r\n\t}\r\n\r\n\t// create Block?\r\n\toverride async delete(contentKey: string) {\r\n\t\t// TODO: Loop through children and delete them as well?\r\n\t\t// Find layout entry:\r\n\t\tconst layout = this._layoutEntries.getValue().find((x) => x.contentKey === contentKey);\r\n\t\tif (!layout) {\r\n\t\t\tthrow new Error(`Cannot delete block, missing layout for ${contentKey}`);\r\n\t\t}\r\n\t\t// The following loop will only delete the referenced data of sub Layout Entries, as the Layout entry is part of the main Layout Entry they will go away when that is removed. [NL]\r\n\t\tforEachBlockLayoutEntryOf(layout, async (entry) => {\r\n\t\t\tif (entry.settingsKey) {\r\n\t\t\t\tthis._manager!.removeOneSettings(entry.settingsKey);\r\n\t\t\t}\r\n\t\t\tthis._manager!.removeOneContent(contentKey);\r\n\t\t\tthis._manager!.removeExposesOf(contentKey);\r\n\t\t});\r\n\r\n\t\tawait super.delete(contentKey);\r\n\t}\r\n\r\n\tprotected async _insertFromPropertyValue(value: UmbBlockGridValueModel, originData: UmbBlockGridWorkspaceOriginData) {\r\n\t\tconst layoutEntries = value.layout[UMB_BLOCK_GRID_PROPERTY_EDITOR_SCHEMA_ALIAS];\r\n\r\n\t\tif (!layoutEntries) {\r\n\t\t\tthrow new Error('No layout entries found');\r\n\t\t}\r\n\r\n\t\tawait Promise.all(\r\n\t\t\tlayoutEntries.map(async (layoutEntry) => {\r\n\t\t\t\tawait this._insertBlockFromPropertyValue(layoutEntry, value, originData);\r\n\t\t\t\tif (originData.index !== -1) {\r\n\t\t\t\t\toriginData = { ...originData, index: originData.index + 1 };\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\treturn originData;\r\n\t}\r\n\r\n\tprotected override async _insertBlockFromPropertyValue(\r\n\t\tlayoutEntry: UmbBlockGridLayoutModel,\r\n\t\tvalue: UmbBlockGridValueModel,\r\n\t\toriginData: UmbBlockGridWorkspaceOriginData,\r\n\t) {\r\n\t\tawait super._insertBlockFromPropertyValue(layoutEntry, value, originData);\r\n\r\n\t\t// Handle inserting of the inner blocks..\r\n\t\tawait forEachBlockLayoutEntryOf(layoutEntry, async (entry, parentUnique, areaKey) => {\r\n\t\t\tconst localOriginData = { index: -1, parentUnique, areaKey };\r\n\t\t\tawait this._insertBlockFromPropertyValue(entry, value, localOriginData);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t * @returns {Array<UmbBlockGridTypeModel>} an Array of ElementTypeKeys that are allowed in the current area. Or undefined if not ready jet.\r\n\t */\r\n\t#retrieveAllowedElementTypes() {\r\n\t\tif (!this._manager) return [];\r\n\r\n\t\tif (this.#areaKey) {\r\n\t\t\tconst areaType = this.#areaType.getValue();\r\n\t\t\t// Area entries:\r\n\t\t\tif (!areaType) return [];\r\n\r\n\t\t\tif (areaType.specifiedAllowance && areaType.specifiedAllowance?.length > 0) {\r\n\t\t\t\treturn (\r\n\t\t\t\t\tareaType.specifiedAllowance\r\n\t\t\t\t\t\t.flatMap((permission) => {\r\n\t\t\t\t\t\t\tif (permission.groupKey) {\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\tthis._manager?.getBlockTypes().filter((blockType) => blockType.groupKey === permission.groupKey) ?? []\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t} else if (permission.elementTypeKey) {\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\tthis._manager?.getBlockTypes().filter((x) => x.contentElementTypeKey === permission.elementTypeKey) ??\r\n\t\t\t\t\t\t\t\t\t[]\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn [];\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t// Remove duplicates:\r\n\t\t\t\t\t\t.filter((v, i, a) => a.findIndex((x) => x.contentElementTypeKey === v.contentElementTypeKey) === i)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// No specific permissions setup, so we will fallback to items allowed in areas:\r\n\t\t\treturn this._manager.getBlockTypes().filter((x) => x.allowInAreas);\r\n\t\t} else if (this.#areaKey === null) {\r\n\t\t\t// If AreaKey is null, then we are in the root, looking for items allowed as root:\r\n\t\t\treturn this._manager.getBlockTypes().filter((x) => x.allowAtRoot);\r\n\t\t}\r\n\r\n\t\treturn [];\r\n\t}\r\n\r\n\t/**\r\n\t * @internal\r\n\t */\r\n\t#setupAllowedBlockTypesLimits() {\r\n\t\tif (!this._manager) return;\r\n\r\n\t\tif (this.#areaKey) {\r\n\t\t\tconst areaType = this.#areaType.getValue();\r\n\t\t\t// Area entries:\r\n\t\t\tif (!areaType) return;\r\n\r\n\t\t\tif (areaType.specifiedAllowance && areaType.specifiedAllowance?.length > 0) {\r\n\t\t\t\tthis.#hasTypeLimits.setValue(true);\r\n\t\t\t}\r\n\t\t} else if (this.#areaKey === null) {\r\n\t\t\t// RESET\r\n\t\t}\r\n\t}\r\n\r\n\t// Property to hold the result of the check, used to make a meaningful Validation Message\r\n\t#invalidBlockTypeLimits?: Array<UmbBlockGridAreaTypeInvalidRuleType>;\r\n\r\n\tgetInvalidBlockTypeLimits() {\r\n\t\treturn this.#invalidBlockTypeLimits ?? [];\r\n\t}\r\n\t/**\r\n\t * @internal\r\n\t * @returns {boolean} - True if the block type limits are valid, otherwise false.\r\n\t */\r\n\tcheckBlockTypeLimitsValidity(): boolean {\r\n\t\tconst areaType = this.#areaType.getValue();\r\n\t\tif (!areaType || !areaType.specifiedAllowance) return false;\r\n\r\n\t\tconst layoutEntries = this._layoutEntries.getValue();\r\n\r\n\t\tthis.#invalidBlockTypeLimits = areaType.specifiedAllowance\r\n\t\t\t.map((rule) => {\r\n\t\t\t\tconst minAllowed = rule.minAllowed || 0;\r\n\t\t\t\tconst maxAllowed = rule.maxAllowed || 0;\r\n\r\n\t\t\t\t// For block groups:\r\n\t\t\t\tif (rule.groupKey) {\r\n\t\t\t\t\tconst groupElementTypeKeys =\r\n\t\t\t\t\t\tthis._manager\r\n\t\t\t\t\t\t\t?.getBlockTypes()\r\n\t\t\t\t\t\t\t.filter((blockType) => blockType.groupKey === rule.groupKey && blockType.allowInAreas === true)\r\n\t\t\t\t\t\t\t.map((x) => x.contentElementTypeKey) ?? [];\r\n\t\t\t\t\tconst groupAmount = layoutEntries.filter((entry) => {\r\n\t\t\t\t\t\tconst contentTypeKey = this._manager!.getContentTypeKeyOfContentKey(entry.contentKey);\r\n\t\t\t\t\t\treturn contentTypeKey ? groupElementTypeKeys.indexOf(contentTypeKey) !== -1 : false;\r\n\t\t\t\t\t}).length;\r\n\r\n\t\t\t\t\tif (groupAmount < minAllowed || (maxAllowed > 0 && groupAmount > maxAllowed)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tgroupKey: rule.groupKey,\r\n\t\t\t\t\t\t\tname: this._manager!.getBlockGroupName(rule.groupKey) ?? '?',\r\n\t\t\t\t\t\t\tamount: groupAmount,\r\n\t\t\t\t\t\t\tminRequirement: minAllowed,\r\n\t\t\t\t\t\t\tmaxRequirement: maxAllowed,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn undefined;\r\n\t\t\t\t}\r\n\t\t\t\t// For specific elementTypes:\r\n\t\t\t\telse if (rule.elementTypeKey) {\r\n\t\t\t\t\tconst amount = layoutEntries.filter((entry) => {\r\n\t\t\t\t\t\tconst contentTypeKey = this._manager!.getContentOf(entry.contentKey)?.contentTypeKey;\r\n\t\t\t\t\t\treturn contentTypeKey === rule.elementTypeKey;\r\n\t\t\t\t\t}).length;\r\n\t\t\t\t\tif (amount < minAllowed || (maxAllowed > 0 ? amount > maxAllowed : false)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tkey: rule.elementTypeKey,\r\n\t\t\t\t\t\t\tname: this._manager!.getContentTypeNameOf(rule.elementTypeKey) ?? '?',\r\n\t\t\t\t\t\t\tamount: amount,\r\n\t\t\t\t\t\t\tminRequirement: minAllowed,\r\n\t\t\t\t\t\t\tmaxRequirement: maxAllowed,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn undefined;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Lets fail cause the rule was bad.\r\n\t\t\t\tconsole.error('Invalid block type limit rule.', rule);\r\n\t\t\t\treturn undefined;\r\n\t\t\t})\r\n\t\t\t.filter((x) => x !== undefined) as Array<UmbBlockGridAreaTypeInvalidRuleType>;\r\n\t\treturn this.#invalidBlockTypeLimits.length === 0;\r\n\t}\r\n\r\n\t#invalidBlockTypeConfigurations?: Array<string>;\r\n\r\n\tgetInvalidBlockTypeConfigurations() {\r\n\t\treturn this.#invalidBlockTypeConfigurations ?? [];\r\n\t}\r\n\t/**\r\n\t * @internal\r\n\t * @returns {boolean} - True if the block type limits are valid, otherwise false.\r\n\t */\r\n\tcheckBlockTypeConfigurationValidity(): boolean {\r\n\t\tthis.#invalidBlockTypeConfigurations = [];\r\n\r\n\t\tconst layoutEntries = this._layoutEntries.getValue();\r\n\t\tif (layoutEntries.length === 0) return true;\r\n\r\n\t\t// Check all layout entries if they are allowed.\r\n\t\tconst allowedBlocks = this.#allowedBlockTypes.getValue();\r\n\t\tif (allowedBlocks.length === 0) return false;\r\n\r\n\t\tconst allowedKeys = allowedBlocks.map((x) => x.contentElementTypeKey);\r\n\t\t// get content for each layout entry:\r\n\t\tconst invalidEntries = layoutEntries.filter((entry) => {\r\n\t\t\tconst contentTypeKey = this._manager!.getContentTypeKeyOfContentKey(entry.contentKey);\r\n\t\t\tif (!contentTypeKey) {\r\n\t\t\t\t// We could not find the content type key, so we cant determin if this is valid or not when the content is missing.\r\n\t\t\t\t// This should be captured elsewhere as the Block then becomes invalid. So the unsupported Block should capture this.\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tconst isBad = allowedKeys.indexOf(contentTypeKey) === -1;\r\n\t\t\tif (contentTypeKey && isBad) {\r\n\t\t\t\t// if bad, then add the ContentTypeName to the list of invalids (if we could not find the name add the key)\r\n\t\t\t\tthis.#invalidBlockTypeConfigurations?.push(\r\n\t\t\t\t\tthis._manager?.getContentTypeNameOf(contentTypeKey) ?? contentTypeKey,\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\treturn isBad;\r\n\t\t});\r\n\r\n\t\treturn invalidEntries.length === 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Check if given contentKey is allowed in the current area.\r\n\t * @param {string} contentKey - The contentKey of the content to check.\r\n\t * @returns {boolean} - True if the content is allowed in the current area, otherwise false.\r\n\t */\r\n\tallowDrop(contentKey: string) {\r\n\t\tconst content = this._manager?.getContentOf(contentKey);\r\n\t\tconst allowedBlocks = this.#allowedBlockTypes.getValue();\r\n\t\tif (!content || !allowedBlocks) return false;\r\n\r\n\t\treturn allowedBlocks.map((x) => x.contentElementTypeKey).indexOf(content.contentTypeKey) !== -1;\r\n\t}\r\n\r\n\tonDragStart() {\r\n\t\tthis._manager?.onDragStart();\r\n\t}\r\n\r\n\tonDragEnd() {\r\n\t\tthis._manager?.onDragEnd();\r\n\t}\r\n}\r\n","import { closestColumnSpanOption, forEachBlockLayoutEntryOf } from '../utils/index.js';\r\nimport type { UmbBlockGridValueModel } from '../types.js';\r\nimport { UMB_BLOCK_GRID_PROPERTY_EDITOR_SCHEMA_ALIAS, UMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS } from '../constants.js';\r\nimport { UMB_BLOCK_GRID_MANAGER_CONTEXT } from './block-grid-manager.context-token.js';\r\nimport { UMB_BLOCK_GRID_ENTRIES_CONTEXT } from './block-grid-entries.context-token.js';\r\nimport {\r\n\ttype UmbBlockGridScalableContext,\r\n\tUmbBlockGridScaleManager,\r\n} from './block-grid-scale-manager/block-grid-scale-manager.controller.js';\r\nimport {\r\n\tUmbArrayState,\r\n\tUmbBooleanState,\r\n\tUmbNumberState,\r\n\tappendToFrozenArray,\r\n\tmergeObservables,\r\n\tobserveMultiple,\r\n} from '@umbraco-cms/backoffice/observable-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbBlockEntryContext } from '@umbraco-cms/backoffice/block';\r\nimport type { UmbBlockGridTypeModel, UmbBlockGridLayoutModel } from '@umbraco-cms/backoffice/block-grid';\r\nimport { UMB_PROPERTY_CONTEXT, UMB_PROPERTY_DATASET_CONTEXT } from '@umbraco-cms/backoffice/property';\r\nimport { UMB_CLIPBOARD_PROPERTY_CONTEXT } from '@umbraco-cms/backoffice/clipboard';\r\n\r\nexport class UmbBlockGridEntryContext\r\n\textends UmbBlockEntryContext<\r\n\t\ttypeof UMB_BLOCK_GRID_MANAGER_CONTEXT,\r\n\t\ttypeof UMB_BLOCK_GRID_MANAGER_CONTEXT.TYPE,\r\n\t\ttypeof UMB_BLOCK_GRID_ENTRIES_CONTEXT,\r\n\t\ttypeof UMB_BLOCK_GRID_ENTRIES_CONTEXT.TYPE,\r\n\t\tUmbBlockGridTypeModel,\r\n\t\tUmbBlockGridLayoutModel\r\n\t>\r\n\timplements UmbBlockGridScalableContext\r\n{\r\n\t//\r\n\treadonly columnSpan = this._layout.asObservablePart((x) => (x ? (x.columnSpan ?? null) : undefined));\r\n\treadonly rowSpan = this._layout.asObservablePart((x) => (x ? (x.rowSpan ?? null) : undefined));\r\n\treadonly layoutAreas = this._layout.asObservablePart((x) => x?.areas);\r\n\treadonly columnSpanOptions = this._blockType.asObservablePart((x) => x?.columnSpanOptions ?? []);\r\n\treadonly areaTypeGridColumns = this._blockType.asObservablePart((x) => x?.areaGridColumns);\r\n\treadonly areas = this._blockType.asObservablePart((x) => x?.areas ?? []);\r\n\treadonly minMaxRowSpan = this._blockType.asObservablePart((x) =>\r\n\t\tx ? [x.rowMinSpan ?? 1, x.rowMaxSpan ?? 1] : undefined,\r\n\t);\r\n\treadonly forceHideContentEditorInOverlay = this._blockType.asObservablePart((x) =>\r\n\t\tx ? (x.forceHideContentEditorInOverlay ?? false) : undefined,\r\n\t);\r\n\r\n\tpublic getMinMaxRowSpan(): [number, number] | undefined {\r\n\t\tconst x = this._blockType.getValue();\r\n\t\tif (!x) return undefined;\r\n\t\treturn [x.rowMinSpan ?? 1, x.rowMaxSpan ?? 1];\r\n\t}\r\n\treadonly inlineEditingMode = this._blockType.asObservablePart((x) => x?.inlineEditing === true);\r\n\r\n\t#relevantColumnSpanOptions = new UmbArrayState<number>([], (x) => x);\r\n\treadonly relevantColumnSpanOptions = this.#relevantColumnSpanOptions.asObservable();\r\n\tpublic getRelevantColumnSpanOptions() {\r\n\t\treturn this.#relevantColumnSpanOptions.getValue();\r\n\t}\r\n\r\n\t#canScale = new UmbBooleanState(false);\r\n\treadonly canScale = this.#canScale.asObservable();\r\n\r\n\t#isAllowed = new UmbBooleanState(false);\r\n\treadonly isAllowed = this.#isAllowed.asObservable();\r\n\r\n\t#areaGridColumns = new UmbNumberState(undefined);\r\n\treadonly areaGridColumns = this.#areaGridColumns.asObservable();\r\n\r\n\treadonly showContentEdit = mergeObservables(\r\n\t\t[this._contentStructureHasProperties, this.forceHideContentEditorInOverlay],\r\n\t\t([a, b]) => a === true && b === false,\r\n\t);\r\n\r\n\treadonly scaleManager = new UmbBlockGridScaleManager(this);\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_BLOCK_GRID_MANAGER_CONTEXT, UMB_BLOCK_GRID_ENTRIES_CONTEXT);\r\n\t}\r\n\r\n\tlayoutsOfArea(areaKey: string) {\r\n\t\treturn this._layout.asObservablePart((x) => x?.areas?.find((x) => x.key === areaKey)?.items);\r\n\t}\r\n\r\n\tareaType(areaKey: string) {\r\n\t\treturn this._blockType.asObservablePart((x) => x?.areas?.find((x) => x.key === areaKey));\r\n\t}\r\n\r\n\tsetLayoutsOfArea(areaKey: string, layouts: UmbBlockGridLayoutModel[]) {\r\n\t\tconst frozenValue = this._layout.value;\r\n\t\tif (!frozenValue) return;\r\n\t\tconst areas = appendToFrozenArray(\r\n\t\t\tfrozenValue?.areas ?? [],\r\n\t\t\t{\r\n\t\t\t\tkey: areaKey,\r\n\t\t\t\titems: layouts,\r\n\t\t\t},\r\n\t\t\t(x) => x.key,\r\n\t\t);\r\n\t\tthis._layout.update({ areas });\r\n\t}\r\n\r\n\t/**\r\n\t * Set the column span of this entry.\r\n\t * @param columnSpan {number} The new column span.\r\n\t */\r\n\tsetColumnSpan(columnSpan: number) {\r\n\t\tif (!this._entries) return;\r\n\t\tconst layoutColumns = this._entries.getLayoutColumns();\r\n\t\tif (!layoutColumns) return;\r\n\r\n\t\tcolumnSpan = this.#calcColumnSpan(columnSpan, this.getRelevantColumnSpanOptions(), layoutColumns);\r\n\t\tif (columnSpan === this.getColumnSpan()) return;\r\n\t\tconst layoutValue = this._layout.getValue();\r\n\t\tif (!layoutValue) return;\r\n\t\tthis._layout.setValue({\r\n\t\t\t...layoutValue,\r\n\t\t\tcolumnSpan,\r\n\t\t});\r\n\t}\r\n\t/**\r\n\t * Get the column span of this entry.\r\n\t * @returns {number} The column span.\r\n\t */\r\n\tgetColumnSpan() {\r\n\t\treturn this._layout.getValue()?.columnSpan;\r\n\t}\r\n\r\n\t/**\r\n\t * Set the row span of this entry.\r\n\t * @param rowSpan {number} The new row span.\r\n\t */\r\n\tsetRowSpan(rowSpan: number) {\r\n\t\tconst minMax = this.getMinMaxRowSpan();\r\n\t\tif (!minMax) return;\r\n\t\trowSpan = Math.max(minMax[0], Math.min(rowSpan, minMax[1]));\r\n\t\tif (rowSpan === this.getRowSpan()) return;\r\n\t\tconst layoutValue = this._layout.getValue();\r\n\t\tif (!layoutValue) return;\r\n\t\tthis._layout.setValue({\r\n\t\t\t...layoutValue,\r\n\t\t\trowSpan,\r\n\t\t});\r\n\t}\r\n\t/**\r\n\t * Get the row span of this entry.\r\n\t * @returns {number} The row span.\r\n\t */\r\n\tgetRowSpan() {\r\n\t\treturn this._layout.getValue()?.rowSpan;\r\n\t}\r\n\r\n\t_gotManager() {\r\n\t\tthis.#gotEntriesAndManager();\r\n\t}\r\n\r\n\t_gotEntries() {\r\n\t\tthis.scaleManager.setEntriesContext(this._entries);\r\n\t\tif (!this._entries) return;\r\n\r\n\t\tthis.#gotEntriesAndManager();\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.contentElementTypeKey,\r\n\t\t\t(key) => {\r\n\t\t\t\tthis.observe(\r\n\t\t\t\t\tkey ? this._entries?.isBlockTypeAllowed(key) : undefined,\r\n\t\t\t\t\t(isAllowed) => {\r\n\t\t\t\t\t\tif (isAllowed === undefined) return;\r\n\t\t\t\t\t\tthis.#isAllowed.setValue(isAllowed);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'observeIsAllowed',\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\t'observeContentElementTypeKey',\r\n\t\t);\r\n\r\n\t\t// Retrieve scale options:\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([this.minMaxRowSpan, this.columnSpanOptions, this._entries.layoutColumns]),\r\n\t\t\t([minMaxRowSpan, columnSpanOptions, layoutColumns]) => {\r\n\t\t\t\tif (!layoutColumns || !minMaxRowSpan) return;\r\n\t\t\t\tconst relevantColumnSpanOptions = columnSpanOptions\r\n\t\t\t\t\t? columnSpanOptions\r\n\t\t\t\t\t\t\t.filter((x) => x.columnSpan <= layoutColumns)\r\n\t\t\t\t\t\t\t.map((x) => x.columnSpan)\r\n\t\t\t\t\t\t\t.sort((a, b) => (a > b ? 1 : b > a ? -1 : 0))\r\n\t\t\t\t\t: [];\r\n\t\t\t\tthis.#relevantColumnSpanOptions.setValue(relevantColumnSpanOptions);\r\n\t\t\t\tconst hasRelevantColumnSpanOptions = relevantColumnSpanOptions.length > 1;\r\n\t\t\t\tconst hasRowSpanOptions = minMaxRowSpan[0] !== minMaxRowSpan[1];\r\n\t\t\t\tconst canScale = hasRelevantColumnSpanOptions || hasRowSpanOptions;\r\n\r\n\t\t\t\tthis.#canScale.setValue(canScale);\r\n\t\t\t},\r\n\t\t\t'observeScaleOptions',\r\n\t\t);\r\n\r\n\t\t// Retrieve The Grid Columns for the Areas:\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([this.areaTypeGridColumns, this._entries.layoutColumns]),\r\n\t\t\t([areaTypeGridColumns, layoutColumns]) => {\r\n\t\t\t\tthis.#areaGridColumns.setValue(areaTypeGridColumns ?? layoutColumns);\r\n\t\t\t},\r\n\t\t\t'observeAreaGridColumns',\r\n\t\t);\r\n\t}\r\n\r\n\t#gotEntriesAndManager() {\r\n\t\tif (!this._entries || !this._manager) return;\r\n\r\n\t\t// Secure areas fits options:\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([this.areas, this.layoutAreas]),\r\n\t\t\t([areas, layoutAreas]) => {\r\n\t\t\t\tif (!areas || !layoutAreas) return;\r\n\t\t\t\tconst areasAreIdentical =\r\n\t\t\t\t\tareas.length === layoutAreas.length && areas.every((area) => layoutAreas.some((y) => y.key === area.key));\r\n\t\t\t\tif (areasAreIdentical === false) {\r\n\t\t\t\t\tconst layoutValue = this._layout.getValue();\r\n\t\t\t\t\tif (!layoutValue) return;\r\n\t\t\t\t\tthis._layout.setValue({\r\n\t\t\t\t\t\t...layoutValue,\r\n\t\t\t\t\t\tareas: layoutAreas.map((x) => (areas.find((y) => y.key === x.key) ? x : { key: x.key, items: [] })),\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeAreaValidation',\r\n\t\t);\r\n\r\n\t\t// Secure columnSpan fits options:\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([this.columnSpan, this.relevantColumnSpanOptions, this._entries.layoutColumns]),\r\n\t\t\t([columnSpan, relevantColumnSpanOptions, layoutColumns]) => {\r\n\t\t\t\tif (!layoutColumns || columnSpan === undefined) return;\r\n\t\t\t\tconst newColumnSpan = this.#calcColumnSpan(\r\n\t\t\t\t\tcolumnSpan ?? layoutColumns,\r\n\t\t\t\t\trelevantColumnSpanOptions,\r\n\t\t\t\t\tlayoutColumns,\r\n\t\t\t\t);\r\n\t\t\t\tif (newColumnSpan !== columnSpan) {\r\n\t\t\t\t\tconst layoutValue = this._layout.getValue();\r\n\t\t\t\t\tif (!layoutValue) return;\r\n\t\t\t\t\tthis._layout.setValue({\r\n\t\t\t\t\t\t...layoutValue,\r\n\t\t\t\t\t\tcolumnSpan: newColumnSpan,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeColumnSpanValidation',\r\n\t\t);\r\n\r\n\t\t// Secure rowSpan fits options:\r\n\t\tthis.observe(\r\n\t\t\tobserveMultiple([this.minMaxRowSpan, this.rowSpan]),\r\n\t\t\t([minMax, rowSpan]) => {\r\n\t\t\t\tif (!minMax || rowSpan === undefined) return;\r\n\t\t\t\tconst newRowSpan = Math.max(minMax[0], Math.min(rowSpan ?? 1, minMax[1]));\r\n\t\t\t\tif (newRowSpan !== rowSpan) {\r\n\t\t\t\t\tconst layoutValue = this._layout.getValue();\r\n\t\t\t\t\tif (!layoutValue) return;\r\n\t\t\t\t\tthis._layout.setValue({\r\n\t\t\t\t\t\t...layoutValue,\r\n\t\t\t\t\t\trowSpan: newRowSpan,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'observeRowSpanValidation',\r\n\t\t);\r\n\t}\r\n\r\n\t_gotContentType() {}\r\n\r\n\t#calcColumnSpan(columnSpan: number, relevantColumnSpanOptions: number[], layoutColumns: number) {\r\n\t\tif (relevantColumnSpanOptions.length > 0) {\r\n\t\t\t// Correct to a columnSpan option.\r\n\t\t\tconst newColumnSpan =\r\n\t\t\t\tclosestColumnSpanOption(columnSpan, relevantColumnSpanOptions, layoutColumns) ?? layoutColumns;\r\n\t\t\tif (newColumnSpan !== columnSpan) {\r\n\t\t\t\treturn newColumnSpan;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Fallback to the layoutColumns.\r\n\t\t\treturn layoutColumns;\r\n\t\t}\r\n\t\treturn columnSpan;\r\n\t}\r\n\r\n\tasync copyToClipboard() {\r\n\t\tif (!this._manager) return;\r\n\r\n\t\tconst propertyDatasetContext = await this.getContext(UMB_PROPERTY_DATASET_CONTEXT);\r\n\t\tconst propertyContext = await this.getContext(UMB_PROPERTY_CONTEXT);\r\n\t\tconst clipboardContext = await this.getContext(UMB_CLIPBOARD_PROPERTY_CONTEXT);\r\n\r\n\t\tconst workspaceName = propertyDatasetContext?.getName();\r\n\t\tconst propertyLabel = propertyContext?.getLabel();\r\n\t\tconst blockLabel = this.getLabel();\r\n\r\n\t\tconst entryName = workspaceName\r\n\t\t\t? `${workspaceName} - ${propertyLabel} - ${blockLabel}`\r\n\t\t\t: `${propertyLabel} - ${blockLabel}`;\r\n\r\n\t\tconst layout = this.getLayout();\r\n\t\tif (!layout) {\r\n\t\t\tthrow new Error('No layout found');\r\n\t\t}\r\n\t\tconst content = this.getContent();\r\n\t\tconst settings = this.getSettings();\r\n\t\tconst expose = this.getExpose();\r\n\r\n\t\tconst contentData = content ? [structuredClone(content)] : [];\r\n\t\tconst settingsData = settings ? [structuredClone(settings)] : [];\r\n\t\tconst exposes = expose ? [structuredClone(expose)] : [];\r\n\r\n\t\t// Find sub Blocks and append their data:\r\n\t\tforEachBlockLayoutEntryOf(layout, async (entry) => {\r\n\t\t\tconst content = this._manager!.getContentOf(entry.contentKey);\r\n\t\t\tif (!content) {\r\n\t\t\t\tthrow new Error('No content found');\r\n\t\t\t}\r\n\t\t\tcontentData.push(structuredClone(content));\r\n\r\n\t\t\tif (entry.settingsKey) {\r\n\t\t\t\tconst settings = this._manager!.getSettingsOf(entry.settingsKey);\r\n\t\t\t\tif (settings) {\r\n\t\t\t\t\tsettingsData.push(structuredClone(settings));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst propertyValue: UmbBlockGridValueModel = {\r\n\t\t\tlayout: {\r\n\t\t\t\t[UMB_BLOCK_GRID_PROPERTY_EDITOR_SCHEMA_ALIAS]: layout ? [structuredClone(layout)] : undefined,\r\n\t\t\t},\r\n\t\t\tcontentData,\r\n\t\t\tsettingsData,\r\n\t\t\texpose: exposes,\r\n\t\t};\r\n\r\n\t\tclipboardContext.write({\r\n\t\t\ticon: this.getContentElementTypeIcon(),\r\n\t\t\tname: entryName,\r\n\t\t\tpropertyValue,\r\n\t\t\tpropertyEditorUiAlias: UMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS,\r\n\t\t});\r\n\t}\r\n}\r\n","import { UUIRefNodeElement } from '@umbraco-cms/backoffice/external/uui';\r\nimport { css, customElement, html } from '@umbraco-cms/backoffice/external/lit';\r\n\r\n/**\r\n * @element umb-ref-grid-block\r\n */\r\n@customElement('umb-ref-grid-block')\r\nexport class UmbRefGridBlockElement extends UUIRefNodeElement {\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t${super.render()}\r\n\t\t\t<div class=\"break\"></div>\r\n\t\t\t<slot name=\"areas\"></slot>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\t...UUIRefNodeElement.styles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tmin-width: 20px; /* Set to something, to overwrite UUI min width. */\r\n\t\t\t\theight: 100%; /* Help to fill out the whole layout entry. */\r\n\t\t\t\tmin-height: var(--uui-size-16);\r\n\t\t\t\tflex-flow: row wrap;\r\n\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\t\t\t}\r\n\r\n\t\t\t.break {\r\n\t\t\t\tflex-basis: 100%;\r\n\t\t\t\theight: 0;\r\n\t\t\t}\r\n\r\n\t\t\t#open-part {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tmin-height: var(--uui-size-16);\r\n\t\t\t\tpadding: calc(var(--uui-size-2) + 1px);\r\n\t\t\t}\r\n\r\n\t\t\t:host([unpublished]) #open-part {\r\n\t\t\t\topacity: 0.6;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbRefGridBlockElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-ref-grid-block': UmbRefGridBlockElement;\r\n\t}\r\n}\r\n","import { UMB_BLOCK_GRID_ENTRY_CONTEXT } from '../../context/block-grid-entry.context-token.js';\r\nimport type { UmbBlockGridWorkspaceOriginData } from '../../workspace/block-grid-workspace.modal-token.js';\r\nimport { UMB_BLOCK_GRID_ENTRIES_CONTEXT } from '../../context/block-grid-entries.context-token.js';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { css, customElement, html, nothing, property, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { UmbPropertyTypeModel } from '@umbraco-cms/backoffice/content-type';\r\nimport '../block-grid-areas-container/index.js';\r\nimport '../ref-grid-block/index.js';\r\nimport type { UmbBlockEditorCustomViewConfiguration } from '@umbraco-cms/backoffice/block-custom-view';\r\nimport {\r\n\ttype UMB_BLOCK_WORKSPACE_CONTEXT,\r\n\tUMB_BLOCK_WORKSPACE_ALIAS,\r\n\ttype UmbBlockDataType,\r\n} from '@umbraco-cms/backoffice/block';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport {\r\n\tUmbExtensionApiInitializer,\r\n\tUmbExtensionsApiInitializer,\r\n\ttype UmbApiConstructorArgumentsMethodType,\r\n} from '@umbraco-cms/backoffice/extension-api';\r\nimport { UmbLanguageItemRepository } from '@umbraco-cms/backoffice/language';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbDataPathPropertyValueQuery } from '@umbraco-cms/backoffice/validation';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\n\r\nconst apiArgsCreator: UmbApiConstructorArgumentsMethodType<unknown> = (manifest: unknown) => {\r\n\treturn [{ manifest }];\r\n};\r\n\r\n@customElement('umb-block-grid-block-inline')\r\nexport class UmbBlockGridBlockInlineElement extends UmbLitElement {\r\n\t//\r\n\t#blockContext?: typeof UMB_BLOCK_GRID_ENTRY_CONTEXT.TYPE;\r\n\t#workspaceContext?: typeof UMB_BLOCK_WORKSPACE_CONTEXT.TYPE;\r\n\t#variantId: UmbVariantId | undefined;\r\n\t#contentKey?: string;\r\n\t#parentUnique?: string | null;\r\n\t#areaKey?: string | null;\r\n\r\n\t@property({ attribute: false })\r\n\tconfig?: UmbBlockEditorCustomViewConfiguration;\r\n\r\n\t@property({ type: String, reflect: false })\r\n\tlabel?: string;\r\n\r\n\t@property({ type: String, reflect: false })\r\n\ticon?: string;\r\n\r\n\t@property({ type: Boolean, reflect: true })\r\n\tunpublished?: boolean;\r\n\r\n\t@property({ attribute: false })\r\n\tcontent?: UmbBlockDataType;\r\n\r\n\t@state()\r\n\t_inlineProperty?: UmbPropertyTypeModel;\r\n\r\n\t@state()\r\n\t_inlinePropertyDataPath?: string;\r\n\r\n\t@state()\r\n\tprivate _ownerContentTypeName?: string;\r\n\r\n\t@state()\r\n\tprivate _variantName?: string;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_BLOCK_GRID_ENTRY_CONTEXT, (blockContext) => {\r\n\t\t\tthis.#blockContext = blockContext;\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#blockContext.unique,\r\n\t\t\t\t(contentKey) => {\r\n\t\t\t\t\tthis.#contentKey = contentKey;\r\n\t\t\t\t\tthis.#load();\r\n\t\t\t\t},\r\n\t\t\t\t'observeContentKey',\r\n\t\t\t);\r\n\t\t});\r\n\t\tthis.consumeContext(UMB_BLOCK_GRID_ENTRIES_CONTEXT, (entriesContext) => {\r\n\t\t\tthis.#parentUnique = entriesContext.getParentUnique();\r\n\t\t\tthis.#areaKey = entriesContext.getAreaKey();\r\n\t\t});\r\n\t\tnew UmbExtensionApiInitializer(\r\n\t\t\tthis,\r\n\t\t\tumbExtensionsRegistry,\r\n\t\t\tUMB_BLOCK_WORKSPACE_ALIAS,\r\n\t\t\tapiArgsCreator,\r\n\t\t\t(permitted, ctrl) => {\r\n\t\t\t\tconst context = ctrl.api as typeof UMB_BLOCK_WORKSPACE_CONTEXT.TYPE | undefined;\r\n\t\t\t\tif (permitted && context) {\r\n\t\t\t\t\t// Risky business, cause here we are lucky that it seems to be consumed and set before this is called and there for this is acceptable for now. [NL]\r\n\t\t\t\t\tif (this.#parentUnique === undefined || this.#areaKey === undefined) {\r\n\t\t\t\t\t\tthrow new Error('Parent unique and area key must be defined');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.#workspaceContext = context;\r\n\t\t\t\t\tcontext.setOriginData({\r\n\t\t\t\t\t\tareaKey: this.#areaKey,\r\n\t\t\t\t\t\tparentUnique: this.#parentUnique,\r\n\t\t\t\t\t} as UmbBlockGridWorkspaceOriginData);\r\n\t\t\t\t\tthis.#workspaceContext.establishLiveSync();\r\n\r\n\t\t\t\t\tthis.#load();\r\n\r\n\t\t\t\t\tthis.observe(\r\n\t\t\t\t\t\tthis.#workspaceContext.content.structure.contentTypeProperties,\r\n\t\t\t\t\t\t(contentTypeProperties) => {\r\n\t\t\t\t\t\t\tthis._inlineProperty = contentTypeProperties[0];\r\n\t\t\t\t\t\t\tthis.#generatePropertyDataPath();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'observeProperties',\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tthis.observe(\r\n\t\t\t\t\t\tcontext.content.structure.ownerContentTypeName,\r\n\t\t\t\t\t\t(name) => {\r\n\t\t\t\t\t\t\tthis._ownerContentTypeName = name;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'observeContentTypeName',\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tthis.observe(\r\n\t\t\t\t\t\tcontext.variantId,\r\n\t\t\t\t\t\tasync (variantId) => {\r\n\t\t\t\t\t\t\tthis.#variantId = variantId;\r\n\t\t\t\t\t\t\tthis.#generatePropertyDataPath();\r\n\t\t\t\t\t\t\tif (variantId) {\r\n\t\t\t\t\t\t\t\tcontext.content.setup(this, variantId);\r\n\t\t\t\t\t\t\t\tconst culture = variantId.culture;\r\n\t\t\t\t\t\t\t\tif (culture) {\r\n\t\t\t\t\t\t\t\t\tconst languageRepository = new UmbLanguageItemRepository(this);\r\n\t\t\t\t\t\t\t\t\tconst { data } = await languageRepository.requestItems([culture]);\r\n\t\t\t\t\t\t\t\t\tconst name = data?.[0].name;\r\n\t\t\t\t\t\t\t\t\tthis._variantName = name ? this.localize.string(name) : undefined;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'observeVariant',\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tnew UmbExtensionsApiInitializer(this, umbExtensionsRegistry, 'workspaceContext', [this.#workspaceContext]);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t);\r\n\t}\r\n\r\n\t#load() {\r\n\t\tif (!this.#workspaceContext || !this.#contentKey) return;\r\n\t\tthis.#workspaceContext.load(this.#contentKey);\r\n\t}\r\n\r\n\t#generatePropertyDataPath() {\r\n\t\tif (!this.#variantId || !this._inlineProperty) return;\r\n\t\tconst property = this._inlineProperty;\r\n\t\tthis._inlinePropertyDataPath = `$.values[${UmbDataPathPropertyValueQuery({\r\n\t\t\talias: property.alias,\r\n\t\t\tculture: property.variesByCulture ? this.#variantId!.culture : null,\r\n\t\t\tsegment: property.variesBySegment ? this.#variantId!.segment : null,\r\n\t\t})}].value`;\r\n\t}\r\n\r\n\t#expose = () => {\r\n\t\tthis.#workspaceContext?.expose();\r\n\t};\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<div id=\"host\">\r\n\t\t\t\t<button id=\"open-part\" tabindex=\"0\">\r\n\t\t\t\t\t${this.#renderBlockInfo()}\r\n\t\t\t\t\t<slot></slot>\r\n\t\t\t\t\t<slot name=\"tag\"></slot>\r\n\t\t\t\t</button>\r\n\t\t\t\t${this.#renderInside()}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderBlockInfo() {\r\n\t\treturn html`\r\n\t\t\t<span id=\"content\">\r\n\t\t\t\t<span id=\"icon\">\r\n\t\t\t\t\t<umb-icon .name=${this.icon}></umb-icon>\r\n\t\t\t\t</span>\r\n\t\t\t\t<div id=\"info\">\r\n\t\t\t\t\t<umb-ufm-render id=\"name\" inline .markdown=${this.label} .value=${this.content}></umb-ufm-render>\r\n\t\t\t\t</div>\r\n\t\t\t</span>\r\n\t\t\t${this.unpublished\r\n\t\t\t\t? html`<uui-tag slot=\"name\" look=\"secondary\" title=${this.localize.term('blockEditor_notExposedDescription')}\r\n\t\t\t\t\t\t><umb-localize key=\"blockEditor_notExposedLabel\"></umb-localize\r\n\t\t\t\t\t></uui-tag>`\r\n\t\t\t\t: nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderInside() {\r\n\t\tif (this.unpublished === true) {\r\n\t\t\treturn html`<uui-button id=\"exposeButton\" @click=${this.#expose}\r\n\t\t\t\t><uui-icon name=\"icon-add\"></uui-icon>\r\n\t\t\t\t<umb-localize\r\n\t\t\t\t\tkey=\"blockEditor_createThisFor\"\r\n\t\t\t\t\t.args=${[this._ownerContentTypeName, this._variantName]}></umb-localize\r\n\t\t\t></uui-button>`;\r\n\t\t} else {\r\n\t\t\treturn html`<div id=\"inside\" draggable=\"false\">\r\n\t\t\t\t<umb-property-type-based-property\r\n\t\t\t\t\t.property=${this._inlineProperty}\r\n\t\t\t\t\t.dataPath=${this._inlinePropertyDataPath ?? ''}\r\n\t\t\t\t\tslot=\"areas\"></umb-property-type-based-property>\r\n\t\t\t\t<umb-block-grid-areas-container slot=\"areas\" draggable=\"false\"></umb-block-grid-areas-container>\r\n\t\t\t</div>`;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\tumb-block-grid-areas-container {\r\n\t\t\t\tmargin-top: calc(var(--uui-size-2) + 1px);\r\n\t\t\t}\r\n\t\t\tumb-block-grid-areas-container::part(area) {\r\n\t\t\t\tmargin: var(--uui-size-2);\r\n\t\t\t}\r\n\r\n\t\t\t#exposeButton {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tmin-height: var(--uui-size-16);\r\n\t\t\t}\r\n\r\n\t\t\t#host {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t\ttransition: border-color 80ms;\r\n\r\n\t\t\t\tmin-width: 250px;\r\n\t\t\t}\r\n\t\t\t#open-part + * {\r\n\t\t\t\tborder-top: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\t\t\t:host([disabled]) #open-part {\r\n\t\t\t\tcursor: default;\r\n\t\t\t\ttransition: border-color 80ms;\r\n\t\t\t}\r\n\t\t\t:host(:not([disabled])) #host:has(#open-part:hover) {\r\n\t\t\t\tborder-color: var(--uui-color-border-emphasis);\r\n\t\t\t}\r\n\t\t\t:host(:not([disabled])) #open-part:hover + * {\r\n\t\t\t\tborder-color: var(--uui-color-border-emphasis);\r\n\t\t\t}\r\n\t\t\t:host([disabled]) #host {\r\n\t\t\t\tborder-color: var(--uui-color-disabled-standalone);\r\n\t\t\t}\r\n\r\n\t\t\t:host([unpublished]) #open-part #content {\r\n\t\t\t\topacity: 0.6;\r\n\t\t\t}\r\n\r\n\t\t\tslot[name='tag'] {\r\n\t\t\t\tflex-grow: 1;\r\n\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t\talign-items: center;\r\n\t\t\t}\r\n\r\n\t\t\tbutton {\r\n\t\t\t\tfont-size: inherit;\r\n\t\t\t\tfont-family: inherit;\r\n\t\t\t\tborder: 0;\r\n\t\t\t\tpadding: 0;\r\n\t\t\t\tbackground-color: transparent;\r\n\t\t\t\ttext-align: left;\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t}\r\n\r\n\t\t\t#content {\r\n\t\t\t\talign-self: stretch;\r\n\t\t\t\tline-height: normal;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tposition: relative;\r\n\t\t\t\talign-items: center;\r\n\t\t\t}\r\n\r\n\t\t\t#open-part {\r\n\t\t\t\tcolor: inherit;\r\n\t\t\t\ttext-decoration: none;\r\n\t\t\t\tcursor: pointer;\r\n\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\ttext-align: left;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: flex-start;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tborder: none;\r\n\t\t\t\tbackground: none;\r\n\r\n\t\t\t\tmin-height: var(--uui-size-16);\r\n\t\t\t\tpadding: calc(var(--uui-size-2) + 1px);\r\n\t\t\t}\r\n\r\n\t\t\t#icon {\r\n\t\t\t\tfont-size: 1.2em;\r\n\t\t\t\tmargin-left: var(--uui-size-2);\r\n\t\t\t\tmargin-right: var(--uui-size-1);\r\n\t\t\t}\r\n\r\n\t\t\t#info {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: start;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tpadding-left: var(--uui-size-2, 6px);\r\n\t\t\t}\r\n\r\n\t\t\t#name {\r\n\t\t\t\tfont-weight: 700;\r\n\t\t\t}\r\n\r\n\t\t\tuui-tag {\r\n\t\t\t\tmargin-left: 0.5em;\r\n\t\t\t\tmargin-bottom: -0.3em;\r\n\t\t\t\tmargin-top: -0.3em;\r\n\t\t\t\tvertical-align: text-top;\r\n\t\t\t}\r\n\r\n\t\t\t:host(:not([disabled])) #open-part:hover #icon {\r\n\t\t\t\tcolor: var(--uui-color-interactive-emphasis);\r\n\t\t\t}\r\n\t\t\t:host(:not([disabled])) #open-part:hover #name {\r\n\t\t\t\tcolor: var(--uui-color-interactive-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\t:host([disabled]) #icon {\r\n\t\t\t\tcolor: var(--uui-color-disabled-contrast);\r\n\t\t\t}\r\n\t\t\t:host([disabled]) #name {\r\n\t\t\t\tcolor: var(--uui-color-disabled-contrast);\r\n\t\t\t}\r\n\r\n\t\t\t#inside {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tpadding: calc(var(--uui-size-layout-1));\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockGridBlockInlineElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-grid-block-inline': UmbBlockGridBlockInlineElement;\r\n\t}\r\n}\r\n","import { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { css, customElement, html } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\n\r\nimport '../block-grid-areas-container/index.js';\r\nimport '../ref-grid-block/index.js';\r\n\r\n@customElement('umb-block-grid-block-unsupported')\r\nexport class UmbBlockGridBlockUnsupportedElement extends UmbLitElement {\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<div id=\"host\">\r\n\t\t\t\t<div id=\"open-part\">\r\n\t\t\t\t\t${this.#renderBlockInfo()}\r\n\t\t\t\t\t<slot></slot>\r\n\t\t\t\t\t<slot name=\"tag\"></slot>\r\n\t\t\t\t</div>\r\n\t\t\t\t${this.#renderInside()}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderBlockInfo() {\r\n\t\treturn html`\r\n\t\t\t<span id=\"content\">\r\n\t\t\t\t<span id=\"icon\">\r\n\t\t\t\t\t<umb-icon name=\"icon-alert\"></umb-icon>\r\n\t\t\t\t</span>\r\n\t\t\t\t<div id=\"info\">\r\n\t\t\t\t\t<span id=\"name\">${this.localize.term('blockEditor_unsupportedBlockName')}</span>\r\n\t\t\t\t</div>\r\n\t\t\t</span>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderInside() {\r\n\t\treturn html`<div id=\"inside\" draggable=\"false\">\r\n\t\t\t${this.localize.term('blockEditor_unsupportedBlockDescription')}\r\n\t\t\t<umb-block-grid-areas-container slot=\"areas\"></umb-block-grid-areas-container>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\tumb-block-grid-areas-container {\r\n\t\t\t\tmargin-top: calc(var(--uui-size-2) + 1px);\r\n\t\t\t}\r\n\t\t\tumb-block-grid-areas-container::part(area) {\r\n\t\t\t\tmargin: var(--uui-size-2);\r\n\t\t\t}\r\n\r\n\t\t\t#exposeButton {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tmin-height: var(--uui-size-16);\r\n\t\t\t}\r\n\r\n\t\t\t#host {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t\ttransition: border-color 80ms;\r\n\r\n\t\t\t\tmin-width: 250px;\r\n\t\t\t}\r\n\t\t\t#open-part + * {\r\n\t\t\t\tborder-top: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\t\t\t#open-part {\r\n\t\t\t\tcursor: default;\r\n\t\t\t\ttransition: border-color 80ms;\r\n\t\t\t}\r\n\t\t\t#host {\r\n\t\t\t\tborder-color: var(--uui-color-disabled-standalone);\r\n\t\t\t}\r\n\r\n\t\t\t:host([unpublished]) #open-part #content {\r\n\t\t\t\topacity: 0.6;\r\n\t\t\t}\r\n\r\n\t\t\tslot[name='tag'] {\r\n\t\t\t\tflex-grow: 1;\r\n\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t\talign-items: center;\r\n\t\t\t}\r\n\r\n\t\t\t#content {\r\n\t\t\t\talign-self: stretch;\r\n\t\t\t\tline-height: normal;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tposition: relative;\r\n\t\t\t\talign-items: center;\r\n\t\t\t}\r\n\r\n\t\t\t#open-part {\r\n\t\t\t\tcolor: inherit;\r\n\t\t\t\ttext-decoration: none;\r\n\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\ttext-align: left;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: flex-start;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tborder: none;\r\n\t\t\t\tbackground: none;\r\n\r\n\t\t\t\tmin-height: var(--uui-size-16);\r\n\t\t\t\tpadding: calc(var(--uui-size-2) + 1px);\r\n\t\t\t}\r\n\r\n\t\t\t#icon {\r\n\t\t\t\tfont-size: 1.2em;\r\n\t\t\t\tmargin-left: var(--uui-size-2);\r\n\t\t\t\tmargin-right: var(--uui-size-1);\r\n\t\t\t}\r\n\r\n\t\t\t#info {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: start;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tpadding-left: var(--uui-size-2, 6px);\r\n\t\t\t}\r\n\r\n\t\t\t#name {\r\n\t\t\t\tfont-weight: 700;\r\n\t\t\t}\r\n\r\n\t\t\tuui-tag {\r\n\t\t\t\tmargin-left: 0.5em;\r\n\t\t\t\tmargin-bottom: -0.3em;\r\n\t\t\t\tmargin-top: -0.3em;\r\n\t\t\t\tvertical-align: text-top;\r\n\t\t\t}\r\n\r\n\t\t\t#inside {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tpadding: calc(var(--uui-size-layout-1));\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockGridBlockUnsupportedElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-grid-block-unsupported': UmbBlockGridBlockUnsupportedElement;\r\n\t}\r\n}\r\n","import { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { html, css, customElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { UmbPropertyEditorUiElement } from '@umbraco-cms/backoffice/property-editor';\r\n\r\n/**\r\n * @element umb-block-scale-handler\r\n */\r\n@customElement('umb-block-scale-handler')\r\nexport class UmbBlockGridScaleHandlerElement extends UmbLitElement implements UmbPropertyEditorUiElement {\r\n\t//\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.addEventListener('dragstart', (e: DragEvent) => {\r\n\t\t\te.preventDefault();\r\n\t\t});\r\n\t\tthis.addEventListener('dragstart', (e: DragEvent) => {\r\n\t\t\te.preventDefault();\r\n\t\t});\r\n\t}\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<button aria-label=\"TODO: Some introduction to keyboard scaling\" id=\"handler\"></button>\r\n\t\t\t<slot id=\"label\"></slot>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tinset: 0;\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t}\r\n\t\t\t:host(:focus-within),\r\n\t\t\t:host(:hover) {\r\n\t\t\t\tborder: var(--uui-color-interactive) solid 1px;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t}\r\n\r\n\t\t\t#handler {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\t// TODO: Look at the feature I out-commented here, what was that suppose to do [NL]:\r\n\t\t\t\t//display: var(--umb-block-grid--block-ui-display, block);\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tz-index: 2;\r\n\r\n\t\t\t\tpointer-events: all;\r\n\t\t\t\tcursor: nwse-resize;\r\n\r\n\t\t\t\tbottom: -4px;\r\n\t\t\t\tright: -4px;\r\n\t\t\t\twidth: 7px;\r\n\t\t\t\theight: 7px;\r\n\t\t\t\tpadding: 0;\r\n\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\t\t\t\tborder: var(--uui-color-interactive) solid 1px;\r\n\t\t\t\tbox-shadow: 0 0 0 1px rgba(255, 255, 255, 0.7);\r\n\t\t\t\topacity: 0;\r\n\t\t\t\ttransition: opacity 120ms;\r\n\t\t\t}\r\n\t\t\t#handler:hover,\r\n\t\t\t#handler:focus {\r\n\t\t\t\topacity: 1;\r\n\t\t\t}\r\n\t\t\t#handler:focus {\r\n\t\t\t\toutline: 2px solid var(--uui-color-selected);\r\n\t\t\t\toutline-offset: 1px;\r\n\t\t\t}\r\n\t\t\t#handler::after {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tinset: -10px;\r\n\t\t\t\tbackground-color: rgba(0, 0, 0, 0);\r\n\t\t\t}\r\n\t\t\t#handler:focus + #label,\r\n\t\t\t#handler:hover + #label {\r\n\t\t\t\topacity: 1;\r\n\t\t\t}\r\n\r\n\t\t\t#label {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\ttop: 100%;\r\n\t\t\t\tleft: 100%;\r\n\t\t\t\tmargin-left: 6px;\r\n\t\t\t\tmargin-top: 6px;\r\n\t\t\t\tz-index: 2;\r\n\r\n\t\t\t\tbackground-color: white;\r\n\t\t\t\tcolor: black;\r\n\t\t\t\tfont-size: 12px;\r\n\t\t\t\tpadding: 0px 6px;\r\n\t\t\t\tborder-radius: 3px;\r\n\t\t\t\topacity: 0;\r\n\t\t\t\ttransition: opacity 120ms;\r\n\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t}\r\n\r\n\t\t\t:host([scale-mode]) > #handler {\r\n\t\t\t\topacity: 1;\r\n\t\t\t}\r\n\t\t\t:host([scale-mode]) > #label {\r\n\t\t\t\topacity: 1;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockGridScaleHandlerElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-scale-handler': UmbBlockGridScaleHandlerElement;\r\n\t}\r\n}\r\n","import { UmbBlockGridEntryContext } from '../../context/block-grid-entry.context.js';\r\nimport type { UmbBlockGridLayoutModel } from '../../types.js';\r\nimport { UMB_BLOCK_GRID } from '../../constants.js';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { html, css, customElement, property, state, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { PropertyValueMap } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { UmbPropertyEditorUiElement } from '@umbraco-cms/backoffice/property-editor';\r\nimport { stringOrStringArrayContains } from '@umbraco-cms/backoffice/utils';\r\n\r\nimport '../block-grid-block-inline/index.js';\r\nimport '../block-grid-block-unsupported/index.js';\r\nimport '../block-grid-block/index.js';\r\nimport '../block-scale-handler/index.js';\r\nimport { UmbObserveValidationStateController } from '@umbraco-cms/backoffice/validation';\r\nimport { UmbDataPathBlockElementDataQuery } from '@umbraco-cms/backoffice/block';\r\nimport type {\r\n\tManifestBlockEditorCustomView,\r\n\tUmbBlockEditorCustomViewProperties,\r\n} from '@umbraco-cms/backoffice/block-custom-view';\r\nimport { UUIBlinkAnimationValue, UUIBlinkKeyframes } from '@umbraco-cms/backoffice/external/uui';\r\nimport type { UmbExtensionElementInitializer } from '@umbraco-cms/backoffice/extension-api';\r\n\r\n/**\r\n * @element umb-block-grid-entry\r\n */\r\n@customElement('umb-block-grid-entry')\r\nexport class UmbBlockGridEntryElement extends UmbLitElement implements UmbPropertyEditorUiElement {\r\n\t//\r\n\t@property({ type: Number, reflect: true })\r\n\tpublic get index(): number | undefined {\r\n\t\treturn this.#context.getIndex();\r\n\t}\r\n\tpublic set index(value: number | undefined) {\r\n\t\tthis.#context.setIndex(value);\r\n\t}\r\n\r\n\t@property({ attribute: false })\r\n\tpublic get contentKey(): string | undefined {\r\n\t\treturn this._contentKey;\r\n\t}\r\n\tpublic set contentKey(key: string | undefined) {\r\n\t\tif (!key || key === this._contentKey) return;\r\n\t\tthis._contentKey = key;\r\n\t\tthis._blockViewProps.contentKey = key;\r\n\t\tthis.setAttribute('data-element-key', key);\r\n\t\tthis.#context.setContentKey(key);\r\n\r\n\t\tnew UmbObserveValidationStateController(\r\n\t\t\tthis,\r\n\t\t\t`$.contentData[${UmbDataPathBlockElementDataQuery({ key: key })}]`,\r\n\t\t\t(hasMessages) => {\r\n\t\t\t\tthis._contentInvalid = hasMessages;\r\n\t\t\t\tthis._blockViewProps.contentInvalid = hasMessages;\r\n\t\t\t},\r\n\t\t\t'observeMessagesForContent',\r\n\t\t);\r\n\t}\r\n\tprivate _contentKey?: string | undefined;\r\n\t//\r\n\r\n\t#context = new UmbBlockGridEntryContext(this);\r\n\t#renderTimeout: number | undefined;\r\n\r\n\t@state()\r\n\t_contentTypeAlias?: string;\r\n\r\n\t@state()\r\n\t_contentTypeName?: string;\r\n\r\n\t@state()\r\n\t_columnSpan?: number;\r\n\r\n\t@state()\r\n\t_rowSpan?: number;\r\n\r\n\t@state()\r\n\t_showContentEdit = false;\r\n\t@state()\r\n\t_hasSettings = false;\r\n\r\n\t// If _createPath is undefined, its because no blocks are allowed to be created here[NL]\r\n\t@state()\r\n\t_createBeforePath?: string;\r\n\t@state()\r\n\t_createAfterPath?: string;\r\n\r\n\t@state()\r\n\t_label = '';\r\n\r\n\t@state()\r\n\t_icon?: string;\r\n\r\n\t@state()\r\n\t_exposed?: boolean;\r\n\r\n\t// Unuspported is triggerede if the Block Type is not reconized, it can also be triggerede by the Content Element Type not existing any longer. [NL]\r\n\t@state()\r\n\t_unsupported?: boolean;\r\n\r\n\t@state()\r\n\t_workspaceEditContentPath?: string;\r\n\r\n\t@state()\r\n\t_workspaceEditSettingsPath?: string;\r\n\r\n\t@state()\r\n\t_inlineEditingMode?: boolean;\r\n\r\n\t@state()\r\n\t_canScale?: boolean;\r\n\t@state()\r\n\t_showInlineCreateBefore?: boolean;\r\n\t@state()\r\n\t_showInlineCreateAfter?: boolean;\r\n\t@state()\r\n\t_inlineCreateAboveWidth?: string;\r\n\r\n\t// If the Block Type is disallowed in this location then it become a invalid Block Type. Notice not supported blocks are determined via the unsupported property. [NL]\r\n\t@property({ type: Boolean, attribute: 'location-invalid', reflect: true })\r\n\t_invalidLocation?: boolean;\r\n\r\n\t// 'content-invalid' attribute is used for styling purpose.\r\n\t@property({ type: Boolean, attribute: 'content-invalid', reflect: true })\r\n\t_contentInvalid?: boolean;\r\n\r\n\t// 'settings-invalid' attribute is used for styling purpose.\r\n\t@property({ type: Boolean, attribute: 'settings-invalid', reflect: true })\r\n\t_settingsInvalid?: boolean;\r\n\r\n\t@state()\r\n\t_blockViewProps: UmbBlockEditorCustomViewProperties<UmbBlockGridLayoutModel> = {\r\n\t\tcontentKey: undefined!,\r\n\t\tconfig: { showContentEdit: false, showSettingsEdit: false },\r\n\t}; // Set to undefined cause it will be set before we render.\r\n\r\n\t#updateBlockViewProps(incoming: Partial<UmbBlockEditorCustomViewProperties<UmbBlockGridLayoutModel>>) {\r\n\t\tthis._blockViewProps = { ...this._blockViewProps, ...incoming };\r\n\t\tthis.requestUpdate('_blockViewProps');\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _isReadOnly = false;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.#init();\r\n\t}\r\n\t#init() {\r\n\t\t// Misc:\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.showContentEdit,\r\n\t\t\t(showContentEdit) => {\r\n\t\t\t\tthis._showContentEdit = showContentEdit;\r\n\t\t\t\tthis.#updateBlockViewProps({ config: { ...this._blockViewProps.config!, showContentEdit } });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.settingsElementTypeKey,\r\n\t\t\t(key) => {\r\n\t\t\t\tthis._hasSettings = !!key;\r\n\t\t\t\tthis.#updateBlockViewProps({ config: { ...this._blockViewProps.config!, showSettingsEdit: !!key } });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.canScale,\r\n\t\t\t(canScale) => {\r\n\t\t\t\tthis._canScale = canScale;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.isAllowed,\r\n\t\t\t(isAllowed) => {\r\n\t\t\t\tthis._invalidLocation = !isAllowed;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.blockType,\r\n\t\t\t(blockType) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ blockType });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\t// TODO: Implement index.\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.label,\r\n\t\t\t(label) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ label });\r\n\t\t\t\tthis._label = label;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.contentElementTypeIcon,\r\n\t\t\t(icon) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ icon });\r\n\t\t\t\tthis._icon = icon;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.hasExpose,\r\n\t\t\t(exposed) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ unpublished: !exposed });\r\n\t\t\t\tthis._exposed = exposed;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.unsupported,\r\n\t\t\t(unsupported) => {\r\n\t\t\t\tif (unsupported === undefined) return;\r\n\t\t\t\tthis.#updateBlockViewProps({ unsupported: unsupported });\r\n\t\t\t\tthis._unsupported = unsupported;\r\n\t\t\t\tthis.toggleAttribute('unsupported', unsupported);\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.inlineEditingMode,\r\n\t\t\t(mode) => {\r\n\t\t\t\tthis._inlineEditingMode = mode;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\t// Data:\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.layout,\r\n\t\t\t(layout) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ layout });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.#observeData();\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.settingsKey,\r\n\t\t\t(settingsKey) => {\r\n\t\t\t\tthis.removeUmbControllerByAlias('observeMessagesForSettings');\r\n\t\t\t\tif (settingsKey) {\r\n\t\t\t\t\t// Observe settings validation state:\r\n\t\t\t\t\tnew UmbObserveValidationStateController(\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\t`$.settingsData[${UmbDataPathBlockElementDataQuery({ key: settingsKey })}]`,\r\n\t\t\t\t\t\t(hasMessages) => {\r\n\t\t\t\t\t\t\tthis._settingsInvalid = hasMessages;\r\n\t\t\t\t\t\t\tthis._blockViewProps.settingsInvalid = hasMessages;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'observeMessagesForSettings',\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\t// Paths:\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.createBeforePath,\r\n\t\t\t(createPath) => {\r\n\t\t\t\tthis._createBeforePath = createPath;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.createAfterPath,\r\n\t\t\t(createPath) => {\r\n\t\t\t\tthis._createAfterPath = createPath;\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.workspaceEditContentPath,\r\n\t\t\t(path) => {\r\n\t\t\t\tthis._workspaceEditContentPath = path;\r\n\t\t\t\tthis.#updateBlockViewProps({ config: { ...this._blockViewProps.config!, editContentPath: path } });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.workspaceEditSettingsPath,\r\n\t\t\t(path) => {\r\n\t\t\t\tthis._workspaceEditSettingsPath = path;\r\n\t\t\t\tthis.#updateBlockViewProps({ config: { ...this._blockViewProps.config!, editSettingsPath: path } });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.readOnlyState.isReadOnly,\r\n\t\t\t(isReadOnly) => (this._isReadOnly = isReadOnly),\r\n\t\t\t'umbReadonlyObserver',\r\n\t\t);\r\n\t}\r\n\r\n\tasync #observeData() {\r\n\t\tthis.observe(\r\n\t\t\tawait this.#context.contentValues(),\r\n\t\t\t(content) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ content });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tawait this.#context.settingsValues(),\r\n\t\t\t(settings) => {\r\n\t\t\t\tthis.#updateBlockViewProps({ settings });\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t}\r\n\r\n\toverride connectedCallback(): void {\r\n\t\tsuper.connectedCallback();\r\n\t\t// element styling:\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.columnSpan,\r\n\t\t\t(columnSpan) => {\r\n\t\t\t\tthis._columnSpan = columnSpan;\r\n\t\t\t\tthis.setAttribute('data-col-span', columnSpan ? columnSpan.toString() : '');\r\n\t\t\t\tthis.style.setProperty('--umb-block-grid--item-column-span', columnSpan ? columnSpan.toString() : '');\r\n\t\t\t},\r\n\t\t\t'columnSpan',\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.rowSpan,\r\n\t\t\t(rowSpan) => {\r\n\t\t\t\tthis._rowSpan = rowSpan;\r\n\t\t\t\tthis.setAttribute('data-row-span', rowSpan ? rowSpan.toString() : '');\r\n\t\t\t\tthis.style.setProperty('--umb-block-grid--item-row-span', rowSpan ? rowSpan.toString() : '');\r\n\t\t\t},\r\n\t\t\t'rowSpan',\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.contentElementTypeKey,\r\n\t\t\t(contentElementTypeKey) => {\r\n\t\t\t\tif (contentElementTypeKey) {\r\n\t\t\t\t\tthis.setAttribute('data-content-element-type-key', contentElementTypeKey);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'contentElementTypeKey',\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.contentElementTypeAlias,\r\n\t\t\t(contentElementTypeAlias) => {\r\n\t\t\t\tif (contentElementTypeAlias) {\r\n\t\t\t\t\tthis._contentTypeAlias = contentElementTypeAlias;\r\n\t\t\t\t\tthis.setAttribute('data-content-element-type-alias', contentElementTypeAlias);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'contentElementTypeAlias',\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.contentElementTypeName,\r\n\t\t\t(contentElementTypeName) => {\r\n\t\t\t\tthis._contentTypeName = contentElementTypeName;\r\n\t\t\t},\r\n\t\t\t'contentElementTypeName',\r\n\t\t);\r\n\r\n\t\tthis.#callUpdateInlineCreateButtons();\r\n\t}\r\n\r\n\tprotected override updated(_changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>): void {\r\n\t\tsuper.updated(_changedProperties);\r\n\t\tif (_changedProperties.has('_blockViewProps') || _changedProperties.has('_columnSpan')) {\r\n\t\t\tthis.#callUpdateInlineCreateButtons();\r\n\t\t}\r\n\t}\r\n\r\n\t#expose = () => {\r\n\t\tthis.#context.expose();\r\n\t};\r\n\r\n\t#callUpdateInlineCreateButtons() {\r\n\t\tclearTimeout(this.#renderTimeout);\r\n\t\tthis.#renderTimeout = setTimeout(this.#updateInlineCreateButtons, 100) as unknown as number;\r\n\t}\r\n\r\n\t#updateInlineCreateButtons = () => {\r\n\t\t// TODO: Could we optimize this, so it wont break?, cause currently we trust blindly that parentElement is '.umb-block-grid__layout-container' [NL]\r\n\t\tconst layoutContainer = this.parentElement;\r\n\t\tif (!layoutContainer) return;\r\n\t\tconst layoutContainerRect = layoutContainer.getBoundingClientRect();\r\n\r\n\t\tif (layoutContainerRect.width === 0) {\r\n\t\t\tthis._showInlineCreateBefore = false;\r\n\t\t\tthis._showInlineCreateAfter = false;\r\n\t\t\tthis._inlineCreateAboveWidth = undefined;\r\n\t\t\tthis.#renderTimeout = setTimeout(this.#updateInlineCreateButtons, 100) as unknown as number;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst layoutItemRect = this.getBoundingClientRect();\r\n\t\tif (layoutItemRect.right > layoutContainerRect.right - 5) {\r\n\t\t\tthis._showInlineCreateAfter = false;\r\n\t\t} else {\r\n\t\t\tthis._showInlineCreateAfter = true;\r\n\t\t}\r\n\r\n\t\tif (layoutItemRect.left > layoutContainerRect.left + 5) {\r\n\t\t\tthis._showInlineCreateBefore = false;\r\n\t\t\tthis._inlineCreateAboveWidth = undefined;\r\n\t\t} else {\r\n\t\t\tthis._inlineCreateAboveWidth = getComputedStyle(layoutContainer).width;\r\n\t\t\tthis._showInlineCreateBefore = true;\r\n\t\t}\r\n\t};\r\n\r\n\t#extensionSlotFilterMethod = (manifest: ManifestBlockEditorCustomView) => {\r\n\t\tif (!this._contentTypeAlias) {\r\n\t\t\t// accept no extensions if we don't have a content type alias\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t// We do have _contentTypeAlias at this stage, cause we do use the filter method in the extension slot which first gets rendered when we have the _contentTypeAlias. [NL]\r\n\t\tif (\r\n\t\t\tmanifest.forContentTypeAlias &&\r\n\t\t\t!stringOrStringArrayContains(manifest.forContentTypeAlias, this._contentTypeAlias!)\r\n\t\t) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (manifest.forBlockEditor && !stringOrStringArrayContains(manifest.forBlockEditor, UMB_BLOCK_GRID)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n\r\n\t#extensionSlotRenderMethod = (ext: UmbExtensionElementInitializer<ManifestBlockEditorCustomView>) => {\r\n\t\tif (ext.component) {\r\n\t\t\text.component.classList.add('umb-block-grid__block--view');\r\n\t\t}\r\n\t\tif (this._exposed) {\r\n\t\t\treturn ext.component;\r\n\t\t} else {\r\n\t\t\treturn html`<div>\r\n\t\t\t\t${ext.component}\r\n\t\t\t\t<umb-block-overlay-expose-button\r\n\t\t\t\t\t.contentTypeName=${this._contentTypeName}\r\n\t\t\t\t\t@click=${this.#expose}></umb-block-overlay-expose-button>\r\n\t\t\t</div>`;\r\n\t\t}\r\n\t};\r\n\r\n\toverride render() {\r\n\t\treturn this.contentKey && (this._contentTypeAlias || this._unsupported)\r\n\t\t\t? html`\r\n\t\t\t\t\t${this.#renderCreateBeforeInlineButton()}\r\n\t\t\t\t\t<div class=\"umb-block-grid__block\" part=\"umb-block-grid__block\">\r\n\t\t\t\t\t\t<umb-extension-slot\r\n\t\t\t\t\t\t\t.filter=${this.#extensionSlotFilterMethod}\r\n\t\t\t\t\t\t\t.renderMethod=${this.#extensionSlotRenderMethod}\r\n\t\t\t\t\t\t\t.props=${this._blockViewProps}\r\n\t\t\t\t\t\t\tdefault-element=${this._inlineEditingMode ? 'umb-block-grid-block-inline' : 'umb-block-grid-block'}\r\n\t\t\t\t\t\t\ttype=\"blockEditorCustomView\"\r\n\t\t\t\t\t\t\tsingle\r\n\t\t\t\t\t\t\t>${this.#renderBuiltinBlockView()}</umb-extension-slot\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t${this.#renderActionBar()}\r\n\t\t\t\t\t\t${!this._showContentEdit && this._contentInvalid\r\n\t\t\t\t\t\t\t? html`<uui-badge attention color=\"danger\" label=\"Invalid content\">!</uui-badge>`\r\n\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t\t${this._invalidLocation\r\n\t\t\t\t\t\t\t? html`<uui-tag id=\"invalidLocation\" color=\"danger\"\r\n\t\t\t\t\t\t\t\t\t><umb-localize key=\"blockEditor_invalidDropPosition\" .args=${[this._label]}></umb-localize\r\n\t\t\t\t\t\t\t\t></uui-tag>`\r\n\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t\t${this._canScale\r\n\t\t\t\t\t\t\t? html` <umb-block-scale-handler\r\n\t\t\t\t\t\t\t\t\t@mousedown=${(e: MouseEvent) => this.#context.scaleManager.onScaleMouseDown(e)}>\r\n\t\t\t\t\t\t\t\t\t${this._columnSpan}x${this._rowSpan}\r\n\t\t\t\t\t\t\t\t</umb-block-scale-handler>`\r\n\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t${this.#renderCreateAfterInlineButton()}\r\n\t\t\t\t`\r\n\t\t\t: nothing;\r\n\t}\r\n\r\n\t#renderBuiltinBlockView() {\r\n\t\tif (this._unsupported) {\r\n\t\t\treturn this.#renderUnsupportedBlock();\r\n\t\t}\r\n\t\tif (this._inlineEditingMode) {\r\n\t\t\treturn this.renderInlineBlock();\r\n\t\t}\r\n\t\treturn this.#renderRefBlock();\r\n\t}\r\n\r\n\t#renderUnsupportedBlock() {\r\n\t\treturn html`<umb-block-grid-block-unsupported\r\n\t\t\tclass=\"umb-block-grid__block--view\"\r\n\t\t\t.config=${this._blockViewProps.config}\r\n\t\t\t.content=${this._blockViewProps.content}\r\n\t\t\t.settings=${this._blockViewProps.settings}></umb-block-grid-block-unsupported>`;\r\n\t\t//TODO: investigate if we should have ${umbDestroyOnDisconnect()} here. Note how it works for drag n' drop in grid between areas and areas-root\r\n\t}\r\n\r\n\trenderInlineBlock() {\r\n\t\treturn html`<umb-block-grid-block-inline\r\n\t\t\tclass=\"umb-block-grid__block--view\"\r\n\t\t\t.label=${this._label}\r\n\t\t\t.icon=${this._icon}\r\n\t\t\t.unpublished=${!this._exposed}\r\n\t\t\t.config=${this._blockViewProps.config}\r\n\t\t\t.content=${this._blockViewProps.content}\r\n\t\t\t.settings=${this._blockViewProps.settings}></umb-block-grid-block-inline>`;\r\n\t\t//TODO: investigate if we should have ${umbDestroyOnDisconnect()} here. Note how it works for drag n' drop in grid between areas and areas-root\r\n\t}\r\n\r\n\t#renderRefBlock() {\r\n\t\treturn html`<umb-block-grid-block\r\n\t\t\tclass=\"umb-block-grid__block--view\"\r\n\t\t\t.label=${this._label}\r\n\t\t\t.icon=${this._icon}\r\n\t\t\t.unpublished=${!this._exposed}\r\n\t\t\t.config=${this._blockViewProps.config}\r\n\t\t\t.content=${this._blockViewProps.content}\r\n\t\t\t.settings=${this._blockViewProps.settings}></umb-block-grid-block>`;\r\n\t\t//TODO: investigate if we should have ${umbDestroyOnDisconnect()} here. Note how it works for drag n' drop in grid between areas and areas-root\r\n\t}\r\n\r\n\t#renderCreateBeforeInlineButton() {\r\n\t\tif (this._isReadOnly) return nothing;\r\n\t\tif (!this._createBeforePath) return nothing;\r\n\t\tif (!this._showInlineCreateBefore) return nothing;\r\n\r\n\t\treturn html`<uui-button-inline-create\r\n\t\t\thref=${this._createBeforePath}\r\n\t\t\tlabel=${this.localize.term('blockEditor_addBlock')}\r\n\t\t\tstyle=${this._inlineCreateAboveWidth\r\n\t\t\t\t? `width: ${this._inlineCreateAboveWidth}`\r\n\t\t\t\t: ''}></uui-button-inline-create>`;\r\n\t}\r\n\r\n\t#renderCreateAfterInlineButton() {\r\n\t\tif (this._isReadOnly) return nothing;\r\n\t\tif (!this._createAfterPath) return nothing;\r\n\t\tif (!this._showInlineCreateAfter) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-button-inline-create\r\n\t\t\t\tvertical\r\n\t\t\t\tlabel=${this.localize.term('blockEditor_addBlock')}\r\n\t\t\t\thref=${this._createAfterPath}></uui-button-inline-create>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderActionBar() {\r\n\t\treturn html`\r\n\t\t\t<uui-action-bar>\r\n\t\t\t\t${this.#renderEditAction()} ${this.#renderEditSettingsAction()} ${this.#renderCopyToClipboardAction()}\r\n\t\t\t\t${this.#renderDeleteAction()}</uui-action-bar\r\n\t\t\t>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderEditAction() {\r\n\t\treturn this._showContentEdit && this._workspaceEditContentPath\r\n\t\t\t? html`<uui-button\r\n\t\t\t\t\tlabel=\"edit\"\r\n\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\tcolor=${this._contentInvalid ? 'danger' : ''}\r\n\t\t\t\t\thref=${this._workspaceEditContentPath}>\r\n\t\t\t\t\t<uui-icon name=${this._exposed === false ? 'icon-add' : 'icon-edit'}></uui-icon>\r\n\t\t\t\t\t${this._contentInvalid\r\n\t\t\t\t\t\t? html`<uui-badge attention color=\"danger\" label=\"Invalid content\">!</uui-badge>`\r\n\t\t\t\t\t\t: nothing}\r\n\t\t\t\t</uui-button>`\r\n\t\t\t: this._showContentEdit === false && this._exposed === false\r\n\t\t\t\t? html`<uui-button\r\n\t\t\t\t\t\t@click=${this.#expose}\r\n\t\t\t\t\t\tlabel=${this.localize.term('blockEditor_createThisFor', this._contentTypeName)}\r\n\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\t><uui-icon name=\"icon-add\"></uui-icon\r\n\t\t\t\t\t></uui-button>`\r\n\t\t\t\t: nothing;\r\n\t}\r\n\r\n\t#renderEditSettingsAction() {\r\n\t\treturn html`\r\n\t\t\t${this._hasSettings && this._workspaceEditSettingsPath\r\n\t\t\t\t? html`<uui-button\r\n\t\t\t\t\t\tlabel=\"Edit settings\"\r\n\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\tcolor=${this._settingsInvalid ? 'danger' : ''}\r\n\t\t\t\t\t\thref=${this._workspaceEditSettingsPath}>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-settings\"></uui-icon>\r\n\t\t\t\t\t\t${this._settingsInvalid\r\n\t\t\t\t\t\t\t? html`<uui-badge attention color=\"danger\" label=\"Invalid settings\">!</uui-badge>`\r\n\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t</uui-button>`\r\n\t\t\t\t: nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderCopyToClipboardAction() {\r\n\t\treturn html`<uui-button label=\"Copy to clipboard\" look=\"secondary\" @click=${() => this.#context.copyToClipboard()}>\r\n\t\t\t<uui-icon name=\"icon-clipboard-copy\"></uui-icon>\r\n\t\t</uui-button>`;\r\n\t}\r\n\r\n\t#renderDeleteAction() {\r\n\t\tif (this._isReadOnly) return nothing;\r\n\t\treturn html`\r\n\t\t\t<uui-button label=\"delete\" look=\"secondary\" @click=${() => this.#context.requestDelete()}>\r\n\t\t\t\t<uui-icon name=\"icon-remove\"></uui-icon>\r\n\t\t\t</uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUUIBlinkKeyframes,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\t--umb-block-grid-entry-actions-opacity: 0;\r\n\t\t\t}\r\n\r\n\t\t\t:host([settings-invalid]),\r\n\t\t\t:host([content-invalid]),\r\n\t\t\t:host(:hover),\r\n\t\t\t:host(:focus-within) {\r\n\t\t\t\t--umb-block-grid-entry-actions-opacity: 1;\r\n\t\t\t}\r\n\r\n\t\t\t:host::after {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tz-index: 1;\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\tinset: 0;\r\n\t\t\t\tborder: 1px solid transparent;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\r\n\t\t\t\ttransition: border-color 240ms ease-in;\r\n\t\t\t}\r\n\r\n\t\t\t:host([location-invalid])::after,\r\n\t\t\t:host([settings-invalid])::after,\r\n\t\t\t:host([content-invalid])::after {\r\n\t\t\t\tborder-color: var(--uui-color-danger);\r\n\t\t\t}\r\n\r\n\t\t\t#invalidLocation {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: -1em;\r\n\t\t\t\tleft: var(--uui-size-space-2);\r\n\t\t\t\tz-index: 2;\r\n\t\t\t}\r\n\r\n\t\t\tuui-action-bar {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: var(--uui-size-2);\r\n\t\t\t\tright: var(--uui-size-2);\r\n\t\t\t\topacity: var(--umb-block-grid-entry-actions-opacity, 0);\r\n\t\t\t\ttransition: opacity 120ms;\r\n\t\t\t}\r\n\t\t\tuui-button-inline-create {\r\n\t\t\t\ttop: 0px;\r\n\t\t\t\tposition: absolute;\r\n\r\n\t\t\t\t--umb-block-grid__block--inline-create-button-display--condition: var(--umb-block-grid--dragging-mode) none;\r\n\t\t\t\tdisplay: var(--umb-block-grid__block--inline-create-button-display--condition);\r\n\t\t\t}\r\n\t\t\tuui-button-inline-create:not([vertical]) {\r\n\t\t\t\tleft: 0;\r\n\t\t\t\twidth: var(--umb-block-grid-editor--inline-create-width, 100%);\r\n\t\t\t}\r\n\t\t\t:host(:not([index='0'])) uui-button-inline-create:not([vertical]) {\r\n\t\t\t\ttop: calc(var(--umb-block-grid--row-gap, 0px) * -0.5);\r\n\t\t\t}\r\n\t\t\tuui-button-inline-create[vertical] {\r\n\t\t\t\tright: calc(1px - (var(--umb-block-grid--column-gap, 0px) * 0.5));\r\n\t\t\t}\r\n\r\n\t\t\t.umb-block-grid__block {\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t:host(:hover):not(:drop)::after {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tborder-color: var(--uui-color-interactive-emphasis);\r\n\t\t\t\tbox-shadow:\r\n\t\t\t\t\t0 0 0 1px rgba(255, 255, 255, 0.7),\r\n\t\t\t\t\tinset 0 0 0 1px rgba(255, 255, 255, 0.7);\r\n\t\t\t}\r\n\r\n\t\t\t:host([drag-placeholder])::after {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tborder-width: 2px;\r\n\t\t\t\tborder-color: var(--uui-color-interactive-emphasis);\r\n\t\t\t\tanimation: ${UUIBlinkAnimationValue};\r\n\t\t\t}\r\n\t\t\t:host([drag-placeholder])::before {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\tinset: 0;\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t\tbackground-color: var(--uui-color-interactive-emphasis);\r\n\t\t\t\topacity: 0.12;\r\n\t\t\t}\r\n\t\t\t:host([drag-placeholder]) .umb-block-grid__block {\r\n\t\t\t\ttransition: opacity 50ms 16ms;\r\n\t\t\t\topacity: 0;\r\n\t\t\t}\r\n\r\n\t\t\tuui-badge {\r\n\t\t\t\tz-index: 2;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockGridEntryElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-grid-entry': UmbBlockGridEntryElement;\r\n\t}\r\n}\r\n","import { UmbBlockGridEntriesContext } from '../../context/block-grid-entries.context.js';\r\nimport type { UmbBlockGridEntryElement } from '../block-grid-entry/index.js';\r\nimport type { UmbBlockGridLayoutModel } from '../../types.js';\r\nimport {\r\n\tgetAccumulatedValueOfIndex,\r\n\tgetInterpolatedIndexOfPositionInWeightMap,\r\n\tisWithinRect,\r\n} from '@umbraco-cms/backoffice/utils';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { html, customElement, state, repeat, css, property, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport '../block-grid-entry/index.js';\r\nimport {\r\n\tUmbSorterController,\r\n\ttype UmbSorterConfig,\r\n\ttype UmbSorterResolvePlacementArgs,\r\n} from '@umbraco-cms/backoffice/sorter';\r\nimport {\r\n\tUmbFormControlMixin,\r\n\tUmbFormControlValidator,\r\n\ttype UmbFormControlValidatorConfig,\r\n} from '@umbraco-cms/backoffice/validation';\r\nimport type { UmbNumberRangeValueType } from '@umbraco-cms/backoffice/models';\r\n\r\n/**\r\n * Notice this utility method is not really shareable with others as it also takes areas into account. [NL]\r\n * @param args\r\n * @returns { null | true }\r\n */\r\nfunction resolvePlacementAsBlockGrid(\r\n\targs: UmbSorterResolvePlacementArgs<UmbBlockGridLayoutModel, UmbBlockGridEntryElement>,\r\n) {\r\n\t// If this has areas, we do not want to move, unless we are at the edge\r\n\tif (\r\n\t\targs.relatedModel.areas &&\r\n\t\targs.relatedModel.areas.length > 0 &&\r\n\t\tisWithinRect(args.pointerX, args.pointerY, args.relatedRect, -10)\r\n\t) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/** We need some data about the grid to figure out if there is room to be placed next to the found element */\r\n\tconst approvedContainerComputedStyles = getComputedStyle(args.containerElement);\r\n\tconst gridColumnGap = Number(approvedContainerComputedStyles.columnGap.split('px')[0]) || 0;\r\n\tconst gridColumnNumber = parseInt(\r\n\t\tapprovedContainerComputedStyles.getPropertyValue('--umb-block-grid--grid-columns'),\r\n\t\t10,\r\n\t);\r\n\r\n\tconst foundElColumns = parseInt(args.relatedElement.dataset.colSpan ?? '', 10);\r\n\tconst currentElementColumns = args.item.columnSpan;\r\n\r\n\tif (currentElementColumns >= gridColumnNumber) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Get grid template:\r\n\tconst approvedContainerGridColumns = approvedContainerComputedStyles.gridTemplateColumns\r\n\t\t.trim()\r\n\t\t.split('px')\r\n\t\t.map((x) => Number(x))\r\n\t\t.filter((n) => n > 0)\r\n\t\t.map((n, i, list) => (list.length === i ? n : n + gridColumnGap));\r\n\r\n\t// ensure all columns are there.\r\n\t// This will also ensure handling non-css-grid mode,\r\n\t// use container width divided by amount of columns( or the item width divided by its amount of columnSpan)\r\n\tlet amountOfColumnsInWeightMap = approvedContainerGridColumns.length;\r\n\tconst amountOfUnknownColumns = gridColumnNumber - amountOfColumnsInWeightMap;\r\n\tif (amountOfUnknownColumns > 0) {\r\n\t\tconst accumulatedValue = getAccumulatedValueOfIndex(amountOfColumnsInWeightMap, approvedContainerGridColumns) || 0;\r\n\t\tconst missingColumnWidth = (args.containerRect.width - accumulatedValue) / amountOfUnknownColumns;\r\n\t\tif (missingColumnWidth > 0) {\r\n\t\t\twhile (amountOfColumnsInWeightMap++ < gridColumnNumber) {\r\n\t\t\t\tapprovedContainerGridColumns.push(missingColumnWidth);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tlet offsetPlacement = 0;\r\n\t/* If placeholder is in this same line, we want to assume that it will offset the placement of the found element,\r\n\twhich provides more potential space for the item to drop at.\r\n\tThis is relevant in this calculation where we look at the space to determine if its a vertical or horizontal drop in relation to the found element.\r\n\t*/\r\n\tif (args.placeholderIsInThisRow && args.elementRect.left < args.relatedRect.left) {\r\n\t\toffsetPlacement = -(args.elementRect.width + gridColumnGap);\r\n\t}\r\n\r\n\tconst relatedStartX = Math.max(args.relatedRect.left - args.containerRect.left + offsetPlacement, 0);\r\n\tconst relatedStartCol = Math.round(\r\n\t\tgetInterpolatedIndexOfPositionInWeightMap(relatedStartX, approvedContainerGridColumns),\r\n\t);\r\n\t// If the found related element does not have enough room after which for the current element, then we go vertical mode:\r\n\tconst verticalDirection = relatedStartCol + foundElColumns + currentElementColumns > gridColumnNumber;\r\n\treturn verticalDirection;\r\n\t/*\r\n\tlet placeAfter = args.horizontalPlaceAfter;\r\n\r\n\treturn {\r\n\t\tverticalDirection,\r\n\t\tplaceAfter,\r\n\t};*/\r\n}\r\n\r\n// --------------------------\r\n// End of utils.\r\n// --------------------------\r\n\r\nconst SORTER_CONFIG: UmbSorterConfig<UmbBlockGridLayoutModel, UmbBlockGridEntryElement> = {\r\n\tgetUniqueOfElement: (element) => {\r\n\t\treturn element.contentKey!;\r\n\t},\r\n\tgetUniqueOfModel: (modelEntry) => {\r\n\t\treturn modelEntry.contentKey;\r\n\t},\r\n\tresolvePlacement: resolvePlacementAsBlockGrid,\r\n\tidentifier: 'block-grid-editor',\r\n\titemSelector: 'umb-block-grid-entry',\r\n\tcontainerSelector: '.umb-block-grid__layout-container',\r\n};\r\n\r\n/**\r\n * @element umb-block-grid-entries\r\n */\r\n@customElement('umb-block-grid-entries')\r\nexport class UmbBlockGridEntriesElement extends UmbFormControlMixin(UmbLitElement) {\r\n\t//\r\n\t#sorter = new UmbSorterController<UmbBlockGridLayoutModel, UmbBlockGridEntryElement>(this, {\r\n\t\t...SORTER_CONFIG,\r\n\t\tonStart: () => {\r\n\t\t\tthis.#context.onDragStart();\r\n\t\t},\r\n\t\tonEnd: () => {\r\n\t\t\tthis.#context.onDragEnd();\r\n\t\t},\r\n\t\tonChange: ({ model }) => {\r\n\t\t\tthis.#context.setLayouts(model);\r\n\t\t},\r\n\t\tonRequestMove: ({ item }) => {\r\n\t\t\treturn this.#context.allowDrop(item.contentKey);\r\n\t\t},\r\n\t\tonDisallowed: () => {\r\n\t\t\tthis.setAttribute('disallow-drop', '');\r\n\t\t},\r\n\t\tonAllowed: () => {\r\n\t\t\tthis.removeAttribute('disallow-drop');\r\n\t\t},\r\n\t});\r\n\r\n\t#context = new UmbBlockGridEntriesContext(this);\r\n\t#controlValidator?: UmbFormControlValidator;\r\n\t#typeLimitValidator?: UmbFormControlValidatorConfig;\r\n\t#rangeUnderflowValidator?: UmbFormControlValidatorConfig;\r\n\t#rangeOverflowValidator?: UmbFormControlValidatorConfig;\r\n\r\n\t@property({ type: String, attribute: 'area-key', reflect: true })\r\n\tpublic set areaKey(value: string | null | undefined) {\r\n\t\tthis._areaKey = value;\r\n\t\tthis.#context.setAreaKey(value ?? null);\r\n\t\tthis.#controlValidator?.destroy();\r\n\t\tif (this.areaKey) {\r\n\t\t\t// Only when there is a area key we should create a validator, otherwise it is the root entries element, which is taking part of the Property Editor Form Control. [NL]\r\n\t\t\t// Currently there is no server validation for areas. So we can leave out the data path for it for now. [NL]\r\n\t\t\tthis.#controlValidator = new UmbFormControlValidator(this, this);\r\n\r\n\t\t\t//new UmbBindServerValidationToFormControl(this, this, \"$.values.[?(@.alias == 'my-input-alias')].value\");\r\n\t\t}\r\n\t}\r\n\tpublic get areaKey(): string | null | undefined {\r\n\t\treturn this._areaKey;\r\n\t}\r\n\r\n\t@property({ attribute: false })\r\n\tpublic set layoutColumns(value: number | undefined) {\r\n\t\tthis.#context.setLayoutColumns(value);\r\n\t}\r\n\tpublic get layoutColumns(): number | undefined {\r\n\t\treturn this.#context.getLayoutColumns();\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _areaKey?: string | null;\r\n\r\n\t@state()\r\n\tprivate _canCreate?: boolean;\r\n\r\n\t@state()\r\n\tprivate _createLabel?: string;\r\n\r\n\t@state()\r\n\tprivate _configCreateLabel?: string;\r\n\r\n\t@state()\r\n\tprivate _styleElement?: HTMLLinkElement;\r\n\r\n\t@state()\r\n\tprivate _layoutEntries: Array<UmbBlockGridLayoutModel> = [];\r\n\r\n\t@state()\r\n\tprivate _isReadOnly: boolean = false;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.layoutEntries,\r\n\t\t\t(layoutEntries) => {\r\n\t\t\t\t//const oldValue = this._layoutEntries;\r\n\t\t\t\tthis.#sorter.setModel(layoutEntries);\r\n\t\t\t\tthis._layoutEntries = layoutEntries;\r\n\t\t\t\t//this.requestUpdate('layoutEntries', oldValue);\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.amountOfAllowedBlockTypes,\r\n\t\t\t(length) => {\r\n\t\t\t\tthis._canCreate = length > 0;\r\n\t\t\t\tif (length === 1) {\r\n\t\t\t\t\tthis.observe(\r\n\t\t\t\t\t\tthis.#context.firstAllowedBlockTypeName(),\r\n\t\t\t\t\t\t(firstAllowedName) => {\r\n\t\t\t\t\t\t\tthis._createLabel = this.localize.term('blockEditor_addThis', this.localize.string(firstAllowedName));\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'observeSingleBlockTypeName',\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.removeUmbControllerByAlias('observeSingleBlockTypeName');\r\n\t\t\t\t\tthis._createLabel = this.localize.term('blockEditor_addBlock');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.rangeLimits,\r\n\t\t\t(rangeLimits) => {\r\n\t\t\t\tthis.#setupRangeValidation(rangeLimits);\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#context.hasTypeLimits,\r\n\t\t\t(hasTypeLimits) => {\r\n\t\t\t\tthis.#setupBlockTypeLimitValidation(hasTypeLimits);\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.#context.getManager().then((manager) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tmanager.layoutStylesheet,\r\n\t\t\t\t(stylesheet) => {\r\n\t\t\t\t\tif (!stylesheet || this._styleElement?.href === stylesheet) return;\r\n\t\t\t\t\tthis._styleElement = document.createElement('link');\r\n\t\t\t\t\tthis._styleElement.rel = 'stylesheet';\r\n\t\t\t\t\tthis._styleElement.href = stylesheet;\r\n\t\t\t\t},\r\n\t\t\t\t'observeStylesheet',\r\n\t\t\t);\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tmanager.readOnlyState.isReadOnly,\r\n\t\t\t\t(isReadOnly) => (this._isReadOnly = isReadOnly),\r\n\t\t\t\t'observeIsReadOnly',\r\n\t\t\t);\r\n\r\n\t\t\tthis.observe(\r\n\t\t\t\tmanager.variantId,\r\n\t\t\t\t(variantId) => {\r\n\t\t\t\t\tif (variantId) {\r\n\t\t\t\t\t\tthis.#sorter.identifier = 'umb-block-grid-' + variantId.toString();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'observeVariantId',\r\n\t\t\t);\r\n\r\n\t\t\tif (this.areaKey) {\r\n\t\t\t\tthis.observe(\r\n\t\t\t\t\tthis.#context.areaTypeCreateLabel,\r\n\t\t\t\t\t(label) => (this._configCreateLabel = label),\r\n\t\t\t\t\t'observeConfigCreateLabel',\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthis.observe(\r\n\t\t\t\t\tmanager.editorConfigurationPart((x) => x?.find((y) => y.alias === 'createLabel')?.value),\r\n\t\t\t\t\t(label) => (this._configCreateLabel = label as string | undefined),\r\n\t\t\t\t\t'observeConfigCreateLabel',\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tnew UmbFormControlValidator(this, this /*, this.#dataPath*/);\r\n\t}\r\n\r\n\tasync #setupRangeValidation(rangeLimit: UmbNumberRangeValueType | undefined) {\r\n\t\tif (this.#rangeUnderflowValidator) {\r\n\t\t\tthis.removeValidator(this.#rangeUnderflowValidator);\r\n\t\t\tthis.#rangeUnderflowValidator = undefined;\r\n\t\t}\r\n\t\tif (rangeLimit?.min !== 0) {\r\n\t\t\tthis.#rangeUnderflowValidator = this.addValidator(\r\n\t\t\t\t'rangeUnderflow',\r\n\t\t\t\t() => {\r\n\t\t\t\t\treturn this.localize.term(\r\n\t\t\t\t\t\t'validation_entriesShort',\r\n\t\t\t\t\t\trangeLimit!.min,\r\n\t\t\t\t\t\t(rangeLimit!.min ?? 0) - this._layoutEntries.length,\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t\t() => this._layoutEntries.length < (rangeLimit?.min ?? 0),\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (this.#rangeOverflowValidator) {\r\n\t\t\tthis.removeValidator(this.#rangeOverflowValidator);\r\n\t\t\tthis.#rangeOverflowValidator = undefined;\r\n\t\t}\r\n\t\tif (rangeLimit?.max !== Infinity) {\r\n\t\t\tthis.#rangeOverflowValidator = this.addValidator(\r\n\t\t\t\t'rangeOverflow',\r\n\t\t\t\t() => {\r\n\t\t\t\t\treturn this.localize.term(\r\n\t\t\t\t\t\t'validation_entriesExceed',\r\n\t\t\t\t\t\trangeLimit!.max,\r\n\t\t\t\t\t\tthis._layoutEntries.length - (rangeLimit!.max ?? this._layoutEntries.length),\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t\t() => this._layoutEntries.length > (rangeLimit?.max ?? Infinity),\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tasync #setupBlockTypeLimitValidation(hasTypeLimits: boolean | undefined) {\r\n\t\tif (this.#typeLimitValidator) {\r\n\t\t\tthis.removeValidator(this.#typeLimitValidator);\r\n\t\t\tthis.#typeLimitValidator = undefined;\r\n\t\t}\r\n\t\tif (hasTypeLimits) {\r\n\t\t\t// If we have specific block type limits, we should use those for validation (not the Block Type Configurations)\r\n\t\t\tthis.#typeLimitValidator = this.addValidator(\r\n\t\t\t\t'customError',\r\n\t\t\t\t() => {\r\n\t\t\t\t\tconst invalids = this.#context.getInvalidBlockTypeLimits();\r\n\t\t\t\t\treturn invalids\r\n\t\t\t\t\t\t.map((invalidRule) =>\r\n\t\t\t\t\t\t\tthis.localize.term(\r\n\t\t\t\t\t\t\t\tinvalidRule.amount < invalidRule.minRequirement\r\n\t\t\t\t\t\t\t\t\t? 'blockEditor_areaValidationEntriesShort'\r\n\t\t\t\t\t\t\t\t\t: 'blockEditor_areaValidationEntriesExceed',\r\n\t\t\t\t\t\t\t\tinvalidRule.name,\r\n\t\t\t\t\t\t\t\tinvalidRule.amount,\r\n\t\t\t\t\t\t\t\tinvalidRule.minRequirement,\r\n\t\t\t\t\t\t\t\tinvalidRule.maxRequirement,\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.join(', ');\r\n\t\t\t\t},\r\n\t\t\t\t() => {\r\n\t\t\t\t\treturn !this.#context.checkBlockTypeLimitsValidity();\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\t// Limit based on Block Type Configurations (Allow in Areas / allow in root)\r\n\t\t\tthis.#typeLimitValidator = this.addValidator(\r\n\t\t\t\t'customError',\r\n\t\t\t\t() => {\r\n\t\t\t\t\tconst invalids = this.#context\r\n\t\t\t\t\t\t.getInvalidBlockTypeConfigurations()\r\n\t\t\t\t\t\t// make invalids unique:\r\n\t\t\t\t\t\t.filter((v, i, a) => a.indexOf(v) === i)\r\n\t\t\t\t\t\t// join them together to become a string:\r\n\t\t\t\t\t\t.join(', ');\r\n\t\t\t\t\treturn this.localize.term(\r\n\t\t\t\t\t\tthis._areaKey\r\n\t\t\t\t\t\t\t? 'blockEditor_areaValidationEntriesNotAllowed'\r\n\t\t\t\t\t\t\t: 'blockEditor_rootValidationEntriesNotAllowed',\r\n\t\t\t\t\t\tinvalids,\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t\t() => {\r\n\t\t\t\t\treturn !this.#context.checkBlockTypeConfigurationValidity();\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t// TODO: Missing ability to jump directly to creating a Block, when there is only one Block Type. [NL]\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t${this._styleElement}\r\n\t\t\t<div class=\"umb-block-grid__layout-container\" data-area-length=${this._layoutEntries.length}>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._layoutEntries,\r\n\t\t\t\t\t(x) => x.contentKey,\r\n\t\t\t\t\t(layoutEntry, index) =>\r\n\t\t\t\t\t\thtml`<umb-block-grid-entry\r\n\t\t\t\t\t\t\tclass=\"umb-block-grid__layout-item\"\r\n\t\t\t\t\t\t\tindex=${index}\r\n\t\t\t\t\t\t\t.contentKey=${layoutEntry.contentKey}\r\n\t\t\t\t\t\t\t.layout=${layoutEntry}>\r\n\t\t\t\t\t\t</umb-block-grid-entry>`,\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t\t${this._canCreate ? this.#renderCreateButtonGroup() : nothing}\r\n\t\t\t${this._areaKey ? html` <uui-form-validation-message .for=${this}></uui-form-validation-message>` : nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderCreateButtonGroup() {\r\n\t\tif (this._areaKey === null || this._layoutEntries.length === 0) {\r\n\t\t\treturn html` <uui-button-group id=\"createButton\">\r\n\t\t\t\t${this.#renderCreateButton()} ${this.#renderPasteButton()}\r\n\t\t\t</uui-button-group>`;\r\n\t\t} else if (this._isReadOnly === false) {\r\n\t\t\treturn html`<uui-button-inline-create\r\n\t\t\t\thref=${this.#context.getPathForCreateBlock(-1) ?? ''}\r\n\t\t\t\tlabel=${this.localize.term('blockEditor_addBlock')}></uui-button-inline-create> `;\r\n\t\t} else {\r\n\t\t\treturn nothing;\r\n\t\t}\r\n\t}\r\n\r\n\t#renderCreateButton() {\r\n\t\tif (this._isReadOnly && this._layoutEntries.length > 0) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\tlabel=${this._configCreateLabel ?? this._createLabel ?? ''}\r\n\t\t\t\thref=${this.#context.getPathForCreateBlock(-1) ?? ''}\r\n\t\t\t\t?disabled=${this._isReadOnly}></uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderPasteButton() {\r\n\t\tif (this._areaKey) return nothing;\r\n\t\tif (this._isReadOnly && this._layoutEntries.length > 0) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\tlabel=${this.localize.term('content_createFromClipboard')}\r\n\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\thref=${this.#context.getPathForClipboard(-1) ?? ''}\r\n\t\t\t\t?disabled=${this._isReadOnly}>\r\n\t\t\t\t<uui-icon name=\"icon-clipboard-paste\"></uui-icon>\r\n\t\t\t</uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgap: 1px;\r\n\t\t\t}\r\n\t\t\t:host([disallow-drop])::before {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tz-index: 1;\r\n\t\t\t\tinset: 0;\r\n\t\t\t\tborder: 2px solid var(--uui-color-danger);\r\n\t\t\t\tborder-radius: calc(var(--uui-border-radius) * 2);\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t}\r\n\t\t\t:host([disallow-drop])::after {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tz-index: 1;\r\n\t\t\t\tinset: 0;\r\n\t\t\t\tborder-radius: calc(var(--uui-border-radius) * 2);\r\n\t\t\t\tbackground-color: var(--uui-color-danger);\r\n\t\t\t\topacity: 0.2;\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t}\r\n\r\n\t\t\t> div {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: stretch;\r\n\t\t\t}\r\n\r\n\t\t\t#createButton {\r\n\t\t\t\tgrid-template-columns: 1fr auto;\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t}\r\n\r\n\t\t\t/* Only when we are n an area, we like to hide the button on drag */\r\n\t\t\t:host([area-key]) #createButton {\r\n\t\t\t\t--umb-block-grid--create-button--is-dragging--variable: var(--umb-block-grid--is-dragging) none;\r\n\t\t\t\tdisplay: var(--umb-block-grid--create-button--is-dragging--variable, grid);\r\n\t\t\t}\r\n\t\t\t:host(:not([pristine]):invalid) #createButton {\r\n\t\t\t\t--uui-button-contrast: var(--uui-color-danger);\r\n\t\t\t\t--uui-button-contrast-hover: var(--uui-color-danger);\r\n\t\t\t\t--uui-color-default-emphasis: var(--uui-color-danger);\r\n\t\t\t\t--uui-button-border-color: var(--uui-color-danger);\r\n\t\t\t\t--uui-button-border-color-hover: var(--uui-color-danger);\r\n\t\t\t}\r\n\r\n\t\t\t.umb-block-grid__layout-container[data-area-length='0'] {\r\n\t\t\t\t--umb-block-grid--layout-container--is-dragging--variable: var(--umb-block-grid--is-dragging) 1;\r\n\t\t\t\tmin-height: calc(var(--umb-block-grid--layout-container--is-dragging--variable, 0) * var(--uui-size-11));\r\n\t\t\t}\r\n\r\n\t\t\t.umb-block-grid__layout-container[data-area-length='0']::after {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tinset: 0;\r\n\t\t\t\ttop: 1px;\r\n\t\t\t\tborder: calc(var(--umb-block-grid--layout-container--is-dragging--variable, 0) * 1px) dashed\r\n\t\t\t\t\tvar(--uui-color-border);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockGridEntriesElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-grid-entries': UmbBlockGridEntriesElement;\r\n\t}\r\n}\r\n","import type { UmbBlockGridTypeAreaType } from '../../types.js';\r\nimport { UMB_BLOCK_GRID_ENTRY_CONTEXT } from '../../context/index.js';\r\nimport { UMB_BLOCK_GRID_MANAGER_CONTEXT } from '../../context/block-grid-manager.context-token.js';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { css, customElement, html, repeat, state } from '@umbraco-cms/backoffice/external/lit';\r\n\r\nimport '../block-grid-entries/index.js';\r\n/**\r\n * @description\r\n * This element is used to render the block grid areas.\r\n */\r\n@customElement('umb-block-grid-areas-container')\r\nexport class UmbBlockGridAreasContainerElement extends UmbLitElement {\r\n\t//\r\n\t@state()\r\n\t_styleElement?: HTMLLinkElement;\r\n\r\n\t@state()\r\n\t_areas?: Array<UmbBlockGridTypeAreaType> = [];\r\n\r\n\t@state()\r\n\t_areaGridColumns?: number;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_BLOCK_GRID_ENTRY_CONTEXT, (context) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tcontext.areas,\r\n\t\t\t\t(areas) => {\r\n\t\t\t\t\tthis._areas = areas;\r\n\t\t\t\t},\r\n\t\t\t\t'observeAreas',\r\n\t\t\t);\r\n\t\t\tthis.observe(\r\n\t\t\t\tcontext.areaGridColumns,\r\n\t\t\t\t(areaGridColumns) => {\r\n\t\t\t\t\tthis._areaGridColumns = areaGridColumns;\r\n\t\t\t\t\t//this.requestUpdate('_areaGridColumns');\r\n\t\t\t\t},\r\n\t\t\t\t'observeAreaGridColumns',\r\n\t\t\t);\r\n\t\t});\r\n\t\tthis.consumeContext(UMB_BLOCK_GRID_MANAGER_CONTEXT, (manager) => {\r\n\t\t\tthis.observe(\r\n\t\t\t\tmanager.layoutStylesheet,\r\n\t\t\t\t(stylesheet) => {\r\n\t\t\t\t\t// Do not re-render stylesheet if its the same href.\r\n\t\t\t\t\tif (!stylesheet || this._styleElement?.href === stylesheet) return;\r\n\t\t\t\t\tthis._styleElement = document.createElement('link');\r\n\t\t\t\t\tthis._styleElement.rel = 'stylesheet';\r\n\t\t\t\t\tthis._styleElement.href = stylesheet;\r\n\t\t\t\t},\r\n\t\t\t\t'observeStylesheet',\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn this._areas && this._areas.length > 0\r\n\t\t\t? html` ${this._styleElement}\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclass=\"umb-block-grid__area-container\"\r\n\t\t\t\t\t\tpart=\"area-container\"\r\n\t\t\t\t\t\tstyle=\"--umb-block-grid--area-grid-columns: ${this._areaGridColumns}\">\r\n\t\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\t\tthis._areas,\r\n\t\t\t\t\t\t\t(area) => area.key,\r\n\t\t\t\t\t\t\t(area) =>\r\n\t\t\t\t\t\t\t\thtml`<umb-block-grid-entries\r\n\t\t\t\t\t\t\t\t\tpart=\"area\"\r\n\t\t\t\t\t\t\t\t\tclass=\"umb-block-grid__area\"\r\n\t\t\t\t\t\t\t\t\t.areaKey=${area.key}\r\n\t\t\t\t\t\t\t\t\t.layoutColumns=${area.columnSpan}></umb-block-grid-entries>`,\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>`\r\n\t\t\t: '';\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockGridAreasContainerElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-grid-areas-container': UmbBlockGridAreasContainerElement;\r\n\t}\r\n}\r\n","import { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { css, customElement, html, nothing, property } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { UmbBlockDataType } from '@umbraco-cms/backoffice/block';\r\nimport type { UmbBlockEditorCustomViewConfiguration } from '@umbraco-cms/backoffice/block-custom-view';\r\n\r\nimport '@umbraco-cms/backoffice/ufm';\r\nimport '../block-grid-areas-container/index.js';\r\nimport '../ref-grid-block/index.js';\r\n\r\n@customElement('umb-block-grid-block')\r\nexport class UmbBlockGridBlockElement extends UmbLitElement {\r\n\t//\r\n\t@property({ attribute: false })\r\n\tlabel?: string;\r\n\r\n\t@property({ type: String, reflect: false })\r\n\ticon?: string;\r\n\r\n\t@property({ attribute: false })\r\n\tconfig?: UmbBlockEditorCustomViewConfiguration;\r\n\r\n\t@property({ type: Boolean, reflect: true })\r\n\tunpublished?: boolean;\r\n\r\n\t@property({ attribute: false })\r\n\tcontent?: UmbBlockDataType;\r\n\r\n\toverride render() {\r\n\t\treturn html`<umb-ref-grid-block\r\n\t\t\tstandalone\r\n\t\t\thref=${(this.config?.showContentEdit ? this.config?.editContentPath : undefined) ?? ''}>\r\n\t\t\t<umb-icon slot=\"icon\" .name=${this.icon}></umb-icon>\r\n\t\t\t<umb-ufm-render slot=\"name\" inline .markdown=${this.label} .value=${this.content}></umb-ufm-render>\r\n\t\t\t${this.unpublished\r\n\t\t\t\t? html`<uui-tag slot=\"name\" look=\"secondary\" title=${this.localize.term('blockEditor_notExposedDescription')}\r\n\t\t\t\t\t\t><umb-localize key=\"blockEditor_notExposedLabel\"></umb-localize\r\n\t\t\t\t\t></uui-tag>`\r\n\t\t\t\t: nothing}\r\n\t\t\t<umb-block-grid-areas-container slot=\"areas\" draggable=\"false\"></umb-block-grid-areas-container>\r\n\t\t</umb-ref-grid-block>`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\tumb-block-grid-areas-container {\r\n\t\t\t\tmargin-top: calc(var(--uui-size-2) + 1px);\r\n\t\t\t}\r\n\t\t\tumb-block-grid-areas-container::part(area) {\r\n\t\t\t\tmargin: var(--uui-size-2);\r\n\t\t\t}\r\n\r\n\t\t\tuui-tag {\r\n\t\t\t\tmargin-left: 0.5em;\r\n\t\t\t\tmargin-bottom: -0.3em;\r\n\t\t\t\tmargin-top: -0.3em;\r\n\t\t\t\tvertical-align: text-top;\r\n\t\t\t}\r\n\t\t\t:host([unpublished]) umb-icon,\r\n\t\t\t:host([unpublished]) umb-ufm-render {\r\n\t\t\t\topacity: 0.6;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbBlockGridBlockElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-block-grid-block': UmbBlockGridBlockElement;\r\n\t}\r\n}\r\n"],"names":["closestColumnSpanOption","target","map","max","result","a","b","aDiff","bDiff","forEachBlockLayoutEntryOf","entry","callback","parentUnique","area","areaKey","item","UmbBlockGridScaleManager","UmbControllerBase","host","#runtimeGridColumns","#runtimeGridRows","#lockedGridRows","#updateLayoutRaf","e","layoutContainer","layoutContainerRect","layoutItemRect","startX","startY","endX","endY","newSpans","#getNewSpans","updateRowTemplate","#updateGridData","entriesContext","layoutColumns","computedStyles","columnGap","rowGap","gridColumns","x","gridRows","n","gridColumnsLen","i","gridRowsLen","amountOfColumnsInWeightMap","amountOfUnknownColumns","accumulatedValue","getAccumulatedValueOfIndex","missingColumnWidth","itemSingleRowHeight","blockStartCol","getInterpolatedIndexOfPositionInWeightMap","blockStartRow","blockEndCol","blockEndRow","newColumnSpan","columnOptions","minMaxRowSpan","rowMinSpan","rowMaxSpan","newRowSpan","event","UmbBlockGridEntriesContext","UmbBlockEntriesContext","UMB_BLOCK_GRID_MANAGER_CONTEXT","#pathAddendum","UmbRoutePathAddendumContext","#layoutColumns","UmbNumberState","#areaType","UmbObjectState","#rangeLimits","#allowedBlockTypes","UmbArrayState","#hasTypeLimits","UmbBooleanState","UMB_BLOCK_GRID_ENTRY_CONTEXT","blockGridEntry","#parentEntry","#gotBlockParentEntry","UmbModalRouteRegistrationController","UMB_BLOCK_CATALOGUE_MODAL","routingInfo","index","clipboardContext","UMB_CLIPBOARD_PROPERTY_CONTEXT","pasteTranslatorManifests","UMB_BLOCK_GRID_PROPERTY_EDITOR_UI_ALIAS","config","UMB_PROPERTY_CONTEXT","valueResolver","UmbClipboardPastePropertyValueTranslatorValueResolver","clipboardEntryDetail","pasteTranslator","value","#areaKey","#parentUnique","data","created","propertyValues","routeBuilder","UMB_BLOCK_GRID_WORKSPACE_MODAL","newPath","nameState","UmbStringState","name","contentKey","#gotAreaKey","columns","#setupAllowedBlockTypes","#setupRangeLimits","layouts","hostEl","unique","areaType","#retrieveAllowedElementTypes","#setupAllowedBlockTypesLimits","min","contentTypeKey","types","contentElementTypeKey","partialLayoutEntry","originData","layoutEntry","content","settings","layout","layoutEntries","UMB_BLOCK_GRID_PROPERTY_EDITOR_SCHEMA_ALIAS","localOriginData","permission","blockType","v","#invalidBlockTypeLimits","rule","minAllowed","maxAllowed","groupElementTypeKeys","groupAmount","amount","#invalidBlockTypeConfigurations","allowedBlocks","allowedKeys","isBad","UmbBlockGridEntryContext","UmbBlockEntryContext","UMB_BLOCK_GRID_ENTRIES_CONTEXT","#relevantColumnSpanOptions","#canScale","#isAllowed","#areaGridColumns","mergeObservables","frozenValue","areas","appendToFrozenArray","columnSpan","#calcColumnSpan","layoutValue","rowSpan","minMax","#gotEntriesAndManager","key","isAllowed","observeMultiple","columnSpanOptions","relevantColumnSpanOptions","hasRelevantColumnSpanOptions","hasRowSpanOptions","canScale","areaTypeGridColumns","layoutAreas","y","propertyDatasetContext","UMB_PROPERTY_DATASET_CONTEXT","propertyContext","workspaceName","propertyLabel","blockLabel","entryName","expose","contentData","settingsData","exposes","propertyValue","UmbRefGridBlockElement","UUIRefNodeElement","html","css","__decorateClass","customElement","_blockContext","_workspaceContext","_variantId","_contentKey","_parentUnique","_areaKey","_UmbBlockGridBlockInlineElement_instances","load_fn","generatePropertyDataPath_fn","_expose","renderBlockInfo_fn","renderInside_fn","apiArgsCreator","manifest","UmbBlockGridBlockInlineElement","UmbLitElement","__privateAdd","__privateGet","blockContext","__privateSet","__privateMethod","UmbExtensionApiInitializer","umbExtensionsRegistry","UMB_BLOCK_WORKSPACE_ALIAS","permitted","ctrl","context","contentTypeProperties","variantId","culture","languageRepository","UmbLanguageItemRepository","UmbExtensionsApiInitializer","property","UmbDataPathPropertyValueQuery","nothing","UmbTextStyles","state","_UmbBlockGridBlockUnsupportedElement_instances","UmbBlockGridBlockUnsupportedElement","UmbBlockGridScaleHandlerElement","_context","_renderTimeout","_UmbBlockGridEntryElement_instances","updateBlockViewProps_fn","init_fn","observeData_fn","callUpdateInlineCreateButtons_fn","_updateInlineCreateButtons","_extensionSlotFilterMethod","_extensionSlotRenderMethod","renderBuiltinBlockView_fn","renderUnsupportedBlock_fn","renderRefBlock_fn","renderCreateBeforeInlineButton_fn","renderCreateAfterInlineButton_fn","renderActionBar_fn","renderEditAction_fn","renderEditSettingsAction_fn","renderCopyToClipboardAction_fn","renderDeleteAction_fn","UmbBlockGridEntryElement","stringOrStringArrayContains","UMB_BLOCK_GRID","ext","UmbObserveValidationStateController","UmbDataPathBlockElementDataQuery","hasMessages","contentElementTypeAlias","contentElementTypeName","_changedProperties","incoming","showContentEdit","label","icon","exposed","unsupported","mode","settingsKey","createPath","path","isReadOnly","UUIBlinkKeyframes","UUIBlinkAnimationValue","_sorter","_controlValidator","_typeLimitValidator","_rangeUnderflowValidator","_rangeOverflowValidator","_UmbBlockGridEntriesElement_instances","setupRangeValidation_fn","setupBlockTypeLimitValidation_fn","renderCreateButtonGroup_fn","renderCreateButton_fn","renderPasteButton_fn","resolvePlacementAsBlockGrid","args","isWithinRect","approvedContainerComputedStyles","gridColumnGap","gridColumnNumber","foundElColumns","currentElementColumns","approvedContainerGridColumns","list","offsetPlacement","relatedStartX","SORTER_CONFIG","element","modelEntry","UmbBlockGridEntriesElement","UmbFormControlMixin","UmbSorterController","model","length","firstAllowedName","rangeLimits","hasTypeLimits","manager","stylesheet","UmbFormControlValidator","repeat","rangeLimit","invalidRule","invalids","UmbBlockGridAreasContainerElement","areaGridColumns","UmbBlockGridBlockElement"],"mappings":"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"}