{"version":3,"file":"document-references-workspace-view-info.element-BZAylbe0.js","sources":["../../../src/packages/documents/documents/reference/info-app/document-references-workspace-view-info.element.ts"],"sourcesContent":["import { UmbDocumentReferenceRepository } from '../repository/index.js';\r\nimport { UMB_DOCUMENT_WORKSPACE_CONTEXT } from '../../constants.js';\r\nimport { css, customElement, html, nothing, repeat, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { UmbReferenceItemModel } from '@umbraco-cms/backoffice/relations';\r\nimport type { UUIPaginationEvent } from '@umbraco-cms/backoffice/external/uui';\r\nimport type { UmbEntityUnique } from '@umbraco-cms/backoffice/entity';\r\n\r\n@customElement('umb-document-references-workspace-info-app')\r\nexport class UmbDocumentReferencesWorkspaceInfoAppElement extends UmbLitElement {\r\n\t@state()\r\n\tprivate _currentPage = 1;\r\n\r\n\t@state()\r\n\tprivate _total = 0;\r\n\r\n\t@state()\r\n\tprivate _items?: Array<UmbReferenceItemModel> = [];\r\n\r\n\t#itemsPerPage = 10;\r\n\t#referenceRepository = new UmbDocumentReferenceRepository(this);\r\n\t#documentUnique?: UmbEntityUnique;\r\n\t#workspaceContext?: typeof UMB_DOCUMENT_WORKSPACE_CONTEXT.TYPE;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_DOCUMENT_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tthis.#workspaceContext = context;\r\n\t\t\tthis.#observeDocumentUnique();\r\n\t\t});\r\n\t}\r\n\r\n\t#observeDocumentUnique() {\r\n\t\tthis.observe(\r\n\t\t\tthis.#workspaceContext?.unique,\r\n\t\t\t(unique) => {\r\n\t\t\t\tif (!unique) {\r\n\t\t\t\t\tthis.#documentUnique = undefined;\r\n\t\t\t\t\tthis._items = [];\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.#documentUnique === unique) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.#documentUnique = unique;\r\n\t\t\t\tthis.#getReferences();\r\n\t\t\t},\r\n\t\t\t'umbReferencesDocumentUniqueObserver',\r\n\t\t);\r\n\t}\r\n\r\n\tasync #getReferences() {\r\n\t\tif (!this.#documentUnique) {\r\n\t\t\tthrow new Error('Document unique is required');\r\n\t\t}\r\n\r\n\t\tconst { data } = await this.#referenceRepository.requestReferencedBy(\r\n\t\t\tthis.#documentUnique,\r\n\t\t\t(this._currentPage - 1) * this.#itemsPerPage,\r\n\t\t\tthis.#itemsPerPage,\r\n\t\t);\r\n\t\tif (!data) return;\r\n\r\n\t\tthis._total = data.total;\r\n\t\tthis._items = data.items;\r\n\t}\r\n\r\n\t#onPageChange(event: UUIPaginationEvent) {\r\n\t\tif (this._currentPage === event.target.current) return;\r\n\t\tthis._currentPage = event.target.current;\r\n\r\n\t\tthis.#getReferences();\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this._items?.length) return nothing;\r\n\t\treturn html`\r\n\t\t\t<umb-workspace-info-app-layout headline=\"#references_labelUsedByItems\">\r\n\t\t\t\t${this.#renderItems()} ${this.#renderReferencePagination()}\r\n\t\t\t</umb-workspace-info-app-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderItems() {\r\n\t\tif (!this._items) return;\r\n\t\treturn html`\r\n\t\t\t<uui-ref-list>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._items,\r\n\t\t\t\t\t(item) => item.unique,\r\n\t\t\t\t\t(item) => html`<umb-entity-item-ref .item=${item}></umb-entity-item-ref>`,\r\n\t\t\t\t)}\r\n\t\t\t</uui-ref-list>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderReferencePagination() {\r\n\t\tif (!this._total) return nothing;\r\n\r\n\t\tconst totalPages = Math.ceil(this._total / this.#itemsPerPage);\r\n\t\tif (totalPages <= 1) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"pagination\">\r\n\t\t\t\t<uui-pagination .total=${totalPages} @change=\"${this.#onPageChange}\"></uui-pagination>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: contents;\r\n\t\t\t}\r\n\r\n\t\t\tuui-table-cell:not(.link-cell) {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\tuui-pagination {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tdisplay: inline-block;\r\n\t\t\t}\r\n\r\n\t\t\t.pagination {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\tmargin-top: var(--uui-size-space-4);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbDocumentReferencesWorkspaceInfoAppElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-document-references-workspace-info-app': UmbDocumentReferencesWorkspaceInfoAppElement;\r\n\t}\r\n}\r\n"],"names":["_itemsPerPage","_referenceRepository","_documentUnique","_workspaceContext","_UmbDocumentReferencesWorkspaceInfoAppElement_instances","observeDocumentUnique_fn","getReferences_fn","onPageChange_fn","renderItems_fn","renderReferencePagination_fn","UmbDocumentReferencesWorkspaceInfoAppElement","UmbLitElement","__privateAdd","UmbDocumentReferenceRepository","UMB_DOCUMENT_WORKSPACE_CONTEXT","context","__privateSet","__privateMethod","html","nothing","__privateGet","unique","data","event","repeat","item","totalPages","UmbTextStyles","css","__decorateClass","state","customElement","UmbDocumentReferencesWorkspaceInfoAppElement$1"],"mappings":"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"}