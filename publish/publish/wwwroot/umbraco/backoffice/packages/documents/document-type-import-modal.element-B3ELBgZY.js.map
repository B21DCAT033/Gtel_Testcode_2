{"version":3,"file":"document-type-import-modal.element-B3ELBgZY.js","sources":["../../../src/packages/documents/document-types/entity-actions/import/modal/document-type-import-modal.element.ts"],"sourcesContent":["import { UmbDocumentTypeImportRepository } from '../repository/document-type-import.repository.js';\r\nimport type {\r\n\tUmbDocumentTypeImportModalData,\r\n\tUmbDocumentTypeImportModalValue,\r\n} from './document-type-import-modal.token.js';\r\nimport { css, html, customElement, query, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbDropzoneElement } from '@umbraco-cms/backoffice/media';\r\n\r\ninterface UmbDocumentTypePreview {\r\n\tunique: string;\r\n\tname: string;\r\n\talias: string;\r\n\ticon: string;\r\n}\r\n\r\n@customElement('umb-document-type-import-modal')\r\nexport class UmbDocumentTypeImportModalLayout extends UmbModalBaseElement<\r\n\tUmbDocumentTypeImportModalData,\r\n\tUmbDocumentTypeImportModalValue\r\n> {\r\n\t#documentTypeImportRepository = new UmbDocumentTypeImportRepository(this);\r\n\t#temporaryUnique?: string;\r\n\t#fileReader;\r\n\r\n\t@state()\r\n\tprivate _fileContent: Array<UmbDocumentTypePreview> = [];\r\n\r\n\t@query('#dropzone')\r\n\tprivate dropzone?: UmbDropzoneElement;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.#fileReader = new FileReader();\r\n\t\tthis.#fileReader.onload = (e) => {\r\n\t\t\tif (typeof e.target?.result === 'string') {\r\n\t\t\t\tconst fileContent = e.target.result;\r\n\t\t\t\tthis.#documentTypePreviewBuilder(fileContent);\r\n\t\t\t} else {\r\n\t\t\t\tthis.#requestReset();\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t#onUploadComplete() {\r\n\t\tconst data = this.dropzone?.getItems()[0];\r\n\t\tif (!data?.temporaryFile) return;\r\n\r\n\t\tthis.#temporaryUnique = data.temporaryFile.temporaryUnique;\r\n\t\tthis.#fileReader.readAsText(data.temporaryFile.file);\r\n\t}\r\n\r\n\tasync #onFileImport() {\r\n\t\tif (!this.#temporaryUnique) return;\r\n\t\tconst { error } = await this.#documentTypeImportRepository.requestImport(this.#temporaryUnique);\r\n\t\tif (error) return;\r\n\t\tthis._submitModal();\r\n\t}\r\n\r\n\t#documentTypePreviewBuilder(htmlString: string) {\r\n\t\tconst parser = new DOMParser();\r\n\t\tconst doc = parser.parseFromString(htmlString, 'text/xml');\r\n\t\tconst elements = doc.childNodes;\r\n\r\n\t\tconst documentTypes: Array<Element> = [];\r\n\r\n\t\telements.forEach((node) => {\r\n\t\t\tif (node.nodeType === Node.ELEMENT_NODE && node.nodeName === 'DocumentType') {\r\n\t\t\t\tdocumentTypes.push(node as Element);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._fileContent = this.#documentTypePreviewItemBuilder(documentTypes);\r\n\t}\r\n\r\n\t#documentTypePreviewItemBuilder(elements: Array<Element>) {\r\n\t\tconst documentTypes: Array<UmbDocumentTypePreview> = [];\r\n\t\telements.forEach((documentType) => {\r\n\t\t\tconst info = documentType.getElementsByTagName('Info')[0];\r\n\t\t\tconst unique = info.getElementsByTagName('Key')[0].textContent ?? '';\r\n\t\t\tconst name = info.getElementsByTagName('Name')[0].textContent ?? '';\r\n\t\t\tconst alias = info.getElementsByTagName('Alias')[0].textContent ?? '';\r\n\t\t\tconst icon = info.getElementsByTagName('Icon')[0].textContent ?? '';\r\n\r\n\t\t\tdocumentTypes.push({ unique, name, alias, icon });\r\n\t\t});\r\n\t\treturn documentTypes;\r\n\t}\r\n\r\n\t#requestReset() {\r\n\t\tthis._fileContent = [];\r\n\t\tthis.#temporaryUnique = undefined;\r\n\t}\r\n\r\n\tasync #onBrowse() {\r\n\t\tthis.dropzone?.browse();\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html` <umb-body-layout headline=${this.localize.term('general_import')}>\r\n\t\t\t<uui-box> ${this.#renderUploadZone()} </uui-box>\r\n\t\t\t<uui-button\r\n\t\t\t\tslot=\"actions\"\r\n\t\t\t\ttype=\"button\"\r\n\t\t\t\tlabel=${this.localize.term('general_cancel')}\r\n\t\t\t\t@click=${this._rejectModal}></uui-button>\r\n\t\t\t<uui-button\r\n\t\t\t\tslot=\"actions\"\r\n\t\t\t\ttype=\"button\"\r\n\t\t\t\tlook=\"primary\"\r\n\t\t\t\t?disabled=${!this.#temporaryUnique}\r\n\t\t\t\tlabel=${this.localize.term('actions_importdocumenttype')}\r\n\t\t\t\t@click=${this.#onFileImport}></uui-button>\r\n\t\t</umb-body-layout>`;\r\n\t}\r\n\r\n\t#renderUploadZone() {\r\n\t\treturn html`\r\n\t\t\t${when(\r\n\t\t\t\tthis._fileContent.length,\r\n\t\t\t\t() =>\r\n\t\t\t\t\thtml`<uui-ref-node-document-type\r\n\t\t\t\t\t\tname=${this._fileContent[0].name}\r\n\t\t\t\t\t\talias=${this._fileContent[0].alias}\r\n\t\t\t\t\t\treadonly\r\n\t\t\t\t\t\tstandalone>\r\n\t\t\t\t\t\t<umb-icon slot=\"icon\" name=${this._fileContent[0].icon}></umb-icon>\r\n\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\t\t\t@click=${this.#requestReset}\r\n\t\t\t\t\t\t\tlabel=${this.localize.term('general_remove')}></uui-button>\r\n\t\t\t\t\t</uui-ref-node-document-type>`,\r\n\t\t\t\t() =>\r\n\t\t\t\t\t/**TODO Add localizations */\r\n\t\t\t\t\thtml`<div id=\"wrapper\">\r\n\t\t\t\t\t\tDrag and drop your file here\r\n\t\t\t\t\t\t<uui-button look=\"primary\" label=\"or click here to choose a file\" @click=${this.#onBrowse}></uui-button>\r\n\t\t\t\t\t\t<umb-dropzone\r\n\t\t\t\t\t\t\tid=\"dropzone\"\r\n\t\t\t\t\t\t\taccept=\".udt\"\r\n\t\t\t\t\t\t\t@complete=${this.#onUploadComplete}\r\n\t\t\t\t\t\t\tcreateAsTemporary></umb-dropzone>\r\n\t\t\t\t\t</div>`,\r\n\t\t\t)}\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#wrapper {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tborder: 2px dashed var(--uui-color-divider-standalone);\r\n\t\t\t\tbackground-color: var(--uui-color-surface-alt);\r\n\t\t\t\tpadding: var(--uui-size-space-6);\r\n\t\t\t}\r\n\r\n\t\t\t#import {\r\n\t\t\t\tmargin-top: var(--uui-size-space-6);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbDocumentTypeImportModalLayout;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-document-type-import-modal': UmbDocumentTypeImportModalLayout;\r\n\t}\r\n}\r\n"],"names":["_documentTypeImportRepository","_temporaryUnique","_fileReader","_UmbDocumentTypeImportModalLayout_instances","onUploadComplete_fn","onFileImport_fn","documentTypePreviewBuilder_fn","documentTypePreviewItemBuilder_fn","requestReset_fn","onBrowse_fn","renderUploadZone_fn","UmbDocumentTypeImportModalLayout","UmbModalBaseElement","__privateAdd","UmbDocumentTypeImportRepository","__privateSet","__privateGet","fileContent","__privateMethod","html","data","error","htmlString","elements","documentTypes","node","documentType","info","unique","name","alias","icon","when","UmbTextStyles","css","__decorateClass","state","query","customElement","UmbDocumentTypeImportModalLayout$1"],"mappings":"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"}