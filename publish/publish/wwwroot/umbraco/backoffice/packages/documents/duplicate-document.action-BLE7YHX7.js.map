{"version":3,"file":"duplicate-document.action-BLE7YHX7.js","sources":["../../../src/packages/documents/documents/entity-actions/duplicate/duplicate-document.action.ts"],"sourcesContent":["import { UMB_DOCUMENT_ENTITY_TYPE, UMB_DOCUMENT_ROOT_ENTITY_TYPE } from '../../entity.js';\r\nimport { UMB_DUPLICATE_DOCUMENT_MODAL } from './modal/index.js';\r\nimport { UmbDuplicateDocumentRepository } from './repository/index.js';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_ACTION_EVENT_CONTEXT } from '@umbraco-cms/backoffice/action';\r\nimport { UmbEntityActionBase, UmbRequestReloadChildrenOfEntityEvent } from '@umbraco-cms/backoffice/entity-action';\r\n\r\nexport class UmbDuplicateDocumentEntityAction extends UmbEntityActionBase<never> {\r\n\toverride async execute() {\r\n\t\tif (!this.args.unique) throw new Error('Unique is not available');\r\n\t\tif (!this.args.entityType) throw new Error('Entity Type is not available');\r\n\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modal = modalManager.open(this, UMB_DUPLICATE_DOCUMENT_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tunique: this.args.unique,\r\n\t\t\t\tentityType: this.args.entityType,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\ttry {\r\n\t\t\tconst value = await modal.onSubmit();\r\n\t\t\tconst destinationUnique = value.destination.unique;\r\n\t\t\tif (destinationUnique === undefined) throw new Error('Destination Unique is not available');\r\n\r\n\t\t\tconst duplicateRepository = new UmbDuplicateDocumentRepository(this);\r\n\r\n\t\t\tconst { error } = await duplicateRepository.requestDuplicate({\r\n\t\t\t\tunique: this.args.unique,\r\n\t\t\t\tdestination: { unique: destinationUnique },\r\n\t\t\t\trelateToOriginal: value.relateToOriginal,\r\n\t\t\t\tincludeDescendants: value.includeDescendants,\r\n\t\t\t});\r\n\r\n\t\t\tif (!error) {\r\n\t\t\t\tthis.#reloadMenu(destinationUnique);\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log(error);\r\n\t\t}\r\n\t}\r\n\r\n\tasync #reloadMenu(destinationUnique: string | null) {\r\n\t\tconst actionEventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\r\n\r\n\t\t// When duplicating, the destination entity type may or may not be the same as that of\r\n\t\t// the item selected for duplication (that is available in this.args).\r\n\t\t// For documents though, we know the entity type will be \"document\", unless we are duplicating\r\n\t\t// to the root (when the destinationUnique will be null).\r\n\t\tconst destinationEntityType = destinationUnique === null ? UMB_DOCUMENT_ROOT_ENTITY_TYPE : UMB_DOCUMENT_ENTITY_TYPE;\r\n\r\n\t\tconst event = new UmbRequestReloadChildrenOfEntityEvent({\r\n\t\t\tunique: destinationUnique,\r\n\t\t\tentityType: destinationEntityType,\r\n\t\t});\r\n\r\n\t\tactionEventContext.dispatchEvent(event);\r\n\t}\r\n}\r\n\r\nexport { UmbDuplicateDocumentEntityAction as api };\r\n"],"names":["UmbDuplicateDocumentEntityAction","UmbEntityActionBase","modal","UMB_MODAL_MANAGER_CONTEXT","UMB_DUPLICATE_DOCUMENT_MODAL","value","destinationUnique","duplicateRepository","UmbDuplicateDocumentRepository","error","#reloadMenu","actionEventContext","UMB_ACTION_EVENT_CONTEXT","destinationEntityType","UMB_DOCUMENT_ROOT_ENTITY_TYPE","UMB_DOCUMENT_ENTITY_TYPE","event","UmbRequestReloadChildrenOfEntityEvent"],"mappings":";;;;;AAOO,MAAMA,UAAyCC,EAA2B;AAAA,EAChF,MAAe,UAAU;AACxB,QAAI,CAAC,KAAK,KAAK,OAAc,OAAA,IAAI,MAAM,yBAAyB;AAChE,QAAI,CAAC,KAAK,KAAK,WAAkB,OAAA,IAAI,MAAM,8BAA8B;AAGzE,UAAMC,KADe,MAAM,KAAK,WAAWC,CAAyB,GACzC,KAAK,MAAMC,GAA8B;AAAA,MACnE,MAAM;AAAA,QACL,QAAQ,KAAK,KAAK;AAAA,QAClB,YAAY,KAAK,KAAK;AAAA,MAAA;AAAA,IACvB,CACA;AAEG,QAAA;AACG,YAAAC,IAAQ,MAAMH,EAAM,SAAS,GAC7BI,IAAoBD,EAAM,YAAY;AAC5C,UAAIC,MAAsB,OAAiB,OAAA,IAAI,MAAM,qCAAqC;AAEpF,YAAAC,IAAsB,IAAIC,EAA+B,IAAI,GAE7D,EAAE,OAAAC,EAAA,IAAU,MAAMF,EAAoB,iBAAiB;AAAA,QAC5D,QAAQ,KAAK,KAAK;AAAA,QAClB,aAAa,EAAE,QAAQD,EAAkB;AAAA,QACzC,kBAAkBD,EAAM;AAAA,QACxB,oBAAoBA,EAAM;AAAA,MAAA,CAC1B;AAED,MAAKI,KACJ,KAAKC,GAAYJ,CAAiB;AAAA,aAE3BG,GAAO;AACf,cAAQ,IAAIA,CAAK;AAAA,IAAA;AAAA,EAClB;AAAA,EAGD,MAAMC,GAAYJ,GAAkC;AACnD,UAAMK,IAAqB,MAAM,KAAK,WAAWC,CAAwB,GAMnEC,IAAwBP,MAAsB,OAAOQ,IAAgCC,GAErFC,IAAQ,IAAIC,EAAsC;AAAA,MACvD,QAAQX;AAAA,MACR,YAAYO;AAAA,IAAA,CACZ;AAED,IAAAF,EAAmB,cAAcK,CAAK;AAAA,EAAA;AAExC;"}