{"version":3,"file":"input-document-granular-user-permission.element-pMsuZ6uL.js","sources":["../../../src/packages/documents/documents/user-permissions/input-document-granular-user-permission/input-document-granular-user-permission.element.ts"],"sourcesContent":["import type { UmbDocumentUserPermissionModel } from '../types.js';\r\nimport { UmbDocumentItemRepository } from '../../item/index.js';\r\nimport type { UmbDocumentItemModel } from '../../item/types.js';\r\nimport { UMB_DOCUMENT_PICKER_MODAL } from '../../constants.js';\r\nimport { css, customElement, html, repeat, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { UmbModalManagerContext } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbDeselectedEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbChangeEvent, UmbSelectedEvent } from '@umbraco-cms/backoffice/event';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UUIFormControlMixin } from '@umbraco-cms/backoffice/external/uui';\r\nimport {\r\n\tUMB_ENTITY_USER_PERMISSION_MODAL,\r\n\ttype ManifestEntityUserPermission,\r\n} from '@umbraco-cms/backoffice/user-permission';\r\n\r\n@customElement('umb-input-document-granular-user-permission')\r\nexport class UmbInputDocumentGranularUserPermissionElement extends UUIFormControlMixin(UmbLitElement, '') {\r\n\t_permissions: Array<UmbDocumentUserPermissionModel> = [];\r\n\tpublic get permissions(): Array<UmbDocumentUserPermissionModel> {\r\n\t\treturn this._permissions;\r\n\t}\r\n\tpublic set permissions(value: Array<UmbDocumentUserPermissionModel>) {\r\n\t\tthis._permissions = value;\r\n\t\tconst uniques = value.map((item) => item.document.id);\r\n\t\tthis.#observePickedDocuments(uniques);\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _items?: Array<UmbDocumentItemModel>;\r\n\r\n\t#documentItemRepository = new UmbDocumentItemRepository(this);\r\n\t#modalManagerContext?: UmbModalManagerContext;\r\n\t#documentPickerModalContext?: any;\r\n\t#entityUserPermissionModalContext?: any;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (instance) => (this.#modalManagerContext = instance));\r\n\t}\r\n\r\n\tprotected override getFormElement() {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tasync #observePickedDocuments(uniques: Array<string>) {\r\n\t\tconst { asObservable } = await this.#documentItemRepository.requestItems(uniques);\r\n\t\tthis.observe(asObservable(), (items) => (this._items = items));\r\n\t}\r\n\r\n\tasync #editGranularPermission(item: UmbDocumentItemModel) {\r\n\t\tconst currentPermissionVerbs = this.#getPermissionForDocument(item.unique)?.verbs ?? [];\r\n\t\tconst result = await this.#selectEntityUserPermissionsForDocument(item, currentPermissionVerbs);\r\n\t\t// don't do anything if the verbs have not been updated\r\n\t\tif (JSON.stringify(result) === JSON.stringify(currentPermissionVerbs)) return;\r\n\r\n\t\t// update permission with new verbs\r\n\t\tthis.permissions = this._permissions.map((permission) => {\r\n\t\t\tif (permission.document.id === item.unique) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...permission,\r\n\t\t\t\t\tverbs: result,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn permission;\r\n\t\t});\r\n\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\tasync #addGranularPermission() {\r\n\t\tthis.#documentPickerModalContext = this.#modalManagerContext?.open(this, UMB_DOCUMENT_PICKER_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\thideTreeRoot: true,\r\n\t\t\t\t// prevent already selected items to be picked again\r\n\t\t\t\t// TODO: this type is wrong. It should be the tree item type\r\n\t\t\t\tpickableFilter: (treeItem: UmbDocumentItemModel) =>\r\n\t\t\t\t\t!this._items?.map((i) => i.unique).includes(treeItem.unique),\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.#documentPickerModalContext?.addEventListener(UmbSelectedEvent.TYPE, async (event: UmbDeselectedEvent) => {\r\n\t\t\tconst selectedEvent = event as UmbSelectedEvent;\r\n\t\t\tconst unique = selectedEvent.unique;\r\n\t\t\tif (!unique) return;\r\n\r\n\t\t\tconst documentItem = await this.#requestDocumentItem(unique);\r\n\r\n\t\t\tthis.#selectEntityUserPermissionsForDocument(documentItem).then(\r\n\t\t\t\t(result) => {\r\n\t\t\t\t\tthis.#documentPickerModalContext?.reject();\r\n\r\n\t\t\t\t\tconst permissionItem: UmbDocumentUserPermissionModel = {\r\n\t\t\t\t\t\t$type: 'DocumentPermissionPresentationModel',\r\n\t\t\t\t\t\tdocument: { id: unique },\r\n\t\t\t\t\t\tverbs: result,\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tthis.permissions = [...this._permissions, permissionItem];\r\n\t\t\t\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t\t\t\t},\r\n\t\t\t\t() => {\r\n\t\t\t\t\tthis.#documentPickerModalContext?.reject();\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tasync #requestDocumentItem(unique: string) {\r\n\t\tif (!unique) throw new Error('Could not open permissions modal, no unique was provided');\r\n\r\n\t\tconst { data } = await this.#documentItemRepository.requestItems([unique]);\r\n\r\n\t\tconst documentItem = data?.[0];\r\n\t\tif (!documentItem) throw new Error('No document item found');\r\n\t\treturn documentItem;\r\n\t}\r\n\r\n\tasync #selectEntityUserPermissionsForDocument(item: UmbDocumentItemModel, allowedVerbs: Array<string> = []) {\r\n\t\t// TODO: get correct variant name\r\n\t\tconst name = item.variants[0]?.name;\r\n\t\tconst headline = name ? `Permissions for ${name}` : 'Permissions';\r\n\r\n\t\tthis.#entityUserPermissionModalContext = this.#modalManagerContext?.open(this, UMB_ENTITY_USER_PERMISSION_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tunique: item.unique,\r\n\t\t\t\tentityType: item.entityType,\r\n\t\t\t\theadline,\r\n\t\t\t},\r\n\t\t\tvalue: {\r\n\t\t\t\tallowedVerbs,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\ttry {\r\n\t\t\tconst value = await this.#entityUserPermissionModalContext?.onSubmit();\r\n\t\t\treturn value?.allowedVerbs;\r\n\t\t} catch {\r\n\t\t\tthrow new Error();\r\n\t\t}\r\n\t}\r\n\r\n\t#removeGranularPermission(item: UmbDocumentItemModel) {\r\n\t\tconst permission = this.#getPermissionForDocument(item.unique);\r\n\t\tif (!permission) return;\r\n\r\n\t\tthis.permissions = this._permissions.filter((v) => JSON.stringify(v) !== JSON.stringify(permission));\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`${this.#renderItems()} ${this.#renderAddButton()}`;\r\n\t}\r\n\r\n\t#renderItems() {\r\n\t\tif (!this._items) return;\r\n\t\treturn html`\r\n\t\t\t<uui-ref-list>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._items,\r\n\t\t\t\t\t(item) => item.unique,\r\n\t\t\t\t\t(item) => this.#renderRef(item),\r\n\t\t\t\t)}\r\n\t\t\t</uui-ref-list>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderAddButton() {\r\n\t\treturn html`<uui-button\r\n\t\t\tid=\"btn-add\"\r\n\t\t\tlook=\"placeholder\"\r\n\t\t\t@click=${this.#addGranularPermission}\r\n\t\t\tlabel=${this.localize.term('general_add')}></uui-button>`;\r\n\t}\r\n\r\n\t#renderRef(item: UmbDocumentItemModel) {\r\n\t\tif (!item.unique) return;\r\n\t\t// TODO: get correct variant name\r\n\t\tconst name = item.variants[0]?.name;\r\n\t\tconst permissionNames = this.#getPermissionNamesForDocument(item.unique);\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-ref-node .name=${name} .detail=${permissionNames || ''}>\r\n\t\t\t\t${this.#renderIcon(item)} ${this.#renderIsTrashed(item)}\r\n\t\t\t\t<uui-action-bar slot=\"actions\">\r\n\t\t\t\t\t${this.#renderEditButton(item)} ${this.#renderRemoveButton(item)}\r\n\t\t\t\t</uui-action-bar>\r\n\t\t\t</uui-ref-node>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderIcon(item: UmbDocumentItemModel) {\r\n\t\tif (!item.documentType.icon) return;\r\n\t\treturn html`<uui-icon slot=\"icon\" name=${item.documentType.icon}></uui-icon>`;\r\n\t}\r\n\r\n\t#renderIsTrashed(item: UmbDocumentItemModel) {\r\n\t\tif (!item.isTrashed) return;\r\n\t\treturn html`<uui-tag size=\"s\" slot=\"tag\" color=\"danger\">Trashed</uui-tag>`;\r\n\t}\r\n\r\n\t#renderEditButton(item: UmbDocumentItemModel) {\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\t@click=${() => this.#editGranularPermission(item)}\r\n\t\t\t\tlabel=${this.localize.term('general_edit')}></uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderRemoveButton(item: UmbDocumentItemModel) {\r\n\t\treturn html`<uui-button\r\n\t\t\t@click=${() => this.#removeGranularPermission(item)}\r\n\t\t\tlabel=${this.localize.term('general_remove')}></uui-button>`;\r\n\t}\r\n\r\n\t#getPermissionForDocument(unique: string) {\r\n\t\treturn this._permissions?.find((permission) => permission.document.id === unique);\r\n\t}\r\n\r\n\t#getPermissionNamesForDocument(unique: string) {\r\n\t\tconst permission = this.#getPermissionForDocument(unique);\r\n\t\tif (!permission) return;\r\n\r\n\t\treturn umbExtensionsRegistry\r\n\t\t\t.getAllExtensions()\r\n\t\t\t.filter((manifest) => manifest.type === 'entityUserPermission')\r\n\t\t\t.filter((manifest) =>\r\n\t\t\t\t(manifest as ManifestEntityUserPermission).meta.verbs.every((verb) => permission.verbs.includes(verb)),\r\n\t\t\t)\r\n\t\t\t.map((m) => {\r\n\t\t\t\tconst manifest = m as ManifestEntityUserPermission;\r\n\t\t\t\treturn manifest.meta.label ? this.localize.string(manifest.meta.label) : manifest.name;\r\n\t\t\t})\r\n\t\t\t.join(', ');\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t#btn-add {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbInputDocumentGranularUserPermissionElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-document-granular-user-permission': UmbInputDocumentGranularUserPermissionElement;\r\n\t}\r\n}\r\n"],"names":["_documentItemRepository","_modalManagerContext","_documentPickerModalContext","_entityUserPermissionModalContext","_UmbInputDocumentGranularUserPermissionElement_instances","observePickedDocuments_fn","editGranularPermission_fn","addGranularPermission_fn","requestDocumentItem_fn","selectEntityUserPermissionsForDocument_fn","removeGranularPermission_fn","renderItems_fn","renderAddButton_fn","renderRef_fn","renderIcon_fn","renderIsTrashed_fn","renderEditButton_fn","renderRemoveButton_fn","getPermissionForDocument_fn","getPermissionNamesForDocument_fn","UmbInputDocumentGranularUserPermissionElement","UUIFormControlMixin","UmbLitElement","__privateAdd","UmbDocumentItemRepository","UMB_MODAL_MANAGER_CONTEXT","instance","__privateSet","value","uniques","item","__privateMethod","html","asObservable","__privateGet","items","currentPermissionVerbs","result","permission","UmbChangeEvent","UMB_DOCUMENT_PICKER_MODAL","treeItem","i","UmbSelectedEvent","event","unique","documentItem","permissionItem","data","allowedVerbs","name","headline","UMB_ENTITY_USER_PERMISSION_MODAL","v","repeat","permissionNames","umbExtensionsRegistry","manifest","verb","m","css","__decorateClass","state","customElement","UmbInputDocumentGranularUserPermissionElement$1"],"mappings":";;;;;;;;;;;;;;;;;;;;wYAAAA,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC;AAkBO,IAAMC,IAAN,cAA4DC,EAAoBC,GAAe,EAAE,EAAE;AAAA,EAmBzG,cAAc;AACP,UAAA,GApBDC,EAAA,MAAAnB,CAAA,GACN,KAAA,eAAsD,CAAC,GAa7BmB,EAAA,MAAAvB,GAAA,IAAIwB,EAA0B,IAAI,CAAA,GAC5DD,EAAA,MAAAtB,CAAA,GACAsB,EAAA,MAAArB,CAAA,GACAqB,EAAA,MAAApB,CAAA,GAKC,KAAK,eAAesB,GAA2B,CAACC,MAAcC,EAAA,MAAK1B,GAAuByB,CAAS,CAAA;AAAA,EAAA;AAAA,EApBpG,IAAW,cAAqD;AAC/D,WAAO,KAAK;AAAA,EAAA;AAAA,EAEb,IAAW,YAAYE,GAA8C;AACpE,SAAK,eAAeA;AACpB,UAAMC,IAAUD,EAAM,IAAI,CAACE,MAASA,EAAK,SAAS,EAAE;AACpD,IAAAC,EAAA,MAAK3B,MAAL,KAA6B,MAAAyB,CAAA;AAAA,EAAA;AAAA,EAiBX,iBAAiB;AAAA,EAC5B;AAAA,EA4GC,SAAS;AACjB,WAAOG,IAAOD,EAAK,MAAA3B,GAAAO,CAAA,EAAL,UAAmB,IAAIoB,EAAA,MAAK3B,MAAL,KAAuB,IAAA,CAAA;AAAA,EAAA;AA4F9D;AArNCJ,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AAjBMC,IAAA,oBAAA,QAAA;AA6BAC,IAAuB,eAACwB,GAAwB;AACrD,QAAM,EAAE,cAAAI,EAAa,IAAI,MAAMC,EAAK,MAAAlC,CAAA,EAAwB,aAAa6B,CAAO;AAChF,OAAK,QAAQI,EAAa,GAAG,CAACE,MAAW,KAAK,SAASA,CAAM;AAC9D;AAEM7B,IAAuB,eAACwB,GAA4B;AACzD,QAAMM,IAAyBL,EAAK,MAAA3B,GAAAc,CAAA,EAAL,WAA+BY,EAAK,MAAA,GAAS,SAAS,CAAC,GAChFO,IAAS,MAAMN,EAAK,MAAA3B,GAAAK,CAAA,EAAL,WAA6CqB,GAAMM,CAAA;AAExE,EAAI,KAAK,UAAUC,CAAM,MAAM,KAAK,UAAUD,CAAsB,MAGpE,KAAK,cAAc,KAAK,aAAa,IAAI,CAACE,MACrCA,EAAW,SAAS,OAAOR,EAAK,SAC5B;AAAA,IACN,GAAGQ;AAAA,IACH,OAAOD;AAAA,EACR,IAEMC,CACP,GAEI,KAAA,cAAc,IAAIC,GAAgB;AACxC;AAEMhC,IAAsB,iBAAG;AAC9B,EAAAoB,EAAA,MAAKzB,GAA8BgC,EAAA,MAAKjC,CAAsB,GAAA,KAAK,MAAMuC,GAA2B;AAAA,IACnG,MAAM;AAAA,MACL,cAAc;AAAA;AAAA;AAAA,MAGd,gBAAgB,CAACC,MAChB,CAAC,KAAK,QAAQ,IAAI,CAACC,MAAMA,EAAE,MAAM,EAAE,SAASD,EAAS,MAAM;AAAA,IAAA;AAAA,EAC7D,CACA,CAAA,GAEDP,EAAA,MAAKhC,CAA6B,GAAA,iBAAiByC,EAAiB,MAAM,OAAOC,MAA8B;AAE9G,UAAMC,IADgBD,EACO;AAC7B,QAAI,CAACC,EAAQ;AAEb,UAAMC,IAAe,MAAMf,EAAK,MAAA3B,GAAAI,CAAA,EAAL,KAA0B,MAAAqC,CAAA;AAEhD,IAAAd,EAAA,MAAA3B,GAAAK,CAAA,EAAL,WAA6CqC,CAAc,EAAA;AAAA,MAC1D,CAACT,MAAW;AACX,QAAAH,EAAA,MAAKhC,IAA6B,OAAO;AAEzC,cAAM6C,IAAiD;AAAA,UACtD,OAAO;AAAA,UACP,UAAU,EAAE,IAAIF,EAAO;AAAA,UACvB,OAAOR;AAAA,QACR;AAEA,aAAK,cAAc,CAAC,GAAG,KAAK,cAAcU,CAAc,GACnD,KAAA,cAAc,IAAIR,GAAgB;AAAA,MACxC;AAAA,MACA,MAAM;AACL,QAAAL,EAAA,MAAKhC,IAA6B,OAAO;AAAA,MAAA;AAAA,IAE3C;AAAA,EAAA,CACA;AACF;AAEMM,IAAoB,eAACqC,GAAgB;AAC1C,MAAI,CAACA,EAAc,OAAA,IAAI,MAAM,0DAA0D;AAEjF,QAAA,EAAE,MAAAG,MAAS,MAAMd,QAAKlC,CAAwB,EAAA,aAAa,CAAC6C,CAAM,CAAC,GAEnEC,IAAeE,IAAO,CAAC;AAC7B,MAAI,CAACF,EAAoB,OAAA,IAAI,MAAM,wBAAwB;AACpD,SAAAA;AACR;AAEMrC,IAAuC,eAACqB,GAA4BmB,IAA8B,IAAI;AAE3G,QAAMC,IAAOpB,EAAK,SAAS,CAAC,GAAG,MACzBqB,IAAWD,IAAO,mBAAmBA,CAAI,KAAK;AAEpD,EAAAvB,EAAA,MAAKxB,GAAoC+B,EAAA,MAAKjC,CAAsB,GAAA,KAAK,MAAMmD,GAAkC;AAAA,IAChH,MAAM;AAAA,MACL,QAAQtB,EAAK;AAAA,MACb,YAAYA,EAAK;AAAA,MACjB,UAAAqB;AAAA,IACD;AAAA,IACA,OAAO;AAAA,MACN,cAAAF;AAAA,IAAA;AAAA,EACD,CACA,CAAA;AAEG,MAAA;AAEH,YADc,MAAMf,EAAK,MAAA/B,CAAA,GAAmC,SAAS,IACvD;AAAA,EAAA,QACP;AACP,UAAM,IAAI,MAAM;AAAA,EAAA;AAElB;AAEAO,IAAyB,SAACoB,GAA4B;AACrD,QAAMQ,IAAaP,EAAA,MAAK3B,GAALc,CAAA,EAAA,KAAA,MAA+BY,EAAK,MAAA;AACvD,EAAKQ,MAEL,KAAK,cAAc,KAAK,aAAa,OAAO,CAACe,MAAM,KAAK,UAAUA,CAAC,MAAM,KAAK,UAAUf,CAAU,CAAC,GAC9F,KAAA,cAAc,IAAIC,GAAgB;AACxC;AAMA5B,IAAY,WAAG;AACV,MAAC,KAAK;AACH,WAAAqB;AAAA;AAAA,MAEHsB;AAAA,MACD,KAAK;AAAA,MACL,CAACxB,MAASA,EAAK;AAAA,MACf,CAACA,MAASC,EAAK,MAAA3B,GAAAS,CAAA,EAAL,KAAgB,MAAAiB,CAAA;AAAA,IAC1B,CAAA;AAAA;AAAA;AAGJ;AAEAlB,IAAgB,WAAG;AACX,SAAAoB;AAAA;AAAA;AAAA,YAGGD,QAAK3B,GAAsBG,CAAA,CAAA;AAAA,WAC5B,KAAK,SAAS,KAAK,aAAa,CAAC;AAC3C;AAEAM,IAAU,SAACiB,GAA4B;AAClC,MAAA,CAACA,EAAK,OAAQ;AAElB,QAAMoB,IAAOpB,EAAK,SAAS,CAAC,GAAG,MACzByB,IAAkBxB,EAAA,MAAK3B,GAALe,CAAA,EAAA,KAAA,MAAoCW,EAAK,MAAA;AAE1D,SAAAE;AAAA,yBACgBkB,CAAI,YAAYK,KAAmB,EAAE;AAAA,MACxDxB,EAAA,MAAK3B,MAAL,KAAiB,MAAA0B,CAAA,CAAK,IAAIC,EAAK,MAAA3B,GAAAW,CAAA,EAAL,WAAsBe,CAAK,CAAA;AAAA;AAAA,OAEpDC,EAAA,MAAK3B,MAAL,KAAuB,MAAA0B,CAAA,CAAK,IAAIC,EAAK,MAAA3B,GAAAa,CAAA,EAAL,WAAyBa,CAAK,CAAA;AAAA;AAAA;AAAA;AAIpE;AAEAhB,IAAW,SAACgB,GAA4B;AACnC,MAACA,EAAK,aAAa;AAChB,WAAAE,+BAAkCF,EAAK,aAAa,IAAI;AAChE;AAEAf,IAAgB,SAACe,GAA4B;AACxC,MAACA,EAAK;AACH,WAAAE;AACR;AAEAhB,IAAiB,SAACc,GAA4B;AACtC,SAAAE;AAAA;AAAA,aAEI,MAAMD,EAAA,MAAK3B,GAALE,CAAA,EAAA,KAAA,MAA6BwB,CAAK,CAAA;AAAA,YACzC,KAAK,SAAS,KAAK,cAAc,CAAC;AAAA;AAE7C;AAEAb,IAAmB,SAACa,GAA4B;AACxC,SAAAE;AAAA,YACG,MAAMD,EAAA,MAAK3B,GAALM,CAAA,EAAA,KAAA,MAA+BoB,CAAK,CAAA;AAAA,WAC3C,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAC9C;AAEAZ,IAAyB,SAAC2B,GAAgB;AAClC,SAAA,KAAK,cAAc,KAAK,CAACP,MAAeA,EAAW,SAAS,OAAOO,CAAM;AACjF;AAEA1B,IAA8B,SAAC0B,GAAgB;AACxC,QAAAP,IAAaP,EAAK,MAAA3B,GAAAc,CAAA,EAAL,KAA+B,MAAA2B,CAAA;AAClD,MAAKP;AAEE,WAAAkB,EACL,iBACA,EAAA,OAAO,CAACC,MAAaA,EAAS,SAAS,sBAAsB,EAC7D;AAAA,MAAO,CAACA,MACPA,EAA0C,KAAK,MAAM,MAAM,CAACC,MAASpB,EAAW,MAAM,SAASoB,CAAI,CAAC;AAAA,IAAA,EAErG,IAAI,CAACC,MAAM;AACX,YAAMF,IAAWE;AACV,aAAAF,EAAS,KAAK,QAAQ,KAAK,SAAS,OAAOA,EAAS,KAAK,KAAK,IAAIA,EAAS;AAAA,IAAA,CAClF,EACA,KAAK,IAAI;AACZ;AA1NYrC,EA4NI,SAAS;AAAA,EACxBwC;AAAA;AAAA;AAAA;AAAA;AAKD;AAtNQC,EAAA;AAAA,EADPC,EAAM;AAAA,GAXK1C,EAYJ,WAAA,UAAA,CAAA;AAZIA,IAANyC,EAAA;AAAA,EADNE,EAAc,6CAA6C;AAAA,GAC/C3C,CAAA;AAqOb,MAAA4C,KAAe5C;"}