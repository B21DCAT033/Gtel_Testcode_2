{"version":3,"file":"media-references-workspace-info-app.element-DRYixYUW.js","sources":["../../../src/packages/media/media/reference/info-app/media-references-workspace-info-app.element.ts"],"sourcesContent":["import { UmbMediaReferenceRepository } from '../repository/index.js';\r\nimport { UMB_MEDIA_WORKSPACE_CONTEXT } from '../../workspace/constants.js';\r\nimport { css, customElement, html, nothing, repeat, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { UmbReferenceItemModel } from '@umbraco-cms/backoffice/relations';\r\nimport type { UUIPaginationEvent } from '@umbraco-cms/backoffice/external/uui';\r\nimport type { UmbEntityUnique } from '@umbraco-cms/backoffice/entity';\r\n\r\n@customElement('umb-media-references-workspace-info-app')\r\nexport class UmbMediaReferencesWorkspaceInfoAppElement extends UmbLitElement {\r\n\t#itemsPerPage = 10;\r\n\r\n\t#referenceRepository;\r\n\r\n\t@state()\r\n\tprivate _currentPage = 1;\r\n\r\n\t@state()\r\n\tprivate _total = 0;\r\n\r\n\t@state()\r\n\tprivate _items?: Array<UmbReferenceItemModel> = [];\r\n\r\n\t@state()\r\n\tprivate _loading = true;\r\n\r\n\t#workspaceContext?: typeof UMB_MEDIA_WORKSPACE_CONTEXT.TYPE;\r\n\t#mediaUnique?: UmbEntityUnique;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.#referenceRepository = new UmbMediaReferenceRepository(this);\r\n\r\n\t\tthis.consumeContext(UMB_MEDIA_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tthis.#workspaceContext = context;\r\n\t\t\tthis.#observeMediaUnique();\r\n\t\t});\r\n\t}\r\n\r\n\t#observeMediaUnique() {\r\n\t\tthis.observe(\r\n\t\t\tthis.#workspaceContext?.unique,\r\n\t\t\t(unique) => {\r\n\t\t\t\tif (!unique) {\r\n\t\t\t\t\tthis.#mediaUnique = undefined;\r\n\t\t\t\t\tthis._items = [];\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.#mediaUnique === unique) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.#mediaUnique = unique;\r\n\t\t\t\tthis.#getReferences();\r\n\t\t\t},\r\n\t\t\t'umbReferencesDocumentUniqueObserver',\r\n\t\t);\r\n\t}\r\n\r\n\tprotected override firstUpdated(): void {\r\n\t\tthis.#getReferences();\r\n\t}\r\n\r\n\tasync #getReferences() {\r\n\t\tif (!this.#mediaUnique) {\r\n\t\t\tthrow new Error('Media unique is required');\r\n\t\t}\r\n\r\n\t\tthis._loading = true;\r\n\r\n\t\tconst { data } = await this.#referenceRepository.requestReferencedBy(\r\n\t\t\tthis.#mediaUnique,\r\n\t\t\t(this._currentPage - 1) * this.#itemsPerPage,\r\n\t\t\tthis.#itemsPerPage,\r\n\t\t);\r\n\r\n\t\tif (!data) return;\r\n\r\n\t\tthis._total = data.total;\r\n\t\tthis._items = data.items;\r\n\r\n\t\tthis._loading = false;\r\n\t}\r\n\r\n\t#onPageChange(event: UUIPaginationEvent) {\r\n\t\tif (this._currentPage === event.target.current) return;\r\n\t\tthis._currentPage = event.target.current;\r\n\r\n\t\tthis.#getReferences();\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this._items?.length) return nothing;\r\n\t\treturn html`\r\n\t\t\t<umb-workspace-info-app-layout headline=\"#references_labelUsedByItems\">\r\n\t\t\t\t${when(\r\n\t\t\t\t\tthis._loading,\r\n\t\t\t\t\t() => html`<uui-loader></uui-loader>`,\r\n\t\t\t\t\t() => html`${this.#renderItems()} ${this.#renderPagination()}`,\r\n\t\t\t\t)}\r\n\t\t\t</umb-workspace-info-app-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderItems() {\r\n\t\tif (!this._items) return;\r\n\t\treturn html`\r\n\t\t\t<uui-ref-list>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._items,\r\n\t\t\t\t\t(item) => item.unique,\r\n\t\t\t\t\t(item) => html`<umb-entity-item-ref .item=${item}></umb-entity-item-ref>`,\r\n\t\t\t\t)}\r\n\t\t\t</uui-ref-list>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderPagination() {\r\n\t\tif (!this._total) return nothing;\r\n\r\n\t\tconst totalPages = Math.ceil(this._total / this.#itemsPerPage);\r\n\r\n\t\tif (totalPages <= 1) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<div class=\"pagination\">\r\n\t\t\t\t<uui-pagination .total=${totalPages} @change=${this.#onPageChange}></uui-pagination>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: contents;\r\n\t\t\t}\r\n\r\n\t\t\tuui-table-cell {\r\n\t\t\t\tcolor: var(--uui-color-text-alt);\r\n\t\t\t}\r\n\r\n\t\t\tuui-pagination {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tdisplay: inline-block;\r\n\t\t\t}\r\n\r\n\t\t\t.pagination {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\tmargin-top: var(--uui-size-space-4);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbMediaReferencesWorkspaceInfoAppElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-media-references-workspace-info-app': UmbMediaReferencesWorkspaceInfoAppElement;\r\n\t}\r\n}\r\n"],"names":["_itemsPerPage","_referenceRepository","_workspaceContext","_mediaUnique","_UmbMediaReferencesWorkspaceInfoAppElement_instances","observeMediaUnique_fn","getReferences_fn","onPageChange_fn","renderItems_fn","renderPagination_fn","UmbMediaReferencesWorkspaceInfoAppElement","UmbLitElement","__privateAdd","__privateSet","UmbMediaReferenceRepository","UMB_MEDIA_WORKSPACE_CONTEXT","context","__privateMethod","html","when","nothing","__privateGet","unique","data","event","repeat","item","totalPages","UmbTextStyles","css","__decorateClass","state","customElement","UmbMediaReferencesWorkspaceInfoAppElement$1"],"mappings":"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"}