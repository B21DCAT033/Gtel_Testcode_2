{"version":3,"file":"media-validation.repository-3oFTDjyn.js","sources":["../../../src/packages/media/media/repository/validation/media-validation.server.data-source.ts","../../../src/packages/media/media/repository/validation/media-validation.repository.ts"],"sourcesContent":["import type { UmbMediaDetailModel } from '../../types.js';\r\nimport {\r\n\ttype CreateMediaRequestModel,\r\n\tMediaService,\r\n\ttype UpdateMediaRequestModel,\r\n} from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport type { UmbEntityUnique } from '@umbraco-cms/backoffice/entity';\r\n\r\n/**\r\n * A server data source for Media Validation\r\n */\r\nexport class UmbMediaValidationServerDataSource {\r\n\t//#host: UmbControllerHost;\r\n\r\n\t// TODO: [v15]: ignoring unused var here here to prevent a breaking change\r\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\t//this.#host = host;\r\n\t}\r\n\r\n\t/**\r\n\t * Validate a new Media on the server\r\n\t * @param {UmbMediaDetailModel} model - Media Model\r\n\t * @param {UmbEntityUnique} parentUnique - Parent Unique\r\n\t * @returns {*}\r\n\t */\r\n\tasync validateCreate(model: UmbMediaDetailModel, parentUnique: UmbEntityUnique = null) {\r\n\t\tif (!model) throw new Error('Media is missing');\r\n\t\tif (!model.unique) throw new Error('Media unique is missing');\r\n\t\tif (parentUnique === undefined) throw new Error('Parent unique is missing');\r\n\r\n\t\t// TODO: make data mapper to prevent errors\r\n\t\tconst requestBody: CreateMediaRequestModel = {\r\n\t\t\tid: model.unique,\r\n\t\t\tparent: parentUnique ? { id: parentUnique } : null,\r\n\t\t\tmediaType: { id: model.mediaType.unique },\r\n\t\t\tvalues: model.values,\r\n\t\t\tvariants: model.variants,\r\n\t\t};\r\n\r\n\t\t// Maybe use: tryExecuteAndNotify\r\n\t\treturn tryExecute(\r\n\t\t\t//this.#host,\r\n\t\t\tMediaService.postMediaValidate({\r\n\t\t\t\trequestBody,\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Validate a existing Media\r\n\t * @param {UmbMediaDetailModel} model - Media Model\r\n\t * @param {Array<UmbVariantId>} variantIds - Variant Ids\r\n\t * @returns {Promise<*>} - The response from the server\r\n\t */\r\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\tasync validateUpdate(model: UmbMediaDetailModel, variantIds: Array<UmbVariantId>) {\r\n\t\tif (!model.unique) throw new Error('Unique is missing');\r\n\r\n\t\t//const cultures = variantIds.map((id) => id.culture).filter((culture) => culture !== null) as Array<string>;\r\n\r\n\t\t// TODO: make data mapper to prevent errors\r\n\t\tconst requestBody: UpdateMediaRequestModel = {\r\n\t\t\tvalues: model.values,\r\n\t\t\tvariants: model.variants,\r\n\t\t};\r\n\r\n\t\t// Maybe use: tryExecuteAndNotify\r\n\t\treturn tryExecute(\r\n\t\t\t//this.#host,\r\n\t\t\tMediaService.putMediaByIdValidate({\r\n\t\t\t\tid: model.unique,\r\n\t\t\t\trequestBody,\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n}\r\n","import type { UmbMediaDetailModel } from '../../types.js';\r\nimport { UmbMediaValidationServerDataSource } from './media-validation.server.data-source.js';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbRepositoryBase } from '@umbraco-cms/backoffice/repository';\r\nimport type { UmbContentValidationRepository } from '@umbraco-cms/backoffice/content';\r\n\r\ntype DetailModelType = UmbMediaDetailModel;\r\n\r\nexport class UmbMediaValidationRepository\r\n\textends UmbRepositoryBase\r\n\timplements UmbContentValidationRepository<DetailModelType>\r\n{\r\n\t#validationDataSource: UmbMediaValidationServerDataSource;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\r\n\t\tthis.#validationDataSource = new UmbMediaValidationServerDataSource(this);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a promise with an observable of the detail for the given unique\r\n\t * @param {DetailModelType} model - The model to validate\r\n\t * @param {string | null} [parentUnique] - The parent unique\r\n\t * @returns {*}\r\n\t */\r\n\tasync validateCreate(model: DetailModelType, parentUnique: string | null) {\r\n\t\tif (!model) throw new Error('Data is missing');\r\n\r\n\t\treturn this.#validationDataSource.validateCreate(model, parentUnique);\r\n\t}\r\n\r\n\t/**\r\n\t * Saves the given data\r\n\t * @param {DetailModelType} model - The model to save\r\n\t * @param {Array<UmbVariantId>} variantIds - The variant ids to save\r\n\t * @returns {*}\r\n\t */\r\n\tasync validateSave(model: DetailModelType, variantIds: Array<UmbVariantId>) {\r\n\t\tif (!model) throw new Error('Data is missing');\r\n\t\tif (!model.unique) throw new Error('Unique is missing');\r\n\r\n\t\treturn this.#validationDataSource.validateUpdate(model, variantIds);\r\n\t}\r\n}\r\n\r\nexport { UmbMediaValidationRepository as api };\r\n"],"names":["UmbMediaValidationServerDataSource","host","model","parentUnique","requestBody","tryExecute","MediaService","variantIds","UmbMediaValidationRepository","UmbRepositoryBase","#validationDataSource"],"mappings":";;;AAcO,MAAMA,EAAmC;AAAA;AAAA;AAAA;AAAA,EAK/C,YAAYC,GAAyB;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUrC,MAAM,eAAeC,GAA4BC,IAAgC,MAAM;AACtF,QAAI,CAACD,EAAa,OAAA,IAAI,MAAM,kBAAkB;AAC9C,QAAI,CAACA,EAAM,OAAc,OAAA,IAAI,MAAM,yBAAyB;AAC5D,QAAIC,MAAiB,OAAiB,OAAA,IAAI,MAAM,0BAA0B;AAG1E,UAAMC,IAAuC;AAAA,MAC5C,IAAIF,EAAM;AAAA,MACV,QAAQC,IAAe,EAAE,IAAIA,EAAiB,IAAA;AAAA,MAC9C,WAAW,EAAE,IAAID,EAAM,UAAU,OAAO;AAAA,MACxC,QAAQA,EAAM;AAAA,MACd,UAAUA,EAAM;AAAA,IACjB;AAGO,WAAAG;AAAA;AAAA,MAENC,EAAa,kBAAkB;AAAA,QAC9B,aAAAF;AAAA,MACA,CAAA;AAAA,IACF;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUD,MAAM,eAAeF,GAA4BK,GAAiC;AACjF,QAAI,CAACL,EAAM,OAAc,OAAA,IAAI,MAAM,mBAAmB;AAKtD,UAAME,IAAuC;AAAA,MAC5C,QAAQF,EAAM;AAAA,MACd,UAAUA,EAAM;AAAA,IACjB;AAGO,WAAAG;AAAA;AAAA,MAENC,EAAa,qBAAqB;AAAA,QACjC,IAAIJ,EAAM;AAAA,QACV,aAAAE;AAAA,MACA,CAAA;AAAA,IACF;AAAA,EAAA;AAEF;ACtEO,MAAMI,UACJC,EAET;AAAA,EACCC;AAAA,EAEA,YAAYT,GAAyB;AACpC,UAAMA,CAAI,GAEL,KAAAS,KAAwB,IAAIV,EAAmC,IAAI;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASzE,MAAM,eAAeE,GAAwBC,GAA6B;AACzE,QAAI,CAACD,EAAa,OAAA,IAAI,MAAM,iBAAiB;AAE7C,WAAO,KAAKQ,GAAsB,eAAeR,GAAOC,CAAY;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASrE,MAAM,aAAaD,GAAwBK,GAAiC;AAC3E,QAAI,CAACL,EAAa,OAAA,IAAI,MAAM,iBAAiB;AAC7C,QAAI,CAACA,EAAM,OAAc,OAAA,IAAI,MAAM,mBAAmB;AAEtD,WAAO,KAAKQ,GAAsB,eAAeR,GAAOK,CAAU;AAAA,EAAA;AAEpE;"}