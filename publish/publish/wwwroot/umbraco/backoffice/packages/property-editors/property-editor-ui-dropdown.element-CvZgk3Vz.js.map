{"version":3,"file":"property-editor-ui-dropdown.element-CvZgk3Vz.js","sources":["../../../src/packages/property-editors/dropdown/property-editor-ui-dropdown.element.ts"],"sourcesContent":["import { css, customElement, html, map, nothing, property, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbPropertyValueChangeEvent } from '@umbraco-cms/backoffice/property-editor';\r\nimport { UUISelectElement } from '@umbraco-cms/backoffice/external/uui';\r\nimport type {\r\n\tUmbPropertyEditorConfigCollection,\r\n\tUmbPropertyEditorUiElement,\r\n} from '@umbraco-cms/backoffice/property-editor';\r\nimport type { UUISelectEvent } from '@umbraco-cms/backoffice/external/uui';\r\n\r\n/**\r\n * @element umb-property-editor-ui-dropdown\r\n */\r\n@customElement('umb-property-editor-ui-dropdown')\r\nexport class UmbPropertyEditorUIDropdownElement extends UmbLitElement implements UmbPropertyEditorUiElement {\r\n\t#selection: Array<string> = [];\r\n\r\n\t@property({ type: Array })\r\n\tpublic set value(value: Array<string> | string | undefined) {\r\n\t\tthis.#selection = Array.isArray(value) ? value : value ? [value] : [];\r\n\t}\r\n\tpublic get value(): Array<string> | undefined {\r\n\t\treturn this.#selection;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the input to readonly mode, meaning value cannot be changed but still able to read and select its content.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default false\r\n\t */\r\n\t@property({ type: Boolean, reflect: true })\r\n\treadonly = false;\r\n\r\n\tpublic set config(config: UmbPropertyEditorConfigCollection | undefined) {\r\n\t\tif (!config) return;\r\n\r\n\t\tconst items = config.getValueByAlias('items');\r\n\r\n\t\tif (Array.isArray(items) && items.length > 0) {\r\n\t\t\tthis._options =\r\n\t\t\t\ttypeof items[0] === 'string'\r\n\t\t\t\t\t? items.map((item) => ({ name: item, value: item, selected: this.#selection.includes(item) }))\r\n\t\t\t\t\t: items.map((item) => ({\r\n\t\t\t\t\t\t\tname: item.name,\r\n\t\t\t\t\t\t\tvalue: item.value,\r\n\t\t\t\t\t\t\tselected: this.#selection.includes(item.value),\r\n\t\t\t\t\t\t}));\r\n\r\n\t\t\t// If selection includes a value that is not in the list, add it to the list\r\n\t\t\tthis.#selection.forEach((value) => {\r\n\t\t\t\tif (!this._options.find((item) => item.value === value)) {\r\n\t\t\t\t\tthis._options.push({\r\n\t\t\t\t\t\tname: `${value} (${this.localize.term('validation_legacyOption')})`,\r\n\t\t\t\t\t\tvalue,\r\n\t\t\t\t\t\tselected: true,\r\n\t\t\t\t\t\tinvalid: true,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis._multiple = config.getValueByAlias<boolean>('multiple') ?? false;\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _multiple: boolean = false;\r\n\r\n\t@state()\r\n\tprivate _options: Array<Option & { invalid?: boolean }> = [];\r\n\r\n\t#onChange(event: UUISelectEvent) {\r\n\t\tconst value = event.target.value as string;\r\n\t\tthis.#setValue(value ? [value] : []);\r\n\t}\r\n\r\n\t#onChangeMulitple(event: Event & { target: HTMLSelectElement }) {\r\n\t\tconst selected = event.target.selectedOptions;\r\n\t\tconst value = selected ? Array.from(selected).map((option) => option.value) : [];\r\n\t\tthis.#setValue(value);\r\n\t}\r\n\r\n\t#setValue(value: Array<string> | string | null | undefined) {\r\n\t\tif (!value) return;\r\n\t\tthis.value = value;\r\n\t\tthis.dispatchEvent(new UmbPropertyValueChangeEvent());\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn this._multiple ? this.#renderDropdownMultiple() : this.#renderDropdownSingle();\r\n\t}\r\n\r\n\t#renderDropdownMultiple() {\r\n\t\tif (this.readonly) {\r\n\t\t\treturn html`<div>${this.value?.join(', ')}</div>`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<select id=\"native\" multiple @change=${this.#onChangeMulitple}>\r\n\t\t\t\t${map(\r\n\t\t\t\t\tthis._options,\r\n\t\t\t\t\t(item) => html`<option value=${item.value} ?selected=${item.selected}>${item.name}</option>`,\r\n\t\t\t\t)}\r\n\t\t\t</select>\r\n\t\t\t${this.#renderDropdownValidation()}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderDropdownSingle() {\r\n\t\treturn html`\r\n\t\t\t<umb-input-dropdown-list\r\n\t\t\t\t.options=${this._options}\r\n\t\t\t\t@change=${this.#onChange}\r\n\t\t\t\t?readonly=${this.readonly}></umb-input-dropdown-list>\r\n\t\t\t${this.#renderDropdownValidation()}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderDropdownValidation() {\r\n\t\tconst selectionHasInvalids = this.#selection.some((value) => {\r\n\t\t\tconst option = this._options.find((item) => item.value === value);\r\n\t\t\treturn option ? option.invalid : false;\r\n\t\t});\r\n\r\n\t\tif (selectionHasInvalids) {\r\n\t\t\treturn html`<div class=\"error\"><umb-localize key=\"validation_legacyOptionDescription\"></umb-localize></div>`;\r\n\t\t}\r\n\r\n\t\treturn nothing;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tUUISelectElement.styles,\r\n\t\tcss`\r\n\t\t\t#native {\r\n\t\t\t\theight: auto;\r\n\t\t\t}\r\n\r\n\t\t\t.error {\r\n\t\t\t\tcolor: var(--uui-color-danger);\r\n\t\t\t\tfont-size: var(--uui-font-size-small);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbPropertyEditorUIDropdownElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-property-editor-ui-dropdown': UmbPropertyEditorUIDropdownElement;\r\n\t}\r\n}\r\n"],"names":["_selection","_UmbPropertyEditorUIDropdownElement_instances","onChange_fn","onChangeMulitple_fn","setValue_fn","renderDropdownMultiple_fn","renderDropdownSingle_fn","renderDropdownValidation_fn","UmbPropertyEditorUIDropdownElement","UmbLitElement","__privateAdd","value","__privateSet","__privateGet","config","items","item","__privateMethod","event","selected","option","UmbPropertyValueChangeEvent","html","map","nothing","UUISelectElement","css","__decorateClass","property","state","customElement","UmbPropertyEditorUIDropdownElement$1"],"mappings":"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"}