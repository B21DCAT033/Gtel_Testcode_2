{"version":3,"file":"confirm-action-entity-references.element-CahUBeLL.js","sources":["../../../src/packages/relations/relations/entity-actions/local-components/confirm-action-entity-references.element.ts"],"sourcesContent":["import type { UmbEntityReferenceRepository, UmbReferenceItemModel } from '../../reference/types.js';\r\nimport {\r\n\thtml,\r\n\tcustomElement,\r\n\tcss,\r\n\tstate,\r\n\tnothing,\r\n\ttype PropertyValues,\r\n\tproperty,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { UmbItemRepository } from '@umbraco-cms/backoffice/repository';\r\nimport { createExtensionApiByAlias } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\n@customElement('umb-confirm-action-modal-entity-references')\r\nexport class UmbConfirmActionModalEntityReferencesElement extends UmbLitElement {\r\n\t@property({ type: Object, attribute: false })\r\n\tconfig?: {\r\n\t\titemRepositoryAlias: string;\r\n\t\treferenceRepositoryAlias: string;\r\n\t\tentityType: string;\r\n\t\tunique: string;\r\n\t};\r\n\r\n\t@state()\r\n\t_referencedByItems: Array<UmbReferenceItemModel> = [];\r\n\r\n\t@state()\r\n\t_totalReferencedByItems: number = 0;\r\n\r\n\t@state()\r\n\t_totalDescendantsWithReferences: number = 0;\r\n\r\n\t@state()\r\n\t_descendantsWithReferences: Array<any> = [];\r\n\r\n\t#itemRepository?: UmbItemRepository<any>;\r\n\t#referenceRepository?: UmbEntityReferenceRepository;\r\n\r\n\t#limitItems = 3;\r\n\r\n\tprotected override firstUpdated(_changedProperties: PropertyValues): void {\r\n\t\tsuper.firstUpdated(_changedProperties);\r\n\t\tthis.#initData();\r\n\t}\r\n\r\n\tasync #initData() {\r\n\t\tif (!this.config) {\r\n\t\t\tthis.#itemRepository?.destroy();\r\n\t\t\tthis.#referenceRepository?.destroy();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.config?.referenceRepositoryAlias) {\r\n\t\t\tthrow new Error('Missing referenceRepositoryAlias in config.');\r\n\t\t}\r\n\r\n\t\tthis.#referenceRepository = await createExtensionApiByAlias<UmbEntityReferenceRepository>(\r\n\t\t\tthis,\r\n\t\t\tthis.config?.referenceRepositoryAlias,\r\n\t\t);\r\n\r\n\t\tif (!this.config?.itemRepositoryAlias) {\r\n\t\t\tthrow new Error('Missing itemRepositoryAlias in config.');\r\n\t\t}\r\n\r\n\t\tthis.#itemRepository = await createExtensionApiByAlias<UmbItemRepository<any>>(\r\n\t\t\tthis,\r\n\t\t\tthis.config.itemRepositoryAlias,\r\n\t\t);\r\n\r\n\t\tthis.#loadReferencedBy();\r\n\t\tthis.#loadDescendantsWithReferences();\r\n\t}\r\n\r\n\tasync #loadReferencedBy() {\r\n\t\tif (!this.#referenceRepository) {\r\n\t\t\tthrow new Error('Failed to create reference repository.');\r\n\t\t}\r\n\r\n\t\tif (!this.config?.unique) {\r\n\t\t\tthrow new Error('Missing unique in data.');\r\n\t\t}\r\n\r\n\t\tconst { data } = await this.#referenceRepository.requestReferencedBy(this.config.unique, 0, this.#limitItems);\r\n\r\n\t\tif (data) {\r\n\t\t\tthis._referencedByItems = [...data.items];\r\n\t\t\tthis._totalReferencedByItems = data.total;\r\n\t\t}\r\n\t}\r\n\r\n\tasync #loadDescendantsWithReferences() {\r\n\t\tif (!this.#referenceRepository) {\r\n\t\t\tthrow new Error('Failed to create reference repository.');\r\n\t\t}\r\n\r\n\t\tif (!this.#itemRepository) {\r\n\t\t\tthrow new Error('Failed to create item repository.');\r\n\t\t}\r\n\r\n\t\t// If the repository does not have the method, we don't need to load the referenced descendants.\r\n\t\tif (!this.#referenceRepository.requestDescendantsWithReferences) return;\r\n\r\n\t\tif (!this.config?.unique) {\r\n\t\t\tthrow new Error('Missing unique in data.');\r\n\t\t}\r\n\r\n\t\tconst { data } = await this.#referenceRepository.requestDescendantsWithReferences(\r\n\t\t\tthis.config.unique,\r\n\t\t\t0,\r\n\t\t\tthis.#limitItems,\r\n\t\t);\r\n\r\n\t\tif (data) {\r\n\t\t\tthis._totalDescendantsWithReferences = data.total;\r\n\t\t\tconst uniques = data.items.map((item) => item.unique).filter((unique) => unique) as Array<string>;\r\n\t\t\tconst { data: items } = await this.#itemRepository.requestItems(uniques);\r\n\t\t\tthis._descendantsWithReferences = items ?? [];\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t${this.#renderItems('references_labelDependsOnThis', this._referencedByItems, this._totalReferencedByItems)}\r\n\t\t\t${this.#renderItems(\r\n\t\t\t\t'references_labelDependentDescendants',\r\n\t\t\t\tthis._descendantsWithReferences,\r\n\t\t\t\tthis._totalDescendantsWithReferences,\r\n\t\t\t)}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderItems(headline: string, items: Array<UmbReferenceItemModel>, total: number) {\r\n\t\tif (total === 0) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<h5 class=\"uui-h5\" id=\"reference-headline\">${this.localize.term(headline)}</h5>\r\n\t\t\t<uui-ref-list>\r\n\t\t\t\t${items.map(\r\n\t\t\t\t\t(item) =>\r\n\t\t\t\t\t\thtml`<umb-entity-item-ref .item=${item} readonly ?standalone=${total === 1}></umb-entity-item-ref> `,\r\n\t\t\t\t)}\r\n\t\t\t</uui-ref-list>\r\n\t\t\t${total > this.#limitItems\r\n\t\t\t\t? html`<span>${this.localize.term('references_labelMoreReferences', total - this.#limitItems)}</span>`\r\n\t\t\t\t: nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#reference-headline {\r\n\t\t\t\tmargin-bottom: var(--uui-size-3);\r\n\t\t\t}\r\n\r\n\t\t\tuui-ref-list {\r\n\t\t\t\tmargin-bottom: var(--uui-size-2);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { UmbConfirmActionModalEntityReferencesElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-confirm-action-modal-entity-references': UmbConfirmActionModalEntityReferencesElement;\r\n\t}\r\n}\r\n"],"names":["_itemRepository","_referenceRepository","_limitItems","_UmbConfirmActionModalEntityReferencesElement_instances","initData_fn","loadReferencedBy_fn","loadDescendantsWithReferences_fn","renderItems_fn","UmbConfirmActionModalEntityReferencesElement","UmbLitElement","__privateAdd","_changedProperties","__privateMethod","html","__privateGet","__privateSet","createExtensionApiByAlias","data","uniques","item","unique","items","headline","total","nothing","UmbTextStyles","css","__decorateClass","property","state","customElement"],"mappings":"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"}