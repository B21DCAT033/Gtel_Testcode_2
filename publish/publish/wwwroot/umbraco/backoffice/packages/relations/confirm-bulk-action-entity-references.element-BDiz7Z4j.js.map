{"version":3,"file":"confirm-bulk-action-entity-references.element-BDiz7Z4j.js","sources":["../../../src/packages/relations/relations/entity-actions/local-components/confirm-bulk-action-entity-references.element.ts"],"sourcesContent":["import type { UmbEntityReferenceRepository } from '../../reference/types.js';\r\nimport {\r\n\thtml,\r\n\tcustomElement,\r\n\tcss,\r\n\tstate,\r\n\tnothing,\r\n\ttype PropertyValues,\r\n\tproperty,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { UmbItemRepository } from '@umbraco-cms/backoffice/repository';\r\nimport { createExtensionApiByAlias } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\n@customElement('umb-confirm-bulk-action-modal-entity-references')\r\nexport class UmbConfirmBulkActionModalEntityReferencesElement extends UmbLitElement {\r\n\t@property({ type: Object, attribute: false })\r\n\tconfig?: {\r\n\t\tuniques: Array<string>;\r\n\t\titemRepositoryAlias: string;\r\n\t\treferenceRepositoryAlias: string;\r\n\t};\r\n\r\n\t@state()\r\n\t_items: Array<any> = [];\r\n\r\n\t@state()\r\n\t_totalItems: number = 0;\r\n\r\n\t#itemRepository?: UmbItemRepository<any>;\r\n\t#referenceRepository?: UmbEntityReferenceRepository;\r\n\r\n\t#limitItems = 5;\r\n\r\n\tprotected override firstUpdated(_changedProperties: PropertyValues): void {\r\n\t\tsuper.firstUpdated(_changedProperties);\r\n\t\tthis.#initData();\r\n\t}\r\n\r\n\tasync #initData() {\r\n\t\tif (!this.config) {\r\n\t\t\tthis.#itemRepository?.destroy();\r\n\t\t\tthis.#referenceRepository?.destroy();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.config?.referenceRepositoryAlias) {\r\n\t\t\tthrow new Error('Missing referenceRepositoryAlias in config.');\r\n\t\t}\r\n\r\n\t\tthis.#referenceRepository = await createExtensionApiByAlias<UmbEntityReferenceRepository>(\r\n\t\t\tthis,\r\n\t\t\tthis.config?.referenceRepositoryAlias,\r\n\t\t);\r\n\r\n\t\tif (!this.config?.itemRepositoryAlias) {\r\n\t\t\tthrow new Error('Missing itemRepositoryAlias in config.');\r\n\t\t}\r\n\r\n\t\tthis.#itemRepository = await createExtensionApiByAlias<UmbItemRepository<any>>(\r\n\t\t\tthis,\r\n\t\t\tthis.config.itemRepositoryAlias,\r\n\t\t);\r\n\r\n\t\tthis.#loadAreReferenced();\r\n\t}\r\n\r\n\tasync #loadAreReferenced() {\r\n\t\tif (!this.#referenceRepository) {\r\n\t\t\tthrow new Error('Failed to create reference repository.');\r\n\t\t}\r\n\r\n\t\tif (!this.#itemRepository) {\r\n\t\t\tthrow new Error('Failed to create item repository.');\r\n\t\t}\r\n\r\n\t\tif (!this.config?.uniques) {\r\n\t\t\tthrow new Error('Missing uniques in config.');\r\n\t\t}\r\n\r\n\t\tconst { data } = await this.#referenceRepository.requestAreReferenced(this.config.uniques, 0, this.#limitItems);\r\n\r\n\t\tif (data) {\r\n\t\t\tthis._totalItems = data.total;\r\n\t\t\tconst uniques = data.items.map((item) => item.unique).filter((unique) => unique) as Array<string>;\r\n\t\t\tconst { data: items } = await this.#itemRepository.requestItems(uniques);\r\n\t\t\tthis._items = items ?? [];\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._totalItems === 0) return nothing;\r\n\r\n\t\treturn html`\r\n\t\t\t<h5 id=\"reference-headline\">The following items are used by other content.</h5>\r\n\t\t\t<uui-ref-list>\r\n\t\t\t\t${this._items.map(\r\n\t\t\t\t\t(item) =>\r\n\t\t\t\t\t\thtml`<umb-entity-item-ref\r\n\t\t\t\t\t\t\t.item=${item}\r\n\t\t\t\t\t\t\treadonly\r\n\t\t\t\t\t\t\t?standalone=${this._totalItems === 1}></umb-entity-item-ref> `,\r\n\t\t\t\t)}\r\n\t\t\t</uui-ref-list>\r\n\t\t\t${this._totalItems > this.#limitItems\r\n\t\t\t\t? html`<span\r\n\t\t\t\t\t\t>${this.localize.term('references_labelMoreReferences', this._totalItems - this.#limitItems)}</span\r\n\t\t\t\t\t>`\r\n\t\t\t\t: nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#reference-headline {\r\n\t\t\t\tmargin-bottom: var(--uui-size-3);\r\n\t\t\t}\r\n\r\n\t\t\tuui-ref-list {\r\n\t\t\t\tmargin-bottom: var(--uui-size-2);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { UmbConfirmBulkActionModalEntityReferencesElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-confirm-bulk-action-modal-entity-references': UmbConfirmBulkActionModalEntityReferencesElement;\r\n\t}\r\n}\r\n"],"names":["_itemRepository","_referenceRepository","_limitItems","_UmbConfirmBulkActionModalEntityReferencesElement_instances","initData_fn","loadAreReferenced_fn","UmbConfirmBulkActionModalEntityReferencesElement","UmbLitElement","__privateAdd","_changedProperties","__privateMethod","nothing","html","item","__privateGet","__privateSet","createExtensionApiByAlias","data","uniques","unique","items","UmbTextStyles","css","__decorateClass","property","state","customElement"],"mappings":"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"}