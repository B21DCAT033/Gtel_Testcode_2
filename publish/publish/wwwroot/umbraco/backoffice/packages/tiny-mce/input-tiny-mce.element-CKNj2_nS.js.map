{"version":3,"file":"input-tiny-mce.element-CKNj2_nS.js","sources":["../../../src/packages/tiny-mce/components/input-tiny-mce/input-tiny-mce.defaults.ts","../../../src/packages/tiny-mce/components/input-tiny-mce/input-tiny-mce.languages.ts","../../../src/packages/tiny-mce/components/input-tiny-mce/input-tiny-mce.handlers.ts","../../../src/packages/tiny-mce/components/input-tiny-mce/input-tiny-mce.sanitizer.ts","../../../src/packages/tiny-mce/components/input-tiny-mce/input-tiny-mce.element.ts"],"sourcesContent":["import { UMB_CONTEXT_REQUEST_EVENT_TYPE, type UmbContextRequestEvent } from '@umbraco-cms/backoffice/context-api';\r\nimport type { RawEditorOptions } from '@umbraco-cms/backoffice/external/tinymce';\r\nimport { UUIIconRequestEvent } from '@umbraco-cms/backoffice/external/uui';\r\n\r\n//export const UMB_BLOCK_ENTRY_WEB_COMPONENTS_ABSOLUTE_PATH = '/umbraco/backoffice/packages/block/block-rte/index.js';\r\nexport const UMB_BLOCK_ENTRY_WEB_COMPONENTS_ABSOLUTE_PATH = '@umbraco-cms/backoffice/block-rte';\r\n\r\n//we put these as extended elements because they get merged on top of the normal allowed elements by tiny mce\r\n//so we don't have to specify all the normal elements again\r\nexport const defaultFallbackConfig: RawEditorOptions = {\r\n\tplugins: ['anchor', 'charmap', 'table', 'lists', 'advlist', 'autolink', 'directionality', 'searchreplace'],\r\n\tvalid_elements:\r\n\t\t'+a[id|style|rel|data-id|data-udi|rev|charset|hreflang|dir|lang|tabindex|accesskey|type|name|href|target|title|class|onfocus|onblur|onclick|ondblclick|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup],-strong/-b[class|style],-em/-i[class|style],-strike[class|style],-s[class|style],-u[class|style],#p[id|style|dir|class|align],-ol[class|reversed|start|style|type],-ul[class|style],-li[class|style],br[class],img[id|dir|lang|longdesc|usemap|style|class|src|onmouseover|onmouseout|border|alt=|title|hspace|vspace|width|height|align|umbracoorgwidth|umbracoorgheight|onresize|onresizestart|onresizeend|rel|data-id],-sub[style|class],-sup[style|class],-blockquote[dir|style|class],-table[border=0|cellspacing|cellpadding|width|height|class|align|summary|style|dir|id|lang|bgcolor|background|bordercolor],-tr[id|lang|dir|class|rowspan|width|height|align|valign|style|bgcolor|background|bordercolor],tbody[id|class],thead[id|class],tfoot[id|class],#td[id|lang|dir|class|colspan|rowspan|width|height|align|valign|style|bgcolor|background|bordercolor|scope],-th[id|lang|dir|class|colspan|rowspan|width|height|align|valign|style|scope],caption[id|lang|dir|class|style],-div[id|dir|class|align|style],-span[class|align|style],-pre[class|align|style],address[class|align|style],-h1[id|dir|class|align|style],-h2[id|dir|class|align|style],-h3[id|dir|class|align|style],-h4[id|dir|class|align|style],-h5[id|dir|class|align|style],-h6[id|style|dir|class|align|style],hr[class|style],small[class|style],dd[id|class|title|style|dir|lang],dl[id|class|title|style|dir|lang],dt[id|class|title|style|dir|lang],object[class|id|width|height|codebase|*],param[name|value|_value|class],embed[type|width|height|src|class|*],map[name|class],area[shape|coords|href|alt|target|class],bdo[class],button[class],iframe[*],figure,figcaption,cite,video[*],audio[*],picture[*],source[*],canvas[*],-code',\r\n\tinvalid_elements: 'font',\r\n\textended_valid_elements:\r\n\t\t'@[id|class|style],+umb-rte-block[!data-content-key],+umb-rte-block-inline[!data-content-key],-div[id|dir|class|align|style],ins[datetime|cite],-ul[class|style],-li[class|style],-h1[id|dir|class|align|style],-h2[id|dir|class|align|style],-h3[id|dir|class|align|style],-h4[id|dir|class|align|style],-h5[id|dir|class|align|style],-h6[id|style|dir|class|align],span[id|class|style|lang],figure,figcaption',\r\n\tcustom_elements: 'umb-rte-block,~umb-rte-block-inline',\r\n\ttoolbar: [\r\n\t\t'styles',\r\n\t\t'bold',\r\n\t\t'italic',\r\n\t\t'alignleft',\r\n\t\t'aligncenter',\r\n\t\t'alignright',\r\n\t\t'bullist',\r\n\t\t'numlist',\r\n\t\t'outdent',\r\n\t\t'indent',\r\n\t\t'link',\r\n\t\t'umbmediapicker',\r\n\t\t'umbembeddialog',\r\n\t],\r\n\r\n\tinit_instance_callback: function (editor) {\r\n\t\t// The following code is the context api proxy. [NL]\r\n\t\t// It re-dispatches the context api request event to the origin target of this modal, in other words the element that initiated the modal. [NL]\r\n\t\teditor.dom.doc.addEventListener(UMB_CONTEXT_REQUEST_EVENT_TYPE, ((event: UmbContextRequestEvent) => {\r\n\t\t\tif (!editor.iframeElement) return;\r\n\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\teditor.iframeElement.dispatchEvent(event.clone());\r\n\t\t}) as EventListener);\r\n\r\n\t\t// Proxy for retrieving icons from outside the iframe [NL]\r\n\t\teditor.dom.doc.addEventListener(UUIIconRequestEvent.ICON_REQUEST, ((event: UUIIconRequestEvent) => {\r\n\t\t\tif (!editor.iframeElement) return;\r\n\r\n\t\t\tconst newEvent = new UUIIconRequestEvent(UUIIconRequestEvent.ICON_REQUEST, {\r\n\t\t\t\tdetail: event.detail,\r\n\t\t\t});\r\n\t\t\teditor.iframeElement.dispatchEvent(newEvent);\r\n\t\t\tif (newEvent.icon !== null) {\r\n\t\t\t\tevent.acceptRequest(newEvent.icon);\r\n\t\t\t}\r\n\t\t}) as EventListener);\r\n\r\n\t\t// Transfer our import-map to the iframe: [NL]\r\n\t\tconst importMapTag = document.head.querySelector('script[type=\"importmap\"]');\r\n\t\tif (importMapTag) {\r\n\t\t\tconst importMap = document.createElement('script');\r\n\t\t\timportMap.type = 'importmap';\r\n\t\t\timportMap.text = importMapTag.innerHTML;\r\n\t\t\teditor.dom.doc.head.appendChild(importMap);\r\n\t\t}\r\n\r\n\t\t// Transfer our stylesheets to the iframe: [NL]\r\n\t\tconst stylesheetTags = document.head.querySelectorAll<HTMLLinkElement>('link[rel=\"stylesheet\"]');\r\n\t\tstylesheetTags.forEach((stylesheetTag) => {\r\n\t\t\tconst stylesheet = document.createElement('link');\r\n\t\t\tstylesheet.rel = 'stylesheet';\r\n\t\t\tstylesheet.href = stylesheetTag.href;\r\n\t\t\teditor.dom.doc.head.appendChild(stylesheet);\r\n\t\t});\r\n\r\n\t\teditor.dom.doc.addEventListener('click', (e: MouseEvent) => {\r\n\t\t\t// If we try to open link in a new tab, then we want to skip skip:\r\n\t\t\t//if ((isWindows && e.ctrlKey) || (!isWindows && e.metaKey)) return;\r\n\r\n\t\t\tconst composedPaths = 'composedPath' in e ? e.composedPath() : null;\r\n\r\n\t\t\t// Find the target by using the composed path to get the element through the shadow boundaries.\r\n\t\t\t// Notice the difference here compared to RouterSlots implementation [NL]\r\n\t\t\tconst $anchor: HTMLAnchorElement =\r\n\t\t\t\t(composedPaths?.find(\r\n\t\t\t\t\t($elem) => $elem instanceof HTMLAnchorElement || ($elem as any).tagName === 'A',\r\n\t\t\t\t) as HTMLAnchorElement) ?? (e.target as HTMLAnchorElement);\r\n\r\n\t\t\t// Abort if the event is not about the anchor tag or the anchor tag has the attribute [data-router-slot]=\"disabled\"\r\n\t\t\tif (\r\n\t\t\t\t$anchor == null ||\r\n\t\t\t\t!($anchor instanceof HTMLAnchorElement || ($anchor as any).tagName === 'A') ||\r\n\t\t\t\t$anchor.dataset['routerSlot'] === 'disabled'\r\n\t\t\t) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Abort if the anchor tag is not inside a block element\r\n\t\t\tconst isInsideBlockElement =\r\n\t\t\t\tcomposedPaths?.some(\r\n\t\t\t\t\t($elem) => ($elem as any).tagName === 'UMB-RTE-BLOCK' || ($elem as any).tagName === 'UMB-RTE-BLOCK-INLINE',\r\n\t\t\t\t) ?? false;\r\n\r\n\t\t\tif (!isInsideBlockElement) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Remove the origin from the start of the HREF to get the path\r\n\t\t\tconst path = $anchor.pathname + $anchor.search + $anchor.hash;\r\n\r\n\t\t\t// Prevent the default behavior\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t// Change the history!\r\n\t\t\twindow.history.pushState(null, '', path);\r\n\t\t});\r\n\r\n\t\t// Load backoffice JS so we can get the umb-rte-block component registered inside the iframe [NL]\r\n\t\tconst script = document.createElement('script');\r\n\t\tscript.type = 'text/javascript';\r\n\t\tscript.setAttribute('type', 'module');\r\n\r\n\t\tscript.text = `import \"@umbraco-cms/backoffice/extension-registry\";`;\r\n\t\tscript.text = `import \"${UMB_BLOCK_ENTRY_WEB_COMPONENTS_ABSOLUTE_PATH}\";`;\r\n\t\teditor.dom.doc.head.appendChild(script);\r\n\t},\r\n\r\n\tstyle_formats: [\r\n\t\t{\r\n\t\t\ttitle: 'Headers',\r\n\t\t\titems: [\r\n\t\t\t\t{ title: 'Page header', block: 'h2' },\r\n\t\t\t\t{ title: 'Section header', block: 'h3' },\r\n\t\t\t\t{ title: 'Paragraph header', block: 'h4' },\r\n\t\t\t],\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'Blocks',\r\n\t\t\titems: [{ title: 'Paragraph', block: 'p' }],\r\n\t\t},\r\n\t\t{\r\n\t\t\ttitle: 'Containers',\r\n\t\t\titems: [\r\n\t\t\t\t{ title: 'Quote', block: 'blockquote' },\r\n\t\t\t\t{ title: 'Code', block: 'code' },\r\n\t\t\t],\r\n\t\t},\r\n\t],\r\n\t/**\r\n\t * @description The maximum image size in pixels that can be inserted into the editor.\r\n\t * @remarks This is registered and used by the UmbMediaPicker plugin\r\n\t */\r\n\tmaxImageSize: 500,\r\n};\r\n","export const availableLanguages = [\r\n\t'ar',\r\n\t'ar_SA',\r\n\t'hy',\r\n\t'az',\r\n\t'eu',\r\n\t'be',\r\n\t'bn_BD',\r\n\t'bs',\r\n\t'bg_BG',\r\n\t'ca',\r\n\t'zh_CN',\r\n\t'zh_TW',\r\n\t'hr',\r\n\t'cs',\r\n\t'da',\r\n\t'dv',\r\n\t'nl',\r\n\t'en_CA',\r\n\t'en_GB',\r\n\t'et',\r\n\t'fo',\r\n\t'fi',\r\n\t'fr_FR',\r\n\t'gd',\r\n\t'gl',\r\n\t'ka_GE',\r\n\t'de',\r\n\t'de_AT',\r\n\t'el',\r\n\t'he_IL',\r\n\t'hi_IN',\r\n\t'hu_HU',\r\n\t'is_IS',\r\n\t'id',\r\n\t'it',\r\n\t'ja',\r\n\t'kab',\r\n\t'kk',\r\n\t'km_KH',\r\n\t'ko_KR',\r\n\t'ku',\r\n\t'ku_IQ',\r\n\t'lv',\r\n\t'lt',\r\n\t'lb',\r\n\t'ml',\r\n\t'ml_IN',\r\n\t'mn_MN',\r\n\t'nb_NO',\r\n\t'fa',\r\n\t'fa_IR',\r\n\t'pl',\r\n\t'pt_BR',\r\n\t'pt_PT',\r\n\t'ro',\r\n\t'ru',\r\n\t'sr',\r\n\t'si_LK',\r\n\t'sk',\r\n\t'sl_SI',\r\n\t'es',\r\n\t'es_MX',\r\n\t'sv_SE',\r\n\t'tg',\r\n\t'ta',\r\n\t'ta_IN',\r\n\t'tt',\r\n\t'th_TH',\r\n\t'tr',\r\n\t'tr_TR',\r\n\t'ug',\r\n\t'uk',\r\n\t'uk_UA',\r\n\t'vi',\r\n\t'vi_VN',\r\n\t'cy',\r\n];\r\n","import type { RawEditorOptions } from '@umbraco-cms/backoffice/external/tinymce';\r\n\r\nexport const pastePreProcessHandler: RawEditorOptions['paste_preprocess'] = (_editor, args) => {\r\n\t// Remove spans\r\n\targs.content = args.content.replace(/<\\s*span[^>]*>(.*?)<\\s*\\/\\s*span>/g, '$1');\r\n\t// Convert b to strong.\r\n\targs.content = args.content.replace(/<\\s*b([^>]*)>(.*?)<\\s*\\/\\s*b([^>]*)>/g, '<strong$1>$2</strong$3>');\r\n\t// convert i to em\r\n\targs.content = args.content.replace(/<\\s*i([^>]*)>(.*?)<\\s*\\/\\s*i([^>]*)>/g, '<em$1>$2</em$3>');\r\n};\r\n","import type { Editor } from '@umbraco-cms/backoffice/external/tinymce';\r\n\r\n/**\r\n * Setup sanitization for preventing injecting arbitrary JavaScript execution in attributes:\r\n * https://github.com/advisories/GHSA-w7jx-j77m-wp65\r\n * https://github.com/advisories/GHSA-5vm8-hhgr-jcjp\r\n * @param editor\r\n */\r\nexport const uriAttributeSanitizer = (editor: Editor) => {\r\n\tconst uriAttributesToSanitize = ['src', 'href', 'data', 'background', 'action', 'formaction', 'poster', 'xlink:href'];\r\n\r\n\tconst parseUri = (function () {\r\n\t\t// Encapsulated JS logic.\r\n\t\tconst safeSvgDataUrlElements = ['img', 'video'];\r\n\t\tconst scriptUriRegExp = /((java|vb)script|mhtml):/i;\r\n\t\t// eslint-disable-next-line no-control-regex\r\n\t\tconst trimRegExp = /[\\s\\u0000-\\u001F]+/g;\r\n\r\n\t\tconst isInvalidUri = (uri: string, tagName: string) => {\r\n\t\t\tif (/^data:image\\//i.test(uri)) {\r\n\t\t\t\treturn safeSvgDataUrlElements.indexOf(tagName) !== -1 && /^data:image\\/svg\\+xml/i.test(uri);\r\n\t\t\t} else {\r\n\t\t\t\treturn /^data:/i.test(uri);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn function parseUri(uri: string, tagName: string) {\r\n\t\t\turi = uri.replace(trimRegExp, '');\r\n\t\t\turi = decodeURIComponent(uri);\r\n\r\n\t\t\tif (scriptUriRegExp.test(uri)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (isInvalidUri(uri, tagName)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\treturn uri;\r\n\t\t};\r\n\t})();\r\n\r\n\teditor.serializer.addAttributeFilter('uriAttributesToSanitize', function (nodes) {\r\n\t\tnodes.forEach(function (node) {\r\n\t\t\tif (!node.attributes) return;\r\n\t\t\tfor (const attr of node.attributes) {\r\n\t\t\t\tconst attrName = attr.name.toLowerCase();\r\n\t\t\t\tif (uriAttributesToSanitize.indexOf(attrName) !== -1) {\r\n\t\t\t\t\tattr.value = parseUri(attr.value, node.name) ?? '';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n};\r\n","import { availableLanguages } from './input-tiny-mce.languages.js';\r\nimport { defaultFallbackConfig } from './input-tiny-mce.defaults.js';\r\nimport { pastePreProcessHandler } from './input-tiny-mce.handlers.js';\r\nimport { uriAttributeSanitizer } from './input-tiny-mce.sanitizer.js';\r\nimport type { UmbTinyMcePluginBase } from './tiny-mce-plugin.js';\r\nimport { css, customElement, html, property, query } from '@umbraco-cms/backoffice/external/lit';\r\nimport { loadManifestApi } from '@umbraco-cms/backoffice/extension-api';\r\nimport { getProcessedImageUrl, umbDeepMerge } from '@umbraco-cms/backoffice/utils';\r\nimport { renderEditor } from '@umbraco-cms/backoffice/external/tinymce';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { ImageCropModeModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbStylesheetDetailRepository, UmbStylesheetRuleManager } from '@umbraco-cms/backoffice/stylesheet';\r\nimport { UUIFormControlMixin } from '@umbraco-cms/backoffice/external/uui';\r\nimport type { ClassConstructor } from '@umbraco-cms/backoffice/extension-api';\r\nimport type { EditorEvent, Editor, RawEditorOptions } from '@umbraco-cms/backoffice/external/tinymce';\r\nimport type { ManifestTinyMcePlugin } from '@umbraco-cms/backoffice/tiny-mce';\r\nimport type { UmbPropertyEditorConfigCollection } from '@umbraco-cms/backoffice/property-editor';\r\n\r\n/**\r\n * Handles the resize event\r\n * @param e\r\n */\r\nasync function onResize(\r\n\te: EditorEvent<{\r\n\t\ttarget: HTMLElement;\r\n\t\twidth: number;\r\n\t\theight: number;\r\n\t\torigin: string;\r\n\t}>,\r\n) {\r\n\tconst srcAttr = e.target.getAttribute('src');\r\n\r\n\tif (!srcAttr) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst path = srcAttr.split('?')[0];\r\n\tconst resizedPath = await getProcessedImageUrl(path, {\r\n\t\twidth: e.width,\r\n\t\theight: e.height,\r\n\t\tmode: ImageCropModeModel.MAX,\r\n\t});\r\n\r\n\te.target.setAttribute('data-mce-src', resizedPath);\r\n}\r\n\r\n@customElement('umb-input-tiny-mce')\r\nexport class UmbInputTinyMceElement extends UUIFormControlMixin(UmbLitElement, '') {\r\n\t@property({ attribute: false })\r\n\tconfiguration?: UmbPropertyEditorConfigCollection;\r\n\r\n\t#plugins: Array<ClassConstructor<UmbTinyMcePluginBase> | undefined> = [];\r\n\t#editorRef?: Editor | null = null;\r\n\treadonly #stylesheetRepository = new UmbStylesheetDetailRepository(this);\r\n\treadonly #umbStylesheetRuleManager = new UmbStylesheetRuleManager();\r\n\r\n\tprotected override getFormElement() {\r\n\t\treturn this._editorElement?.querySelector('iframe') ?? undefined;\r\n\t}\r\n\r\n\toverride set value(newValue: FormDataEntryValue | FormData) {\r\n\t\tconst newContent = typeof newValue === 'string' ? newValue : '';\r\n\t\tsuper.value = newContent;\r\n\r\n\t\tif (this.#editorRef && this.#editorRef.getContent() != newContent) {\r\n\t\t\tthis.#editorRef.setContent(newContent);\r\n\t\t}\r\n\t}\r\n\r\n\toverride get value(): FormDataEntryValue | FormData {\r\n\t\treturn super.value;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the input to readonly mode, meaning value cannot be changed but still able to read and select its content.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: Boolean, reflect: true })\r\n\tpublic get readonly() {\r\n\t\treturn this.#readonly;\r\n\t}\r\n\tpublic set readonly(value) {\r\n\t\tthis.#readonly = value;\r\n\t\tconst editor = this.getEditor();\r\n\t\tconst mode = value ? 'readonly' : 'design';\r\n\t\teditor?.mode.set(mode);\r\n\t}\r\n\t#readonly = false;\r\n\r\n\t@query('.editor', true)\r\n\tprivate readonly _editorElement?: HTMLElement;\r\n\r\n\tgetEditor() {\r\n\t\treturn this.#editorRef;\r\n\t}\r\n\r\n\toverride firstUpdated() {\r\n\t\tthis.#loadEditor();\r\n\t}\r\n\r\n\tasync #loadEditor() {\r\n\t\tthis.observe(umbExtensionsRegistry.byType('tinyMcePlugin'), async (manifests) => {\r\n\t\t\tthis.#plugins.length = 0;\r\n\t\t\tthis.#plugins = await this.#loadPlugins(manifests);\r\n\r\n\t\t\tlet config: RawEditorOptions = {};\r\n\t\t\tmanifests.forEach((manifest) => {\r\n\t\t\t\tif (manifest.meta?.config) {\r\n\t\t\t\t\tconfig = umbDeepMerge(manifest.meta.config, config);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.#setTinyConfig(config);\r\n\t\t});\r\n\t}\r\n\r\n\toverride disconnectedCallback() {\r\n\t\tsuper.disconnectedCallback();\r\n\r\n\t\tthis.#editorRef?.destroy();\r\n\t}\r\n\r\n\t/**\r\n\t * Load all custom plugins - need to split loading and instantiating as these\r\n\t * need the editor instance as a ctor argument. If we load them in the editor\r\n\t * setup method, the asynchronous nature means the editor is loaded before\r\n\t * the plugins are ready and so are not associated with the editor.\r\n\t * @param manifests\r\n\t */\r\n\tasync #loadPlugins(manifests: Array<ManifestTinyMcePlugin>) {\r\n\t\tconst promises = [];\r\n\t\tfor (const manifest of manifests) {\r\n\t\t\tif (manifest.js) {\r\n\t\t\t\tpromises.push(await loadManifestApi(manifest.js));\r\n\t\t\t}\r\n\t\t\tif (manifest.api) {\r\n\t\t\t\tpromises.push(await loadManifestApi(manifest.api));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn promises;\r\n\t}\r\n\r\n\tasync getFormatStyles(stylesheetPaths: Array<string>) {\r\n\t\tif (!stylesheetPaths) return [];\r\n\t\tconst formatStyles: any[] = [];\r\n\r\n\t\tconst promises = stylesheetPaths.map((path) => this.#stylesheetRepository?.requestByUnique(path));\r\n\t\tconst stylesheetResponses = await Promise.all(promises);\r\n\r\n\t\tstylesheetResponses.forEach(({ data }) => {\r\n\t\t\tif (!data?.content) return;\r\n\r\n\t\t\tconst rulesFromContent = this.#umbStylesheetRuleManager.extractRules(data.content);\r\n\r\n\t\t\trulesFromContent.forEach((rule) => {\r\n\t\t\t\tconst r: {\r\n\t\t\t\t\ttitle?: string;\r\n\t\t\t\t\tinline?: string;\r\n\t\t\t\t\tclasses?: string;\r\n\t\t\t\t\tattributes?: Record<string, string>;\r\n\t\t\t\t\tblock?: string;\r\n\t\t\t\t} = {\r\n\t\t\t\t\ttitle: rule.name,\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (!rule.selector) return;\r\n\r\n\t\t\t\tif (rule.selector.startsWith('.')) {\r\n\t\t\t\t\tr.inline = 'span';\r\n\t\t\t\t\tr.classes = rule.selector.substring(1);\r\n\t\t\t\t} else if (rule.selector.startsWith('#')) {\r\n\t\t\t\t\tr.inline = 'span';\r\n\t\t\t\t\tr.attributes = { id: rule.selector.substring(1) };\r\n\t\t\t\t} else if (rule.selector.includes('.')) {\r\n\t\t\t\t\tconst [block, ...classes] = rule.selector.split('.');\r\n\t\t\t\t\tr.block = block;\r\n\t\t\t\t\tr.classes = classes.join(' ').replace(/\\./g, ' ');\r\n\t\t\t\t} else if (rule.selector.includes('#')) {\r\n\t\t\t\t\tconst [block, id] = rule.selector.split('#');\r\n\t\t\t\t\tr.block = block;\r\n\t\t\t\t\tr.classes = id;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tr.block = rule.selector;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tformatStyles.push(r);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn formatStyles;\r\n\t}\r\n\r\n\tasync #setTinyConfig(additionalConfig?: RawEditorOptions) {\r\n\t\tconst dimensions = this.configuration?.getValueByAlias<{ width?: number; height?: number }>('dimensions');\r\n\r\n\t\tconst stylesheetPaths = this.configuration?.getValueByAlias<string[]>('stylesheets') ?? [];\r\n\t\tconst styleFormats = await this.getFormatStyles(stylesheetPaths);\r\n\r\n\t\t// Map the stylesheets with server url\r\n\t\tconst stylesheets =\r\n\t\t\tstylesheetPaths?.map((stylesheetPath: string) => `/css${stylesheetPath.replace(/\\\\/g, '/')}`) ?? [];\r\n\r\n\t\tstylesheets.push('/umbraco/backoffice/css/rte-content.css');\r\n\r\n\t\t// create an object by merging the configuration onto the fallback config\r\n\t\tconst configurationOptions: RawEditorOptions = {\r\n\t\t\t...defaultFallbackConfig,\r\n\t\t\theight: dimensions?.height ?? defaultFallbackConfig.height,\r\n\t\t\twidth: dimensions?.width ?? defaultFallbackConfig.width,\r\n\t\t\tcontent_css: stylesheets.length ? stylesheets : defaultFallbackConfig.content_css,\r\n\t\t\tstyle_formats: styleFormats.length ? styleFormats : defaultFallbackConfig.style_formats,\r\n\t\t};\r\n\r\n\t\t// no auto resize when a fixed height is set\r\n\t\tif (!configurationOptions.height) {\r\n\t\t\tif (Array.isArray(configurationOptions.plugins) && configurationOptions.plugins.includes('autoresize')) {\r\n\t\t\t\tconfigurationOptions.plugins.splice(configurationOptions.plugins.indexOf('autoresize'), 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// set the configured toolbar if any, otherwise false\r\n\t\tconst toolbar = this.configuration?.getValueByAlias<string[]>('toolbar');\r\n\t\tif (toolbar?.length) {\r\n\t\t\tconfigurationOptions.toolbar = toolbar.join(' ');\r\n\t\t} else {\r\n\t\t\tconfigurationOptions.toolbar = false;\r\n\t\t}\r\n\r\n\t\t// set the configured inline mode\r\n\t\tconst mode = this.configuration?.getValueByAlias<string>('mode');\r\n\t\tif (mode?.toLocaleLowerCase() === 'inline') {\r\n\t\t\tconfigurationOptions.inline = true;\r\n\t\t}\r\n\r\n\t\t// set the maximum image size\r\n\t\tconst maxImageSize = this.configuration?.getValueByAlias<number>('maxImageSize');\r\n\t\tif (maxImageSize) {\r\n\t\t\tconfigurationOptions.maxImageSize = maxImageSize;\r\n\t\t}\r\n\r\n\t\t// set the default values that will not be modified via configuration\r\n\t\tlet config: RawEditorOptions = {\r\n\t\t\tautoresize_bottom_margin: 10,\r\n\t\t\tbody_class: 'umb-rte',\r\n\t\t\tcontextMenu: false,\r\n\t\t\tinline_boundaries_selector: 'a[href],code,.mce-annotation,.umb-embed-holder,.umb-macro-holder',\r\n\t\t\tmenubar: false,\r\n\t\t\tpaste_remove_styles_if_webkit: true,\r\n\t\t\tpaste_preprocess: pastePreProcessHandler,\r\n\t\t\trelative_urls: false,\r\n\t\t\tresize: false,\r\n\t\t\tstatusbar: false,\r\n\t\t\tsetup: (editor) => this.#editorSetup(editor),\r\n\t\t\ttarget: this._editorElement,\r\n\t\t\tpaste_data_images: false,\r\n\t\t\tlanguage: this.#getLanguage(),\r\n\t\t\tpromotion: false,\r\n\t\t\tconvert_unsafe_embeds: true, // [JOV] Workaround for CVE-2024-29881\r\n\t\t\treadonly: this.#readonly,\r\n\r\n\t\t\t// Extend with configuration options\r\n\t\t\t...configurationOptions,\r\n\t\t};\r\n\r\n\t\t// Extend with additional configuration options\r\n\t\tif (additionalConfig) {\r\n\t\t\tconfig = umbDeepMerge(additionalConfig, config);\r\n\t\t}\r\n\r\n\t\tthis.#editorRef?.destroy();\r\n\r\n\t\tconst editors = await renderEditor(config).catch((error) => {\r\n\t\t\tconsole.error('Failed to render TinyMCE', error);\r\n\t\t\treturn [];\r\n\t\t});\r\n\t\tthis.#editorRef = editors.pop();\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the language to use for TinyMCE\r\n\t */\r\n\t#getLanguage() {\r\n\t\tconst localeId = this.localize.lang();\r\n\t\t//try matching the language using full locale format\r\n\t\tlet languageMatch = availableLanguages.find((x) => localeId?.localeCompare(x) === 0);\r\n\r\n\t\t//if no matches, try matching using only the language\r\n\t\tif (!languageMatch) {\r\n\t\t\tconst localeParts = localeId?.split('_');\r\n\t\t\tif (localeParts) {\r\n\t\t\t\tlanguageMatch = availableLanguages.find((x) => x === localeParts[0]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn languageMatch;\r\n\t}\r\n\r\n\t#editorSetup(editor: Editor) {\r\n\t\teditor.suffix = '.min';\r\n\r\n\t\t// define keyboard shortcuts\r\n\t\teditor.addShortcut('Ctrl+S', '', () =>\r\n\t\t\tthis.dispatchEvent(new CustomEvent('rte.shortcut.save', { composed: true, bubbles: true })),\r\n\t\t);\r\n\r\n\t\teditor.addShortcut('Ctrl+P', '', () =>\r\n\t\t\tthis.dispatchEvent(new CustomEvent('rte.shortcut.saveAndPublish', { composed: true, bubbles: true })),\r\n\t\t);\r\n\r\n\t\t// bind editor events\r\n\t\teditor.on('init', () => this.#onInit(editor));\r\n\t\teditor.on('Change', () => this.#onChange(editor.getContent()));\r\n\t\teditor.on('Dirty', () => this.#onChange(editor.getContent()));\r\n\t\teditor.on('Keyup', () => this.#onChange(editor.getContent()));\r\n\r\n\t\teditor.on('focus', () => this.dispatchEvent(new CustomEvent('umb-rte-focus', { composed: true, bubbles: true })));\r\n\r\n\t\teditor.on('blur', () => {\r\n\t\t\tthis.#onChange(editor.getContent());\r\n\t\t\tthis.dispatchEvent(new CustomEvent('umb-rte-blur', { composed: true, bubbles: true }));\r\n\t\t});\r\n\r\n\t\teditor.on('ObjectResized', (e) => {\r\n\t\t\tonResize(e);\r\n\t\t\tthis.#onChange(editor.getContent());\r\n\t\t});\r\n\r\n\t\teditor.on('SetContent', () => {\r\n\t\t\t/**\r\n\t\t\t * Prevent injecting arbitrary JavaScript execution in on-attributes.\r\n\t\t\t *\r\n\t\t\t */\r\n\t\t\tconst allNodes = Array.from(editor.dom.doc.getElementsByTagName('*'));\r\n\t\t\tallNodes.forEach((node) => {\r\n\t\t\t\tfor (const attr of node.attributes) {\r\n\t\t\t\t\tif (attr.name.startsWith('on')) {\r\n\t\t\t\t\t\tnode.removeAttribute(attr.name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// instantiate plugins to ensure they are available before setting up the editor.\r\n\t\t// Plugins require a reference to the current editor as a param, so can not\r\n\t\t// be instantiated until we have an editor\r\n\t\tfor (const plugin of this.#plugins) {\r\n\t\t\tif (plugin) {\r\n\t\t\t\t// [v15]: This might be improved by changing to `createExtensionApi` and avoiding the `#loadPlugins` method altogether, but that would require a breaking change\r\n\t\t\t\t// because that function sends the UmbControllerHost as the first argument, which is not the case here.\r\n\t\t\t\tnew plugin({ host: this, editor });\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t#onInit(editor: Editor) {\r\n\t\t//enable browser based spell checking\r\n\t\teditor.getBody().setAttribute('spellcheck', 'true');\r\n\t\turiAttributeSanitizer(editor);\r\n\t\teditor.setContent(typeof this.value === 'string' ? this.value : '');\r\n\t}\r\n\r\n\t#onChange(value: string) {\r\n\t\tif (this.value === value) return;\r\n\t\tthis.value = value;\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\t/**\r\n\t * Nothing rendered by default - TinyMCE initialization creates\r\n\t * a target div and binds the RTE to that element\r\n\t */\r\n\toverride render() {\r\n\t\treturn html`<div class=\"editor\"></div>`;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tcss`\r\n\t\t\t.tox-tinymce {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tmin-height: 100px;\r\n\t\t\t\tborder-radius: 0;\r\n\t\t\t\tborder: var(--uui-input-border-width, 1px) solid var(--uui-input-border-color, var(--uui-color-border, #d8d7d9));\r\n\t\t\t}\r\n\r\n\t\t\t.tox-tinymce-fullscreen {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t}\r\n\r\n\t\t\t/* FIXME: Remove this workaround when https://github.com/tinymce/tinymce/issues/6431 has been fixed */\r\n\t\t\t.tox .tox-collection__item-label {\r\n\t\t\t\tline-height: 1 !important;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbInputTinyMceElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-input-tiny-mce': UmbInputTinyMceElement;\r\n\t}\r\n}\r\n"],"names":["UMB_BLOCK_ENTRY_WEB_COMPONENTS_ABSOLUTE_PATH","defaultFallbackConfig","editor","UMB_CONTEXT_REQUEST_EVENT_TYPE","event","UUIIconRequestEvent","newEvent","importMapTag","importMap","stylesheetTag","stylesheet","e","composedPaths","$anchor","$elem","path","script","availableLanguages","pastePreProcessHandler","_editor","args","uriAttributeSanitizer","uriAttributesToSanitize","parseUri","safeSvgDataUrlElements","scriptUriRegExp","trimRegExp","isInvalidUri","uri","tagName","nodes","node","attr","attrName","_plugins","_editorRef","_stylesheetRepository","_umbStylesheetRuleManager","_readonly","_UmbInputTinyMceElement_instances","loadEditor_fn","loadPlugins_fn","setTinyConfig_fn","getLanguage_fn","editorSetup_fn","onInit_fn","onChange_fn","onResize","srcAttr","resizedPath","getProcessedImageUrl","ImageCropModeModel","UmbInputTinyMceElement","UUIFormControlMixin","UmbLitElement","__privateAdd","UmbStylesheetDetailRepository","UmbStylesheetRuleManager","newValue","newContent","__privateGet","value","__privateSet","mode","__privateMethod","stylesheetPaths","formatStyles","promises","data","rule","block","classes","id","html","umbExtensionsRegistry","manifests","config","manifest","umbDeepMerge","loadManifestApi","additionalConfig","dimensions","styleFormats","stylesheets","stylesheetPath","configurationOptions","toolbar","maxImageSize","editors","renderEditor","error","localeId","languageMatch","x","localeParts","plugin","UmbChangeEvent","css","__decorateClass","property","query","customElement"],"mappings":"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"}