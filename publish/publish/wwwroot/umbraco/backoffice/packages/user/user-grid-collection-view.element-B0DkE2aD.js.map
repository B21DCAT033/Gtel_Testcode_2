{"version":3,"file":"user-grid-collection-view.element-B0DkE2aD.js","sources":["../../../src/packages/user/user/collection/views/grid/user-grid-collection-view.element.ts"],"sourcesContent":["import { getDisplayStateFromUserStatus } from '../../../utils.js';\r\nimport type { UmbUserCollectionContext } from '../../user-collection.context.js';\r\nimport type { UmbUserDetailModel } from '../../../types.js';\r\nimport { UMB_USER_COLLECTION_CONTEXT } from '../../user-collection.context-token.js';\r\nimport { UMB_USER_WORKSPACE_PATH } from '../../../paths.js';\r\nimport { UmbUserKind } from '../../../utils/index.js';\r\nimport { css, html, nothing, customElement, state, repeat, ifDefined } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UserStateModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbUserGroupDetailModel } from '@umbraco-cms/backoffice/user-group';\r\nimport { UmbUserGroupCollectionRepository } from '@umbraco-cms/backoffice/user-group';\r\n\r\n@customElement('umb-user-grid-collection-view')\r\nexport class UmbUserGridCollectionViewElement extends UmbLitElement {\r\n\t@state()\r\n\tprivate _users: Array<UmbUserDetailModel> = [];\r\n\r\n\t@state()\r\n\tprivate _selection: Array<string | null> = [];\r\n\r\n\t@state()\r\n\tprivate _loading = false;\r\n\r\n\t#userGroups: Array<UmbUserGroupDetailModel> = [];\r\n\t#collectionContext?: UmbUserCollectionContext;\r\n\r\n\t// TODO: we need to use the item repository here\r\n\t#userGroupCollectionRepository = new UmbUserGroupCollectionRepository(this);\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_USER_COLLECTION_CONTEXT, (instance) => {\r\n\t\t\tthis.#collectionContext = instance;\r\n\t\t\tthis.observe(\r\n\t\t\t\tthis.#collectionContext.selection.selection,\r\n\t\t\t\t(selection) => (this._selection = selection),\r\n\t\t\t\t'umbCollectionSelectionObserver',\r\n\t\t\t);\r\n\t\t\tthis.observe(this.#collectionContext.items, (items) => (this._users = items), 'umbCollectionItemsObserver');\r\n\t\t});\r\n\r\n\t\tthis.#requestUserGroups();\r\n\t}\r\n\r\n\tasync #requestUserGroups() {\r\n\t\tthis._loading = true;\r\n\r\n\t\tconst { data } = await this.#userGroupCollectionRepository.requestCollection();\r\n\t\tthis.#userGroups = data?.items ?? [];\r\n\t\tthis._loading = false;\r\n\t}\r\n\r\n\t#onSelect(user: UmbUserDetailModel) {\r\n\t\tthis.#collectionContext?.selection.select(user.unique ?? '');\r\n\t}\r\n\r\n\t#onDeselect(user: UmbUserDetailModel) {\r\n\t\tthis.#collectionContext?.selection.deselect(user.unique ?? '');\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._loading) return nothing;\r\n\t\treturn html`\r\n\t\t\t<div id=\"user-grid\">\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._users,\r\n\t\t\t\t\t(user) => user.unique,\r\n\t\t\t\t\t(user) => this.#renderUserCard(user),\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderUserCard(user: UmbUserDetailModel) {\r\n\t\tconst href = UMB_USER_WORKSPACE_PATH + '/edit/' + user.unique;\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-card-user\r\n\t\t\t\t.name=${user.name ?? 'Unnamed user'}\r\n\t\t\t\thref=${href}\r\n\t\t\t\tselectable\r\n\t\t\t\t?select-only=${this._selection.length > 0}\r\n\t\t\t\t?selected=${this.#collectionContext?.selection.isSelected(user.unique)}\r\n\t\t\t\t@selected=${() => this.#onSelect(user)}\r\n\t\t\t\t@deselected=${() => this.#onDeselect(user)}>\r\n\t\t\t\t${this.#renderUserTag(user)} ${this.#renderUserGroupNames(user)} ${this.#renderUserLoginDate(user)}\r\n\t\t\t\t<umb-user-avatar\r\n\t\t\t\t\tslot=\"avatar\"\r\n\t\t\t\t\t.name=${user.name}\r\n\t\t\t\t\t.kind=${user.kind}\r\n\t\t\t\t\t.imgUrls=${user.avatarUrls}\r\n\t\t\t\t\tstyle=\"font-size: 1.6rem;\"></umb-user-avatar>\r\n\t\t\t</uui-card-user>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderUserTag(user: UmbUserDetailModel) {\r\n\t\tif (user.state && user.state === UserStateModel.ACTIVE) {\r\n\t\t\treturn nothing;\r\n\t\t}\r\n\r\n\t\tconst statusLook = user.state ? getDisplayStateFromUserStatus(user.state) : undefined;\r\n\t\treturn html`<uui-tag\r\n\t\t\tslot=\"tag\"\r\n\t\t\tsize=\"s\"\r\n\t\t\tlook=\"${ifDefined(statusLook?.look)}\"\r\n\t\t\tcolor=\"${ifDefined(statusLook?.color)}\">\r\n\t\t\t<umb-localize key=${'user_' + statusLook?.key}></umb-localize>\r\n\t\t</uui-tag>`;\r\n\t}\r\n\r\n\t#renderUserGroupNames(user: UmbUserDetailModel) {\r\n\t\tconst userGroupNames = this.#userGroups\r\n\t\t\t.filter((userGroup) => user.userGroupUniques?.map((reference) => reference.unique).includes(userGroup.unique))\r\n\t\t\t.map((userGroup) => userGroup.name)\r\n\t\t\t.join(', ');\r\n\r\n\t\treturn html`<div>${userGroupNames}</div>`;\r\n\t}\r\n\r\n\t#renderUserLoginDate(user: UmbUserDetailModel) {\r\n\t\tif (user.kind === UmbUserKind.API) return nothing;\r\n\r\n\t\tif (!user.lastLoginDate) {\r\n\t\t\treturn html`<div class=\"user-login-time\">${`${user.name} ${this.localize.term('user_noLogin')}`}</div>`;\r\n\t\t}\r\n\t\tconst lastLoggedinLocalTime: Date = new Date(user.lastLoginDate);\r\n\t\tconst formattedTime = lastLoggedinLocalTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n\r\n\t\treturn html`<div class=\"user-login-time\">\r\n\t\t\t<umb-localize key=\"user_lastLogin\"></umb-localize>\r\n\t\t\t${this.localize.date(user.lastLoginDate)} ${formattedTime}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t}\r\n\r\n\t\t\t#user-grid {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgrid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\r\n\t\t\t\tgap: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\tuui-card-user {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 180px;\r\n\t\t\t\tjustify-content: normal;\r\n\t\t\t\tpadding-top: var(--uui-size-space-5);\r\n\t\t\t}\r\n\r\n\t\t\t.user-login-time {\r\n\t\t\t\tmargin-top: auto;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbUserGridCollectionViewElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-user-grid-collection-view': UmbUserGridCollectionViewElement;\r\n\t}\r\n}\r\n"],"names":["_userGroups","_collectionContext","_userGroupCollectionRepository","_UmbUserGridCollectionViewElement_instances","requestUserGroups_fn","onSelect_fn","onDeselect_fn","renderUserCard_fn","renderUserTag_fn","renderUserGroupNames_fn","renderUserLoginDate_fn","UmbUserGridCollectionViewElement","UmbLitElement","__privateAdd","UmbUserGroupCollectionRepository","UMB_USER_COLLECTION_CONTEXT","instance","__privateSet","__privateGet","selection","items","__privateMethod","nothing","html","repeat","user","data","href","UMB_USER_WORKSPACE_PATH","UserStateModel","statusLook","getDisplayStateFromUserStatus","ifDefined","userGroupNames","userGroup","reference","UmbUserKind","formattedTime","UmbTextStyles","css","__decorateClass","state","customElement","UmbUserGridCollectionViewElement$1"],"mappings":"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"}